
AVRASM ver. 1.56  C:\box\abb8515.asm Thu Sep 08 16:25:39 2011


C:\box\abb8515.asm(9200): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9202): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9205): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9213): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9214): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9218): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9219): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9220): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9221): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9222): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9228): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9229): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9230): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9233): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9236): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9249): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9258): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9259): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9261): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9262): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9263): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9264): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9265): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9266): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9267): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9268): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9269): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9270): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9272): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9285): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9330): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9331): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9332): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9334): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9335): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9336): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9367): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9370): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9381): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9386): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9388): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9392): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9400): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9402): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9419): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9420): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9421): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9422): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9423): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9424): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9425): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9426): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
C:\box\abb8515.asm(9427): warning: A .db segment with an odd number of bytes is detected. A zero byte is added.
         ;***************************************************************************
         ;* 
         ;* 
         ;* File Name            :"app8515.asm"
         ;* Title                :
         ;* Date                 :
         ;* Version              :2.0
         ;* Target MCU           :AT90S8515
         ;* AUTHOR		:
         ;* 			 
         ;* 			 
         ;* 			 
         ;*
         ;* DESCRIPTION:
         ;* 
         ;*
         ;*
         ;*
         ;* Copyright (c) 		2004 Jarl&Jarmo
         ;* All rights reserved
         ;*
         ;*  
         ;*
         ;***************************************************************************
           
            .include "8515def.inc"
         ;***************************************************************************
         ;* A P P L I C A T I O N   N O T E   F O R   T H E   A V R   F A M I L Y
         ;* 
         ;* Number		:AVR000
         ;* File Name		:"8515def.inc"
         ;* Title		:Register/Bit Definitions for the AT90S8515
         ;* Date                 :99.01.28
         ;* Version              :1.30
         ;* Support telephone	:+47 72 88 43 88 (ATMEL Norway)
         ;* Support fax		:+47 72 88 43 99 (ATMEL Norway)
         ;* Support E-mail	:avr@atmel.com
         ;* Target MCU		:AT90S8515
         ;*
         ;* DESCRIPTION
         ;* When including this file in the assembly program file, all I/O register	
         ;* names and I/O register bit names appearing in the data book can be used.
         ;* In addition, the six registers forming the three data pointers X, Y and
         ;* Z have been assigned names XL - ZH. Highest RAM address for Internal 
         ;* SRAM is also defined 
         ;*
         ;* The Register names are represented by their hexadecimal address.
         ;* 
         ;* The Register Bit names are represented by their bit number (0-7).
         ;* 
         ;* Please observe the difference in using the bit names with instructions
         ;* such as "sbr"/"cbr" (set/clear bit in register) and "sbrs"/"sbrc" 
         ;* (skip if bit in register set/cleared). The following example illustrates
         ;* this:
         ;* 
         ;* in	r16,PORTB		;read PORTB latch
         ;* sbr	r16,(1<<PB6)+(1<<PB5)	;set PB6 and PB5 (use masks, not bit#)
         ;* out  PORTB,r16		;output to PORTB
         ;*
         ;* in	r16,TIFR		;read the Timer Interrupt Flag Register
         ;* sbrc	r16,TOV0		;test the overflow flag (use bit#)
         ;* rjmp	TOV0_is_set		;jump if set
         ;* ...				;otherwise do something else
         ;***************************************************************************
         
         ;***** Specify Device
          .device AT90S8515
         
         ;***** I/O Register Definitions
          .equ	SREG	=$3f
          .equ	SPH	=$3e
          .equ	SPL	=$3d
          .equ	GIMSK	=$3b
          .equ	GIFR	=$3a
          .equ	TIMSK	=$39
          .equ	TIFR	=$38
          .equ	MCUCR	=$35
         
          .equ	TCCR0	=$33
          .equ	TCNT0	=$32
          .equ	OCR0	=$31
         
          .equ	TCCR1A	=$2f
          .equ	TCCR1B	=$2e
          .equ	TCNT1H	=$2d
          .equ	TCNT1L	=$2c
          .equ	OCR1AH	=$2b
          .equ	OCR1AL	=$2a
          .equ	OCR1BH	=$29
          .equ	OCR1BL	=$28
          .equ	ICR1H	=$25
          .equ	ICR1L	=$24
         
          .equ	WDTCR	=$21
          .equ	EEARH	=$1f
          .equ	EEARL	=$1e
          .equ	EEDR	=$1d
          .equ	EECR	=$1c
         
          .equ	PORTA	=$1b
          .equ	DDRA	=$1a
          .equ	PINA	=$19
          .equ	PORTB	=$18
          .equ	DDRB	=$17
          .equ	PINB	=$16
          .equ	PORTC	=$15
          .equ	DDRC	=$14
          .equ	PINC	=$13
          .equ	PORTD	=$12
          .equ	DDRD	=$11
          .equ	PIND	=$10
         
          .equ	SPDR	=$0f
          .equ	SPSR	=$0e
          .equ	SPCR	=$0d
          .equ	UDR	=$0c
          .equ	USR	=$0b
          .equ	UCR	=$0a
          .equ	UBRR	=$09
          .equ	ACSR	=$08
         
         
         ;***** Bit Definitions
          .equ	INT1	=7
          .equ	INT0	=6
         
          .equ	INTF1	=7
          .equ	INTF0	=6
         
          .equ	TOIE1	=7
          .equ	OCIE1A	=6
          .equ	OCIE1B	=5
          .equ	TICIE1	=3
          .equ	TOIE0	=1
         
          .equ	TOV1	=7
          .equ	OCF1A	=6
          .equ	OCF1B	=5
          .equ	ICF1	=3
          .equ	TOV0	=1
         
          .equ	SRE	=7
          .equ	SRW	=6
          .equ	SE	=5
          .equ	SM	=4
          .equ	ISC11	=3
          .equ	ISC10	=2
          .equ	ISC01	=1
          .equ	ISC00	=0
         
          .equ	CS02	=2
          .equ	CS01	=1
          .equ	CS00	=0
         
          .equ	COM1A1	=7
          .equ	COM1A0	=6
          .equ	COM1B1	=5
          .equ	COM1B0	=4
          .equ	PWM11	=1
          .equ	PWM10	=0
         
          .equ	ICNC1	=7
          .equ	ICES1	=6
          .equ	CTC1	=3
          .equ	CS12	=2
          .equ	CS11	=1
          .equ	CS10	=0
         
          .equ	WDDE	=4
          .equ	WDE	=3
          .equ	WDP2	=2
          .equ	WDP1	=1
          .equ	WDP0	=0
         
          .equ	EEMWE	=2
          .equ	EEWE	=1
          .equ	EERE	=0
         
          .equ	PA7	=7
          .equ	PA6	=6
          .equ	PA5	=5
          .equ	PA4	=4
          .equ	PA3	=3
          .equ	PA2	=2
          .equ	PA1	=1
          .equ	PA0	=0
         
          .equ	DDA7	=7
          .equ	DDA6	=6
          .equ	DDA5	=5
          .equ	DDA4	=4
          .equ	DDA3	=3
          .equ	DDA2	=2
          .equ	DDA1	=1
          .equ	DDA0	=0
         
          .equ	PINA7	=7
          .equ	PINA6	=6
          .equ	PINA5	=5
          .equ	PINA4	=4
          .equ	PINA3	=3
          .equ	PINA2	=2
          .equ	PINA1	=1
          .equ	PINA0	=0
         
          .equ	PB7	=7
          .equ	PB6	=6
          .equ	PB5	=5
          .equ	PB4	=4
          .equ	PB3	=3
          .equ	PB2	=2
          .equ	PB1	=1
          .equ	PB0	=0
         
          .equ	DDB7	=7
          .equ	DDB6	=6
          .equ	DDB5	=5
          .equ	DDB4	=4
          .equ	DDB3	=3
          .equ	DDB2	=2
          .equ	DDB1	=1
          .equ	DDB0	=0
         
          .equ	PINB7	=7
          .equ	PINB6	=6
          .equ	PINB5	=5
          .equ	PINB4	=4
          .equ	PINB3	=3
          .equ	PINB2	=2
          .equ	PINB1	=1
          .equ	PINB0	=0
         
          .equ	PC7	=7
          .equ	PC6	=6
          .equ	PC5	=5
          .equ	PC4	=4
          .equ	PC3	=3
          .equ	PC2	=2
          .equ	PC1	=1
          .equ	PC0	=0
         
          .equ	DDC7	=7
          .equ	DDC6	=6
          .equ	DDC5	=5
          .equ	DDC4	=4
          .equ	DDC3	=3
          .equ	DDC2	=2
          .equ	DDC1	=1
          .equ	DDC0	=0
         
          .equ	PINC7	=7
          .equ	PINC6	=6
          .equ	PINC5	=5
          .equ	PINC4	=4
          .equ	PINC3	=3
          .equ	PINC2	=2
          .equ	PINC1	=1
          .equ	PINC0	=0
         
          .equ	PD7	=7
          .equ	PD6	=6
          .equ	PD5	=5
          .equ	PD4	=4
          .equ	PD3	=3
          .equ	PD2	=2
          .equ	PD1	=1
          .equ	PD0	=0
         
          .equ	DDD7	=7
          .equ	DDD6	=6
          .equ	DDD5	=5
          .equ	DDD4	=4
          .equ	DDD3	=3
          .equ	DDD2	=2
          .equ	DDD1	=1
          .equ	DDD0	=0
         
          .equ	PIND7	=7
          .equ	PIND6	=6
          .equ	PIND5	=5
          .equ	PIND4	=4
          .equ	PIND3	=3
          .equ	PIND2	=2
          .equ	PIND1	=1
          .equ	PIND0	=0
         
          .equ	SPIE	=7
          .equ	SPE	=6
          .equ	DORD	=5
          .equ	MSTR	=4
          .equ	CPOL	=3
          .equ	CPHA	=2
          .equ	SPR1	=1
          .equ	SPR0	=0
         
          .equ	SPIF	=7
          .equ	WCOL	=6
         
          .equ	RXC	=7
          .equ	TXC	=6
          .equ	UDRE	=5
          .equ	FE	=4
          .equ	OR	=3
         
          .equ	RXCIE	=7
          .equ	TXCIE	=6
          .equ	UDRIE	=5
          .equ	RXEN	=4
          .equ	TXEN	=3
          .equ	CHR9	=2
          .equ	RXB8	=1
          .equ	TXB8	=0
         
          .equ	ACD	=7
          .equ	ACO	=5
          .equ	ACI	=4
          .equ	ACIE	=3
          .equ	ACIC	=2
          .equ	ACIS1	=1
          .equ	ACIS0	=0
         
          .def	XL	=r26
          .def	XH	=r27
          .def	YL	=r28
          .def	YH	=r29
          .def	ZL	=r30
          .def	ZH	=r31
         
          .equ 	RAMEND  =$25F	;Last On-Chip SRAM Location
          .equ	XRAMEND =$FFFF
          .equ	E2END	=$1FF
          .equ	FLASHEND=$FFF
         
         
          .equ	INT0addr=$001	;External Interrupt0 Vector Address
          .equ	INT1addr=$002	;External Interrupt1 Vector Address
          .equ	ICP1addr=$003	;Input Capture1 Interrupt Vector Address
          .equ	OC1Aaddr=$004	;Output Compare1A Interrupt Vector Address
          .equ	OC1Baddr=$005	;Output Compare1B Interrupt Vector Address
          .equ	OVF1addr=$006	;Overflow1 Interrupt Vector Address
          .equ	OVF0addr=$007	;Overflow0 Interrupt Vector Address
          .equ	SPIaddr =$008	;SPI Interrupt Vector Address
          .equ	URXCaddr=$009	;UART Receive Complete Interrupt Vector Address
          .equ	UDREaddr=$00a	;UART Data Register Empty Interrupt Vector Address
          .equ	UTXCaddr=$00b	;UART Transmit Complete Interrupt Vector Address
          .equ	ACIaddr =$00c	;Analog Comparator Interrupt Vector Address
           ;.include "m8515def.inc"
               
          .equ	InitBaudRate		=11059200/16/9600-1	;Calculate  baud-rate for hardware-UART (9600, crystal 12MHz=12000000Hz)
         ;.equ	InitBaudRate		=11059200/16/115200-1	;Calculate  baud-rate for hardware-UART (115200, crystal 12MHz=12000000Hz)
          .equ 	BUFSIZE			=120
          .equ	Str6Size		=6
          .equ	LongIntSize		=2
          .equ	LongWordSize		=4
         
         ;******************
         ;* SUART Constants *
         ;******************
         
         ;**** Constant declarations Data Rate ****
         
         ;.equ	N = 95			; 115200 BAUD when R=1 and XTAL=11.059MHz
         
         ;.equ	N = 31			; 57600 BAUD when R=2 and XTAL=11.059MHz
         ;.equ	N = 43			; 38400 BAUD when R=2 and XTAL=11.059MHz
         ; .equ	N = 79			; 19200 BAUD when R=2 and XTAL=11.059MHz
          
         ;t .equ	N = 170  		; 9600	BAUD wheb R=2,N1=12,N2=18 and XTAL=11.059MHz
         ;.equ	N = 33			; 19200 BAUD when R=2 and XTAL=4.00MHz
         ;.equ	N = 102			; 38400 BAUD when R=1 and XTAL=4.00MHz
         ;t.equ	R = 2
         ;t.equ	N1=13 ;17;13
         ;t.equ	N2=45 ;76;45
         
         ;**** SUART transmit pin in PORTD ****
         
          .equ	STXPIN = 3;1
          .equ	SRXPIN = 2;0		; Receive pin must be external interrupt !!
         
         ;**** Bit positions in SUART Status Register ****
         
          .equ	STXC = 0				; Transmit
          .equ	SRXC = 1				; Receive
         
          .equ	SCK  = 7
          .equ	MISO = 6
          .equ	MOSI = 5
          .equ	SS   = 4
          .equ	SS1  = 0;7
          .equ	SS2  = 1;6
         
         
          .def 	flag			=R25
          .def    rxhead                  =R16
          .def	rxtail			=R17		
          .def	tempchar		=R18		
          .def	temp1			=R19		;temporary register
          .def	temp0			=R20		;temporary register
          .def	u_data			=R21		; UART data r20
          .def	bit_cnt			=R23		; Bit count used by SUART routine
          .def	u_stat			=R24		; r24Status byte used by SUART routine
         
          .dseg
000060       Buf:    	.byte BUFSIZE
0000d8       SUARTbuf:	.byte BUFSIZE
000150       TempBuf:	.byte BUFSIZE
0001c8       Str1:		.byte 1
0001c9       Str6:		.byte Str6Size
0001cf       LongInt:	.byte LongIntSize
0001d1       LongWord:	.byte LongWordSize
0001d5       Mode:		.byte 1
0001d6       BL1:		.byte 1				;bit-length 1
0001d7       BL15:		.byte 1				;bit-length 1.5
0001d8       DelayV:	.byte 3
0001db       Phoneno:	.byte 15
0001ea       TempPhoneno:	.byte 15
          ;CrFlag:	.byte 1
          ;SmsFlag:	.byte 1
          ;pollFlag:	.byte 1
0001f9       Count:		.byte 1
0001fa       Scount:	.byte 1				;Source counter
0001fb       Mcount:	.byte 1				;Moutef counter
         
0001fc       TimeOutCount:	.byte 3
0001ff       lampStatus:	.byte 1
          ;cmgrFlag:	.byte 1
000200       SmsCount:	.byte 1
000201       SmsNo:		.byte 2
          ;Svolume:	.byte 1
000203       Svolume:	.byte 2
000205       RefTemp:	.byte 1
000206       Bflags:	.byte 1				;bit0=pollFlag
          						;bit1=SmsFlag
          						;bit2=
          						;bit3=StartFlag	
          						;bit4=CrFlag
          						;bit5=ButtonLockFlag
          						
000207       year:		.byte 1
000208       day:		.byte 2
00020a       hour:		.byte 1
00020b       minute:	.byte 1
00020c       seconds:	.byte 1
00020d       weekday:	.byte 1
          
00020e       GTemperature:	.byte 2
          		
         
         ;------------------------------------------------------------------------------------------
         ;********************************************************************
         ;* Interrupt table
         ;********************************************************************
          .cseg
         ;------------------------------------------------------------------------------------------
          .org 0						;Reset
000000 c060      		rjmp reset	
         
          .org INT0addr	
000001 c054      		rjmp	INT_0
         		;ldi	temp0,0<<INT0		;Disable external interrupt INT0
         		;out	GIMSK,temp0
         		;ldi	u_data,65
         		;rcall	putc
         		;ldi	temp0,1<<INT0		;Enable external interrupt INT0
         		;out	GIMSK,temp0
         		;reti
         
          .org OVF0addr					;Overflow0 Interrupt 
000007 c023      		rjmp	TIM0_OVF		;Timer0 Overflow Handle
         		
          .org OVF1addr	
000006 c047      		rjmp	TIM1_OVF	
         ;------------------------------------------------------------------------------------------
          .org URXCaddr					;prijem zo seriovej linky
000009 921f      		push	r1
00000a b61f      		in	r1,SREG				; preserve main OS status reg.
00000b 922f      		push	r2
00000c 93ef      		push	zl
00000d 93ff      		push	zh
00000e 2422      		clr	r2
00000f e6e0      		ldi	zl,low(Buf)			; ptr to our rxbuffer... z = &Buf[rxtail]
000010 e0f0      		ldi	zh,high(Buf)
000011 0fe1      		add	zl,rxtail	
000012 1df2      		adc	zh,r2
000013 b02c      		in	r2,UDR				; get the incomming char 
         		;----------------------------
000014 9120 01d5 		lds	tempchar,Mode			; get modeno
000016 3322      		cpi	tempchar,'2'
000017 f019      		breq	URXCaddr0
000018 2d42      		mov	temp0,r2
000019 304d      		cpi	temp0,13     ; 'cr' 
00001a f071       		breq	w2
         		;---------------------------
         		;push	temp0
         	        ;in	temp0,UDR			;nacitaj do temp0 prijate data z UART-u
         	 	;sei					;povol interrupty na obsluhu USB
          URXCaddr0:	;in	backupSREGTimer,SREG		;zaloha SREG
00001b 9857      		cbi	UCR,RXCIE			;AT90s8515,zakazat interrupt od prijimania UART		
         		;cbi	UCSRB,udre			;register name in Atmega 8515
00001c 8220      		st	z,r2				; Buf[rxtail++] = UDR
00001d 9513      		inc	rxtail
00001e 3718      		cpi	rxtail,BUFSIZE
00001f f008      		brlo	Rs232inx
000020 2711      		clr	rxtail				; Circle around to the first buffer pos.
          Rs232inx:
         		
         		
         		
         		;cpi	RS232BufferFull,MAXRS232LENGTH-4
         		;brcc	NoIncRS232BufferFull
         		;push	RS232BufptrX
         		;lds	RS232BufptrX,RS232BufferBegin+2	;nastavenie sa na zaciatok buffera zapisu RS232 kodu : 3.byte hlavicky (dlzka kodu + citanie + zapis + rezerva)
         		;st	X+,temp0			;a uloz ho do buffera
         		;cpi	RS232BufptrX,RS232BufferBegin+MAXRS232LENGTH+1	;ak sa nedosiahol maximum RS232 buffera
         		;brne	NoUARTBufferOverflow		;tak pokracuj
         		;ldi	RS232BufptrX,RS232BufferBegin+4	;inak sa nastav na zaciatok buffera
           NoUARTBufferOverflow:
         		;sts	RS232BufferBegin+2,RS232BufptrX	;ulozenie noveho offsetu buffera zapisu RS232 kodu : 3.byte hlavicky (dlzka kodu + citanie + zapis + rezerva)
         		;inc	RS232BufferFull			;zvys dlzku RS232 Buffera
         		;pop	RS232BufptrX
           NoIncRS232BufferFull:
         		;pop	temp0
         		;out	SREG,backupSREGTimer		;obnova SREG
         		
         		;;;;out	udr,r2 ;temp0	;send the recived valuable
          w1:
         		;mov     temp1,r2
         		;sts	CrFlag,temp1
         ;***** Xoff calcs go here *****
         
000021 91ff      		pop	zh
000022 91ef      		pop	zl
000023 902f      		pop	r2
000024 be1f      		out	SREG,r1				; restore previous status reg
000025 901f      		pop	r1
000026 94f8      		cli					;
000027 9a57      		sbi	UCR,RXCIE			;
         		;sbi	UCSRB,RXCIE			;
         ;send:	
         ;	sbi	ucr,txen	;set sender bit
         ;	sbis	usr,udre	;wait till register is cleared
         ;	rjmp	send
         	;out	udr,temp0	;send the recived valuable
         ;	cbi	ucr,txen	;clear sender bit
000028 9518      		reti
          w2:
         		;sbi	PORTD,6
         		;;ldi	temp1,1
         		;;sts	CrFlag,temp1
000029 da7a      		rcall	SetCrFlag		;Set CrFlag
         		;lds	temp1,Bflags
         		;sbr	temp1,16
         		;sts	Bflags,temp1
00002a cff0      		rjmp	URXCaddr0;w1
         
         ;------------------------------------------------------------------------------------------
         ;***************************************************************************
         ;*
         ;* INTERRUPT
         ;*	TIM0_OVF - Software SUART Service Routine
         ;*
         ;***************************************************************************
         
          TIM0_OVF:
00002b b60f      	in	r0,SREG		; store SREG
         	;ldi	temp1,(256-N+N1+8) ;(256-N+8)
00002c 9130 01d6 	lds	temp1,BL1	; load T/C0
00002e bf32      	out	TCNT0,temp1	; reset T/C0 to one bit lenght
00002f 9573      	inc	bit_cnt		; increment bit counter
000030 ff80      	sbrs	u_stat,STXC	; if (transmit complete flag clear)
000031 c00b      	rjmp	transmit	;    goto transmit
         
000032 9408      to_0:	sec			; set carry
000033 9b82      	sbis	PIND,SRXPIN	; if (RxD == LOW)
000034 9488      	clc			;	clear carry
000035 9557      	ror	u_data		; shift carry into u_data
         
000036 3078      	cpi	bit_cnt,8	; if (bit_cnt == 8)
000037 f419      	brne	to_1		; {
000038 2733      	clr	temp1		;    disable T/C0 Overflow Interrupt
000039 bf39      	out	TIMSK,temp1
00003a 6082      	sbr	u_stat,1<<SRXC	;    set receive complete
          to_1:				; }
00003b be0f      	out	SREG,r0	        ; restore SREG
00003c 9518      	reti			; exit
         
          transmit:
00003d 3071      	cpi	bit_cnt,1	; if (bit_cnt == 1)	\\ start bit
00003e f411      	brne	to_2		; {
00003f 98c3      	cbi	PORTB,STXPIN	;	generate start bit
000040 cffa      	rjmp	to_1		;	exit
          to_2:				; }
000041 307a      	cpi	bit_cnt,10	; if (bit_cnt == 10)	\\ stop bit
000042 f429      	brne	to_3		; {
000043 9ac3      	sbi	PORTB,STXPIN	;	generate stop bit
000044 2733      	clr	temp1		;	disable TC0 overflow interrupt
000045 bf39      	out	TIMSK,temp1
000046 6081      	sbr	u_stat,1<<STXC	;	set transmit complete bit
000047 cff3      	rjmp	to_1		;	exit
          to_3:				; }
000048 fd50      	sbrc	u_data,0	; if (LSB set)
000049 9ac3      	sbi	PORTB,STXPIN	;	PD3 = HIGH
00004a ff50      	sbrs	u_data,0	; if (LSB clear)
00004b 98c3      	cbi	PORTB,STXPIN	;	PD3 = LOW
00004c 9556      	lsr	u_data		; shift left u_data
00004d cfed      	rjmp	to_1		; exit
         	
         	
         ;------------------------------------------------------------------------------------------
         ;***************************************************************************
         ;*
         ;* INTERRUPT
         ;*	TIM1_OVF - *************** Routine
         ;*
         ;***************************************************************************
         
          TIM1_OVF:
         	;sbi	PORTD,6	
00004e 932f      	push	tempchar
00004f 9120 01f9 	lds	tempchar,Count
000051 9523      	inc	tempchar
000052 9320 01f9 	sts	Count,tempchar
000054 912f      	pop	tempchar
         	;ldi	tempchar,65
         	;rcall	PutcHardUart
         	;ldi	u_data,65
         	;rcall	putc
         	;rcall	timer1_init
         	;ldi	temp1,1<<TOV1	; enable T/C0 overflow interrupt
         	;out	TIMSK,temp1	
         	;cbi	PORTD,6	
000055 9518      	reti
         ;-----------------------------------------------------------------------------------------
          INT_0:
000056 921f      	push	r1
000057 b61f      	in	r1,SREG	
000058 9a96      	sbi	PORTD,6                 ;Set RTS ON
000059 e040      	ldi	temp0,0<<INT0		;Disable external interrupt INT0
00005a bf4b      	out	GIMSK,temp0
         	;ldi	u_data,65
         	;rcall	putc
00005b be1f      	out	SREG,r1			; restore previous status reg
00005c 901f      	pop	r1
00005d e440      	ldi	temp0,1<<INT0		;Enable external interrupt INT0
00005e bf4b      	out	GIMSK,temp0
00005f e091      	ldi	flag,1
000060 9518      	reti
         ;----------------------------------------------------------------------------------------
         ;********************************************************************
         ;* Init program
         ;********************************************************************
         ;------------------------------------------------------------------------------------------
          reset:		
         	;----------------------Init Stack Pointer-----------------------------
000061 e042      		ldi temp0,$02			; Stack Pointer Setup
000062 bf4e      		out SPH,temp0			; Stack Pointer High Byte 
000063 e54f      		ldi temp0,$5F			; Stack Pointer Setup 
000064 bf4d      		out SPL,temp0			; Stack Pointer Low Byte 
         			
         ;		rcall	LongDelay
         ;		rcall	LongDelay
         		;ldi 	zl,low(ireg)		;Load strinpointer
         		;ldi 	zh,high(ireg)
         		;rcall	EERead			;Get initreg ireg
         		;mov	temp0,tempchar
         		
         		;sbrc	temp0,0
         		;rcall	initPoll
         	
         ;--------------------------------test-------------------------------------------------	
         ;		ldi	yl,low(phoneno)
         ;		ldi	yh,high(phoneno)
         		;adiw	yl,1
         		;sbiw	yl,1				
         ;		ldi	temp0,'+'
         ;		st	y+,temp0
         ;		ldi	temp0,'4'
         ;		st	y+,temp0
         ;		ldi	temp0,'6'
         ;		st	y+,temp0
         ;		ldi	temp0,'0'
         ;		st	y+,temp0
         ;		ldi	temp0,'7'
         ;		st	y+,temp0
         	
         ;		ldi	yl,low(phoneno)
         ;		ldi	yh,high(phoneno)
         		
         ;		ldi	zl,low(pslistE)
         ;		ldi	zh,high(pslistE)		
         ;		rcall	StrSearchEEP			;Check for matching phoneno in list
         
         	
         ;---------------------------------------------------------------------------------------------	
         	
         	
         		
000065 9ad0      		sbi	DDRA,0			;Config PORTA pin 0 as an output
         	;-----------------Config pins for Buttons function-------------------------------	
000066 9ad5      		sbi	DDRA,5			;Config pin 5 as an output
000067 9ad6      		sbi	DDRA,6			;Config pin 6 as an output
         		;sbi 	DDRA,7			;Config pin 7 as an input
         		
000068 98a0      		cbi	DDRC,0			;Config pin 0 as an input
000069 98a1      		cbi	DDRC,1			;Config pin 1 as an input
00006a 98a2      		cbi	DDRC,2			;Config pin 2 as an input
00006b 98a3      		cbi	DDRC,3			;Config pin 3 as an input
00006c 98a4      		cbi	DDRC,4			;Config pin 4 as an input
00006d 98a5      		cbi	DDRC,5			;Config pin 5 as an input
         		;sbi	DDRC,4			;Config pin 4 as an output
         		;sbi	DDRC,5			;Config pin 5 as an output
00006e 9aa6      		sbi 	DDRC,6			;Config pin 6 as an output
00006f 9aa7      		sbi	DDRC,7			;Config pin 7 as an output
         		
         		;cbi	PORTC,4			;Set pin4 Off
         		;cbi	PORTC,5			;Set pin5 Off
000070 98ae      		cbi	PORTC,6			;Set pin6 Off
000071 98af      		cbi 	PORTC,7			;Set pin7 Off
         		
         		
000072 9a8e      		sbi	DDRD,6			;init rts (as an output)
000073 9896      		cbi	PORTD,6			;set rts off
000074 9a90      		sbi	PORTD,0			;nahodit pull-up na RxD vstupe
000075 e447      		ldi	temp0,InitBaudRate	;Set baude-rate for hardware-UART
         
000076 9a8f      		sbi	DDRD,7			;Config pin 7 as an output
000077 9897      		cbi	PORTD,7			;Set pin 7 off
         
         ;		ldi 	zl,low(baudrate)	;Load strinpointer
         ;		ldi 	zh,high(baudrate)
         ;		rcall	EERead			;Get Baud-rate
         ;		mov	temp0,tempchar
000078 b949      		out	UBRR,temp0		;Set baude-rate for hardware-Uart
000079 9a53      		sbi	UCR,TXEN		;AT90s8515,TX enable hardware-UART
         		;sbi	UCSRB,TXEN		;ATmega8515,TX enable hardware-UART
00007a 9a54      		sbi	UCR,RXEN		;AT90s8515,RX enable hardware-UART
         		;sbi	UCSRB,RXEN		;ATmega8515,RX enable hardware-UART
00007b 9a57      		sbi	UCR,RXCIE		;AT90s8515,RX complete interrupt enable for hardware-UART
         		;sbi	UCSRB,RXCIE		;ATmega8515,RX complete interrupt enable for hardware-UART
00007c e042      		ldi	temp0,2;0x0F		;INT0 - sens control (falling edge)
00007d bf45      		out	MCUCR,temp0		;
00007e e440      		ldi	temp0,1<<INT0		;Enable external interrupt INT0
00007f bf4b      		out	GIMSK,temp0
         		;tldi	temp0,R
         		;tsts	str6,temp0
         		;trcall	u_init			;Initialize SUART (software uart)
         		;rcall	WriteTempBuf
         		
         		
000080 e0e4      		ldi 	zl,low(ireg)		;Load strinpointer
000081 e0f0      		ldi 	zh,high(ireg)
000082 d94c      		rcall	EERead			;Get initreg ireg
000083 7f2d      		cbr	tempchar,2		;Set SmsFlag=0
000084 7e2f      		cbr	tempchar,16		;Set CrFlag=0
000085 9320 0206 		sts	Bflags,tempchar
000087 e090      		ldi	flag,0			;init flag
000088 2744      		clr	temp0
         		;;sts	SmsFlag,temp0
000089 9340 01fa 		sts	Scount,temp0		;Clear source counter
00008b 9340 01fb 		sts	Mcount,temp0		;Clear moute counter
         ;--------------Init hardware-UART---------------------------------------------
00008d 2744      		clr	temp0
00008e 2f04      		mov	rxhead,temp0
00008f 2f14      		mov	rxtail,temp0
         		
         ;-------------------Init softuart----------------------------------------------		
000090 e0e1      		ldi 	zl,low(baudrates)		;Load strinpointer
000091 e0f0      		ldi 	zh,high(baudrates)
000092 d93c      		rcall	EERead				;Get Baud-rate
000093 2f42      		mov	temp0,tempchar
000094 9340 01c9 		sts	str6,temp0
000096 d07e      		rcall	u_init			;Initialize SUART (software uart)
         
000097 d076      		rcall 	spi_initM		;init spi
         
000098 da73      		rcall	GetTemp			;init temp
         ;----BitLength------------------------
000099 9631      		adiw	zl,1				;increase z
00009a d934      		rcall	EERead	
         		;ldi	temp0,(256-N+N1+8) 		;(256-N+8)
00009b 2f42      		mov	temp0,tempchar
00009c 9340 01d6 		sts	BL1,temp0			; reset T/C0 to one bit lenght
         		;ldi	temp0,(256-(N+N/2)+8+12+N2)	;(256-(N+N/2)+8+12);
00009e 9631      		adiw	zl,1				;increase z
00009f d92f      		rcall	EERead	
0000a0 2f42      		mov	temp0,tempchar
0000a1 9340 01d7 		sts	BL15,temp0 			; preset T/C0 to 1.5 bit lengths
         ;-----Buffer--------------------------		
0000a3 e040      		ldi	temp0,0
0000a4 9340 00d8 		sts	SUARTbuf,temp0		;init softuart buffer
         		
         ;------------------Init modeno------------------------------------------------
0000a6 e342      		ldi	temp0,'2'
         		;ldi	temp0,'0'  ;test
0000a7 9340 01d5 		sts	Mode,temp0
         ;-----------------Init volume-------------------------------------------------
         		;ldi	temp0,20
         		;sts	Svolume,temp0
         ;test********************
         	
         	;	rcall	timer1_init
         ;********************************************************************
         ;* Main program
         ;********************************************************************
         
         		;sei					;povolit interrupty globalne
         ;------------------Init phone-------------------------------------------------
         		;sbi	UCR,RXCIE		;RX complete interrupt enable for hardware-UART
         		;BUTTON
         		;----------init phone---------------------------------------------	
         ;rev		ldi 	zl,low(ireg)		;Load strinpointer
         ;rev		ldi 	zh,high(ireg)
         ;rev		rcall	EERead			;Get initreg ireg
         		;;mov	temp0,tempchar
         		;;sts	Bflags,tempchar		;Init box flags reg
         ;rev		sbrc	tempchar,1
         ;		rcall	PhoneInit00      ;rcall 	PhoneInit
         	
         		;rcall	LongDelay
         		;rcall	LongDelay
         		;rcall	LongDelay
         		;rcall	LongDelay
         			;----Set Delay Value---------------------
         	;	ldi	temp0,0x20
         	;	sts	DelayV,temp0
         	;	ldi	temp0,0x50
         	;	sts	DelayV+1,temp0
         	;	ldi	temp0,0x01
         	;	sts	DelayV+2,temp0
0000a9 d693      		rcall	ClearTempBuf
0000aa d69d      		rcall	ClearBuf
0000ab d6a0      		rcall	ClearSuartBuf
         		;clr	u_data
0000ac 2744      		clr	temp0
0000ad 2f04      		mov	rxhead,temp0
0000ae 2f14      		mov	rxtail,temp0
0000af 9340 0150 		sts	TempBuf,temp0
         		;ldi	temp0,'0' ;0
0000b1 e341      		ldi	temp0,'1'
0000b2 9340 01d5 		sts	Mode,temp0
         		;;ldi	temp0,'0'
         		;;sts	CrFlag,temp0
0000b4 d9fb      		rcall	ClearCrFlag		;Clear CrFlag
         		;--Clear all SMS----------------------------
0000b5 e0e4      		ldi 	zl,low(ireg)		;Load strinpointer
0000b6 e0f0      		ldi 	zh,high(ireg)
0000b7 d917      		rcall	EERead			;Get initreg ireg
0000b8 2f42      		mov	temp0,tempchar
0000b9 fd41      		sbrc	temp0,1
0000ba c001      		rjmp	initphone00
0000bb c003      		rjmp	initphone01
          initphone00:
         		;ssldi 	zl,low(2*atcmgd)			;Load strinpointer
         		;ssldi 	zh,high(2*atcmgd)
0000bc 9478      		sei
0000bd d632      		rcall	LongDelay
         		;ssrcall	PrintStr
0000be c001      		rjmp	initphone02
         		;Clear SoftUart-------------------------------------------------
          initphone01:
0000bf 9478      		sei
          initphone02:
0000c0 2755      		clr	u_Data
0000c1 d066      		rcall	putc
         		;test********************
0000c2 2744      		clr	temp0			 
0000c3 9340 01f9 		sts	Count,temp0		;clear time counter		
         		;;sts	pollFlag,temp0		;clear pollFlag	
0000c5 9140 0206 		lds	temp0,Bflags
0000c7 7f4e      		cbr	temp0,1
0000c8 9340 0206 		sts	Bflags,temp0
0000ca 2744      		clr	temp0
0000cb 9340 01ff 		sts	lampStatus,temp0	;clear lampStatus
         		;rcall	timer1_init
         		;init cmgr-par**********************************
         	;	sts	cmgrFlag,temp0
0000cd 9340 0200 		sts	SmsCount,temp0
         		
         		
         	;----------init poll---------------------------------------------	
0000cf e0e4      		ldi 	zl,low(ireg)		;Load strinpointer
0000d0 e0f0      		ldi 	zh,high(ireg)
0000d1 d8fd      		rcall	EERead			;Get initreg ireg
0000d2 2f42      		mov	temp0,tempchar
0000d3 fd40      		sbrc	temp0,0
0000d4 d91b      		rcall	initPoll
         		;clr	temp0
         		;sts	Count,temp0		;clear time counter
         		;ldi	temp0,1
         		;sts	pollFlag,temp0		;set pollFlag	
         		;rcall	timer1_init
0000d5 e04f      		ldi 	temp0,0b00001111	;Set watchdog
0000d6 bd41      		out 	wdtcr,temp0		;time out 1,0 s
         
         
         
         
         	;---------set pump in hot mode-----------------------------------	
0000d7 e622      		ldi	tempchar,'b'
0000d8 98c4      		cbi	portb,ss
0000d9 db68      		rcall	rw_spi
0000da 9ac4      		sbi	portb,ss
         	;---------Load RefTemp------------------------------------------	
0000db e1e9      		ldi 	zl,low(tempref)		;Load strinpointer
0000dc e0f0      		ldi 	zh,high(tempref)
0000dd d8f1      		rcall	EERead	
0000de 9320 0205 		sts	RefTemp,tempchar		
         		
         	;-----------End poll init----------------------------------------
         	
          Main:
0000e0 95a8      	wdr						;watchdog reset
0000e1 ece0      	ldi 	zl,low(2*ButtonIoA)				;Load strinpointer to commandlist 
0000e2 e1fe      	ldi 	zh,high(2*ButtonIoA)
0000e3 dc8c      	rcall	Ds2406_Status	
0000e4 ff22      	sbrs	tempchar,2	
         	;rcall	iotest
0000e5 dcb9      	rcall	PumpOnOff	
         	
0000e6 ecec      	ldi 	zl,low(2*ButtonIoA0)				;Load strinpointer to commandlist 
0000e7 e1fe      	ldi 	zh,high(2*ButtonIoA0)
0000e8 dc87      	rcall	Ds2406_Status	
0000e9 ff22      	sbrs	tempchar,2	
         	;rcall	iotest	
0000ea dcd6      	rcall	SetRefTemp
         	
         ;	lds	temp1,Bflags
         ;	sbrc	temp1,4
         ;	rcall	send
         ;	rjmp	wsend
         ;	cpi	flag,1
         ;	breq	wint0	
         ;	sbrc	temp1,5
         ;	rjmp	main				;Jump if ButtonLockFlag is set 
0000eb 9130 01f9 	lds	temp1,Count			;Load poll count
         
         
         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0000ed 3033      	cpi	temp1,3;50			
0000ee f409      	brne	lPoll
0000ef d910      	rcall	SharplPoll
         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
         
         ;	brge	lPoll		;breq	Lpoll
          lPoll:	
         	;--------Button poll------------
0000f0 b333      	in	temp1,pinc			;read portc
0000f1 7338      	andi	temp1,56			;get bit 0,1,2,3   1+2+4+8=15, If not 15 then Button 
         ;;;	andi	temp1,63;15			;get bit 0,1,2,3,4,5  1+2+4+8+16+32=63, If not 63 then Button 
         ;;;	ldi	temp0,63;15
0000f2 e348      	ldi	temp0,56
0000f3 1334      	cpse	temp1,temp0
0000f4 d8c8      	rcall	Button
         	;-------------------------------
         	
0000f5 cfea      	rjmp	main
         
         
         
         ;lPoll: 
         	;rcall	ViewSonicpoll
         ;	rcall	SharplPoll
         	;rcall	Barcopoll
         	;rcall	Panasonicpoll
         ;	rjmp	main	
         
         
         
         
         
         
         ;wsend:			;t
         ;	rcall	send	;t
         ;	rjmp	main	;t
         
         
          wint0:
         ;	lds	temp1,BL15
         ;	out	TCNT0,temp1 			; preset T/C0 to 1.5 bit lengths
         ;	ldi	temp1,1<<TOIE0
         ;	out	TIFR,temp1			; clear T/C0 overflow flag
         ;	out	TIMSK,temp1			; enable T/C0 overflow Interrupt
         ;	clr	bit_cnt				; clear bit counter
         ;wgetc1:	sbrs	u_stat,SRXC			; wait for Receive Complete
         ;	rjmp	wgetc1
         ;	cbr	u_stat,1<<SRXC			; clear SRXC
         ;	lds	temp1,SUARTbuf			;load buf length counter
         ;	inc	temp1				;increase counter
         ;	sts	SUARTbuf,temp1			;store counter
         ;	ldi	zl,low(SUARTbuf)
         ;	ldi	zh,high(SUARTbuf)
         ;	adc	zl,temp1
         ;	brcc	wgetcj
         ;	inc	zh
         ;wgetcj:	st	z,u_data			;store char in buffer		
         ;	breq	wflag
         ;	cpi	u_data,13    			;'cr' 
         ;	breq	wgetc2
         ;wflag:
         ;	ldi	flag,0
         ;	cbi	PORTD,6			;RTS Off
         ;	rjmp	main
         ;wgetc2:
         ;	
         ;	ldi	zl,low(SUARTbuf)			;load stringpointer
         ;	ldi	zh,high(SUARTbuf)
         ;	inc	temp1
         ;	adc	zl,temp1
         ;	brcc	wgetcj0
         ;	inc	zh
         ;wgetcj0:
         ;	clr	temp0					;terminate buffer	
         ;	st	z,temp0
         ;	ldi	zl,low(SUARTbuf)
         ;	ldi	zh,high(SUARTbuf)
         ;	adiw	zl,1
         ;	clr 	temp0
         ;	sts	SUARTbuf,temp0				;clear counter
         ;	ldi	flag,0
         ;	cbi	PORTD,6					;RTS Off
0000f6 9a96      	sbi	PORTD,6	
0000f7 d7a6      	rcall	ReadSoftUart
0000f8 9896      	cbi	PORTD,6
         	;-------Test for poll status----------------------------------------------------
         	;lds	tempchar,
         	;clr	temp0
         	;cpse	tempchar,temp0
         	;rcall	lampTest
         	;lds	tempchar,pollFlag
         	;cpi	tempchar,1
         	;breq	wgetcj1
         	;-------Send SMS if smsFlag is on else print-out buffer to hardware uart--------
0000f9 e5c0      	ldi	yl,low(TempBuf)
0000fa e0d1      	ldi	yh,high(TempBuf)
0000fb d65b      	rcall	MoveString
0000fc e5e0      	ldi	zl,low(TempBuf)
0000fd e0f1      	ldi	zh,high(TempBuf)
         	;;lds	tempchar,SmsFlag		;Load SmsFlag
         	;;ldi	temp0,1
         	;;cpse	tempchar,temp0
0000fe 9120 0206 	lds	tempchar,Bflags
000100 ff21      	sbrs	tempchar,1
000101 d514      	rcall	PrintBuf			;print-out buffer to uart
         	;;clr	temp0
         	;;cpse	tempchar,temp0			;Send SMS if SmsFlag on
000102 fd21      	sbrc	tempchar,1
000103 d6ff      	rcall	SendSms
          wgetcj1:
         	;---------------Init timer1 if pollFlag=1---------------------------------------------------
         	;;lds	tempchar,pollFlag
         	;;clr	temp0
         	;;cpse	tempchar,temp0
000104 9120 0206 	lds	tempchar,Bflags
000106 fd20      	sbrc	tempchar,0
000107 d014      	rcall	timer1_init	
         	;-------------------------------------------------------------------
         	;;clr	tempchar
         	;;sts	SmsFlag,tempchar		;Set SmsFlag off
         	;lds	tempchar,Bflags
         	;cbr 	tempchar,2
         	;sts	Bflags,tempchar
000108 d9a1      	rcall	ClearSmsFlag			;Clear SmsFlag	
         	;-----------------------------------------------------------------------------
         	;sts	pollFlag,tempchar		;Clear pollFlag
000109 cfd6      	rjmp	main
         
          wtest:
00010a d4fc      	rcall	test
00010b cfd4      	rjmp	main
          wwritetempbuf:	
         ;	rcall	WriteTempBuf
00010c cfd3      	rjmp	main
         	
         ;wsend:	
         ;	rcall	send
         ;	rjmp	main
         	
         	;	rcall	test
         	;	rcall	GetStringData
         	
         	
         	
         	;	ldi 	zl,low(2*Ver)			;Load stringpointer source
         	;	ldi 	zh,high(2*Ver)
         	;	ldi	yl,low(TempBuf)			;Load stringpointer destination
         	;	ldi	yh,high(TempBuf)
         	;	rcall	StrSearch
00010d cfd2      		rjmp	Main
         ;********************************************************************
         ;* Main program END
         ;********************************************************************
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	SPI_initM
         ;*
         ;* DESCRIPTION
         ;*	Initialize SPI.
         ;*
         ;***************************************************************************
         
          spi_initM:	
00010e 98be      	cbi	ddrb,miso
00010f 9abd      	sbi	ddrb,mosi
000110 9abf      	sbi	ddrb,sck
000111 9abc      	sbi	ddrb,ss		
         	;sbi	ddrd,ss1
         	;sbi	ddrd,ss2
000112 9aa0      	sbi	ddrc,ss1
000113 9aa1      	sbi	ddrc,ss2
         ;	cbi	portb,miso
         ;	sbi	portb,mosi
         ;	sbi	portb,sck
         ;	sbi	portb,ss
         	
         
         
         ;	in	temp0,portb
         ;	andi	temp0,0b11000011
         ;	ori	temp0,0b00101100
         ;	out	portb,temp0
         	
         	
         ;	in	temp0,ddrb
         ;	andi	temp0,0b11000011
         ;	ori	temp0,0b00101100
         ;	out	ddrb,temp0
         
         ;	cbi	ddrb,miso
         ;	sbi	ddrb,mosi
         ;	sbi	ddrb,sck
         ;	sbi	ddrb,ss	
         
         ;	sbi	spcr,spie			;Slave Spi Interrupt Enable
         ;	cbi	spcr,spie			;Master 	
         ;	sbi	spcr,spe
         ;	cbi	spcr,dord
         ;	sbi	spcr,mstr			;Master mode
         ;	cbi	spcr,mstr			;Slave mode
         ;	cbi	spcr,cpol
         ;	cbi	spcr,cpha
         ;	sbi	spcr,spr1
         ;	sbi	spcr,spr0
         
         ;	ldi	temp0,0b01010011
         ;	out	spcr,temp0
         
         
         ;	cbi	spsr,spif
         	;ldi	temp0,0B11011011
         ;	ldi	temp0,0B01011111		;Set up spi control register for master
         ;	ldi	temp0,0B11001011		;Set up spi control register for slave
         ;	out	spcr,temp0
         	
         ;	in	temp0,spsr
         ;	in	temp0,spdr
         
000114 9508      	ret
         
         
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	u_init
         ;*
         ;* DESCRIPTION
         ;*	Initialize SUART.
         ;*
         ;***************************************************************************
         
000115 e081      u_init:	ldi	u_stat,1<<STXC	; set STXC
000116 9130 01c9 	lds	temp1,Str6	; set clock rate
         	;ldi	temp1,R		
000118 bf33      	out	TCCR0,temp1
000119 9abb      	sbi	DDRB,STXPIN	; initialize SUART pins
00011a 988a      	cbi	DDRD,SRXPIN
00011b 9508      	ret
         
         ;-------------------------------------------------------------------------------
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	timer1_init
         ;*
         ;* DESCRIPTION
         ;*	Initialize timer1
         ;*
         ;***************************************************************************
          timer1_init:	
         
         	;lds	temp1,Str6	; set clock rate
00011c e035      	ldi	temp1,5	
00011d bd3e      	out	TCCR1b,temp1
         
         	;*****************************
00011e e830      	ldi	temp1,1<<TOV1	; enable T/C0 overflow interrupt
00011f bf39      	out	TIMSK,temp1
         	;******************************
000120 e030      	ldi	temp1,0;(256-(N+N/2)+8+12);
000121 bd3d      	out	TCNT1H,temp1 			; preset T/C0 to 1.5 bit lengths
000122 e030      	ldi	temp1,256
000123 bd3c      	out	TCNT1L,temp1
000124 e830      	ldi	temp1,1<<TOIE1
000125 bf38      	out	TIFR,temp1			; clear T/C0 overflow flag
000126 bf39      	out	TIMSK,temp1			; enable T/C0 overflow Interrupt
000127 9508      	ret
         
         ;-------------------------------------------------------------------------------
         
         
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	putc
         ;*
         ;* DESCRIPTION
         ;*	Send a character on the UART Tx line.
         ;*
         ;***************************************************************************
         
          putc:	
000128 2788      	clr	u_stat		; clear UART status flags
000129 2777      	clr	bit_cnt		; clear bit counter
00012a e032      	ldi	temp1,1<<TOV0	; enable T/C0 overflow interrupt
00012b bf39      	out	TIMSK,temp1
00012c ff80      putc0:	sbrs	u_stat,STXC	; while (!(u_stat & STXC)); // Wait for STXC
00012d cffe      	rjmp	putc0
00012e 9508      	ret
         ;---------------------------------------------------------------------------------
         ;---------------------------------------------------------------------------------------------
         ;***********************************************************************
         ;*
         ;* FUNCTION
         ;*    PutcHardUart
         ;*
         ;* DESCRIPTION
         ;*    Send a character on the Hard Uart Tx line
         ;*
         ;* PARAMETER
         ;*   tempchar
         ;*
         ;***********************************************************************
          PutcHardUart: 
00012f 9a53      		sbi	ucr,txen		;AT90s8515,set sender bit
         		;sbi	ucsrb,txen		;ATmega8515,set sender bit
000130 9b5d      		sbis	usr,udre		;AT90s8515,wait till register is cleared
         		;sbis	ucsra,udre		;ATmega8515,wait till register is cleared
000131 cffd      		rjmp	PutcHardUart
000132 b92c      		out	udr,tempchar		;send the byte
         
000133 9508      		ret
         ;---------------------------------------------------------------------------------------------
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	getc
         ;*
         ;* DESCRIPTION
         ;*	Wait for start bit and receive a character on the SUART Rx line.
         ;*
         ;***************************************************************************
         
000134 9b82      getc:	sbis	PIND,SRXPIN
000135 cffe      	rjmp	getc
000136 9982      getc0:	sbic	PIND,SRXPIN
000137 cffe      	rjmp	getc0
         	;tldi	temp1,(256-(N+N/2)+8+12);
000138 9130 01d7 	lds	temp1,BL15
00013a bf32      	out	TCNT0,temp1 			; preset T/C0 to 1.5 bit lengths
00013b e032      	ldi	temp1,1<<TOIE0
00013c bf38      	out	TIFR,temp1			; clear T/C0 overflow flag
00013d bf39      	out	TIMSK,temp1			; enable T/C0 overflow Interrupt
00013e 2777      	clr	bit_cnt				; clear bit counter
00013f ff81      getc1:	sbrs	u_stat,SRXC			; wait for Receive Complete
000140 cffe      	rjmp	getc1
000141 7f8d      	cbr	u_stat,1<<SRXC			; clear SRXC
000142 9508      	ret
         
         
         ;---------------------------------------------------------------------------------
          send:	
000143 9a96      		sbi	PORTD,6
         		;;clr	temp1
         		;;sts	CrFlag,temp1
000144 d96b      		rcall	ClearCrFlag		;Clear CrFlag
000145 e5c0      		ldi	yl,low(TempBuf)
000146 e0d1      		ldi	yh,high(TempBuf)
          lsend:
         		;ld	tempchar,y+		;Load byte from program memory into tempchar
         		;tst	tempchar		;Test if we have reached the end of the string
         		;brne	lsend			;If so, go to lsend
         		;dec	yl
         		
          lsend0:		
000147 d49b      		rcall 	Rs232GetByte
          lsend1:					;----------
         	;	sbi	ucr,txen	;set sender bit
         	;	sbis	usr,udre	;wait till register is cleared
         	;	rjmp	lsend1
         	;	out	udr,tempchar	;send the recived valuable
         		;-------------------------------------------
000148 9329      		st	y+,tempchar
         		
         	;cbi	ucr,txen	;clear sender bit
         ;		rcall	Rs232GetByte	
         ;		out	udr,tempchar	;send the recived valuable
         ;WaitForRS232Send:
         ;		sbis	UCR,TXEN			;ak nie je povoleny UART vysielac
         ;		rjmp	OneZeroAnswer			;tak skonci - ochrana kvoli zacykleniu v AT90S2323/2343
         ;		sbis	USR,TXC				;pockat na dovysielanie bytu
         ;		rjmp	WaitForRS232Send	
         ;OneZeroAnswer:	
000149 3020      		cpi	tempchar,0     
00014a f7e1      		brne	lsend0
          lsend2:
                                    
                         
                         ;------Test for suart=----------------------------------------
         ;Testforsuart:	
00014b e0e2      		ldi 	zl,low(2*SUART)			;Load stringpointer source
00014c e1fc      		ldi 	zh,high(2*SUART)
00014d e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
00014e 93cf      		push	yl
00014f e0d1      		ldi	yh,high(TempBuf)
000150 d4f4      		rcall	StrSearch
         		;tst	yl;T	
         		;breq	Testformo;T
000151 9724      		sbiw	yl,4
000152 912f      		pop	tempchar
000153 17c2      		cp	yl,tempchar
000154 f411      		brne	Testforsettempref
000155 9624      		adiw	yl,4
000156 c12e      		rjmp	ActionSuart
         		;------Test for SetTempRef=----------------------------------------------------
          Testforsettempref:
000157 edec      		ldi 	zl,low(2*settempref)		;Load stringpointer source
000158 e1fc      		ldi 	zh,high(2*settempref)
000159 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
00015a 93cf      		push	yl
00015b e0d1      		ldi	yh,high(TempBuf)
00015c d4e8      		rcall	StrSearch
00015d 972a      		sbiw	yl,10
00015e 912f      		pop	tempchar
00015f 17c2      		cp	yl,tempchar
000160 f411      		brne	Testforstxetx
000161 962a      		adiw	yl,10
000162 c14b      		rjmp	ActionSetTempRef
         
         		;------Test for stxetx=-----------------------------------------------------
          Testforstxetx:
000163 e9e8      		ldi 	zl,low(2*stxetx)		;Load stringpointer source
000164 e1fc      		ldi 	zh,high(2*stxetx)
000165 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
000166 93cf      		push	yl
000167 e0d1      		ldi	yh,high(TempBuf)
000168 d4dc      		rcall	StrSearch
000169 9726      		sbiw	yl,6
00016a 912f      		pop	tempchar
00016b 17c2      		cp	yl,tempchar
00016c f411      		brne	Testforstxetx0
00016d 9626      		adiw	yl,6
00016e c18c      		rjmp	ActionStxEtx
         		;------Test for stxetx0=--------------------------------------------------------------------
          Testforstxetx0:
00016f eae0      		ldi 	zl,low(2*stxetx0)		;Load stringpointer source
000170 e1fc      		ldi 	zh,high(2*stxetx0)
000171 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
000172 93cf      		push	yl
000173 e0d1      		ldi	yh,high(TempBuf)
000174 d4d0      		rcall	StrSearch
000175 9727      		sbiw	yl,7
000176 912f      		pop	tempchar
000177 17c2      		cp	yl,tempchar
000178 f411      		brne	TestforSetTargetPno
000179 9627      		adiw	yl,7
00017a c1a2      		rjmp	ActionStxEtx10	
         		;------Test for SetTargetPno=---------------------------------------------------------------
          TestforSetTargetPno:
00017b ebe2      		ldi 	zl,low(2*settargetpno)		;Load stringpointer source
00017c e1fc      		ldi 	zh,high(2*settargetpno)
00017d e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
00017e 93cf      		push	yl
00017f e0d1      		ldi	yh,high(TempBuf)
000180 d4c4      		rcall	StrSearch
000181 972c      		sbiw	yl,12
000182 912f      		pop	tempchar
000183 17c2      		cp	yl,tempchar
000184 f411      		brne	TestforSetPassPno
000185 962c      		adiw	yl,12
000186 c1c1      		rjmp	ActionSetTargetPno			
         		;-------Test for SetPassPno=------------------------------------------------------
          TestforSetPassPno:
000187 ece0      		ldi 	zl,low(2*setpasspno)		;Load stringpointer source
000188 e1fc      		ldi 	zh,high(2*setpasspno)
000189 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
00018a 93cf      		push	yl
00018b e0d1      		ldi	yh,high(TempBuf)
00018c d4b8      		rcall	StrSearch
00018d 972a      		sbiw	yl,10
00018e 912f      		pop	tempchar
00018f 17c2      		cp	yl,tempchar
         		;brne	Testforabsent
000190 f411      		brne	TestforSetCustomerNo
000191 962a      		adiw	yl,10
000192 c1a1      		rjmp	ActionSetPassPno
         		;------Testfor SetCustomerNo=-----------------------------------------------------
          TestforSetCustomerNo:				
000193 ecec      		ldi 	zl,low(2*setcustomerno)		;Load stringpointer source
000194 e1fc      		ldi 	zh,high(2*setcustomerno)
000195 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
000196 93cf      		push	yl
000197 e0d1      		ldi	yh,high(TempBuf)
000198 d4ac      		rcall	StrSearch
000199 972d      		sbiw	yl,13
00019a 912f      		pop	tempchar
00019b 17c2      		cp	yl,tempchar
00019c f411      		brne	Testforabsent
00019d 962d      		adiw	yl,13
00019e c19f      		rjmp	ActionSetCustomerno
         		
         		;------Test for absent------------------------------------------------------
          Testforabsent:	
00019f e9e2      		ldi 	zl,low(2*sspi)			;Load stringpointer source
0001a0 e1fc      		ldi 	zh,high(2*sspi)
0001a1 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
0001a2 93cf      		push	yl
0001a3 e0d1      		ldi	yh,high(TempBuf)
0001a4 d4a0      		rcall	StrSearch
0001a5 9724      		sbiw	yl,4
0001a6 912f      		pop	tempchar
0001a7 17c2      		cp	yl,tempchar
0001a8 f411      		brne	Testformo
0001a9 9624      		adiw	yl,4
0001aa c1d6      		rjmp	ActionSspi;ActionAbsent
         		;-----Test for mo=----------------------------------------------
          Testformo:		
0001ab e0ee      		ldi 	zl,low(2*modeno)		;Load stringpointer source
0001ac e1fc      		ldi 	zh,high(2*modeno)
0001ad e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
0001ae 93cf      		push	yl	
0001af e0d1      		ldi	yh,high(TempBuf)
0001b0 d494      		rcall	StrSearch
0001b1 9722      		sbiw	yl,2
0001b2 912f      		pop	tempchar
0001b3 17c2      		cp	yl,tempchar
         		;tst	yl	
         		;breq	Testmodeno
0001b4 f411      		brne	TestforBaud
0001b5 9622      		adiw	yl,2
0001b6 c25a      		rjmp	ActionModeno
         		;------Test for Baud-Rate-------------------------------------------		
          TestforBaud:	
0001b7 e0e8      		ldi 	zl,low(2*baud)			;Load stringpointer source
0001b8 e1fc      		ldi 	zh,high(2*baud)
0001b9 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
0001ba 93cf      		push	yl
0001bb e0d1      		ldi	yh,high(TempBuf)
0001bc d488      		rcall	StrSearch
0001bd 9724      		sbiw	yl,4
0001be 912f      		pop	tempchar
0001bf 17c2      		cp	yl,tempchar
0001c0 f411      		brne	TestforLamp
0001c1 9624      		adiw	yl,4
0001c2 c271      		rjmp	ActionBaud
         		;------Test for Lamp-Time-------------------------------------------		
          TestforLamp:	
0001c3 e8ec      		ldi 	zl,low(2*lamptime)			;Load stringpointer source
0001c4 e1fc      		ldi 	zh,high(2*lamptime)
0001c5 e5c0      		ldi	yl,low(TempBuf)				;Load stringpointer destination
0001c6 93cf      		push	yl
0001c7 e0d1      		ldi	yh,high(TempBuf)
0001c8 d47c      		rcall	StrSearch
0001c9 9724      		sbiw	yl,4
0001ca 912f      		pop	tempchar
0001cb 17c2      		cp	yl,tempchar
0001cc f411      		brne	TestforPoll
0001cd 9624      		adiw	yl,4
0001ce c36e      		rjmp	ActionLamp
         		;-----Test for poll--------------------------------------------------
          TestforPoll:
0001cf eaec      		ldi 	zl,low(2*poll)				;Load stringpointer source
0001d0 e1fc      		ldi 	zh,high(2*poll)
0001d1 e5c0      		ldi	yl,low(TempBuf)				;Load stringpointer destination
0001d2 93cf      		push	yl
0001d3 e0d1      		ldi	yh,high(TempBuf)
0001d4 d470      		rcall	StrSearch
0001d5 9723      		sbiw	yl,3
0001d6 912f      		pop	tempchar
0001d7 17c2      		cp	yl,tempchar
0001d8 f411      		brne	TestforCMTI
0001d9 9623      		adiw	yl,3
0001da c3a1      		rjmp	ActionPoll
         		
                         ;------Test for +CMTI------------------------------------------------
          TestforCMTI:                
0001db e3e4                      ldi 	zl,low(2*cmti)			;Load stringpointer source
0001dc e1fc      		ldi 	zh,high(2*cmti)
0001dd e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
0001de e0d1      		ldi	yh,high(TempBuf)
0001df d465      		rcall	StrSearch
0001e0 23cc      		tst	yl	
0001e1 f009      		breq	TestforCMTI2
0001e2 c1d3      		rjmp	ActionCMTI
         
                         ;------Test for +CMTI2---------------------------------------------------
          TestforCMTI2:   
         		            
0001e3 e3e4                      ldi 	zl,low(2*cmti)			;Load stringpointer source
0001e4 e1fc      		ldi 	zh,high(2*cmti)
0001e5 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
0001e6 e0d1      		ldi	yh,high(TempBuf)
0001e7 d45d      		rcall	StrSearch
0001e8 23cc      		tst	yl	
0001e9 f009      		breq	TestforCMGL
0001ea c1d8      		rjmp	ActionCMTI2		
         		
         		;------Test for +CMGL: 1---------------------------------------------
          TestforCMGL:		
         		;ldi 	zl,low(2*cmgl1)			;Load stringpointer source
         		;ldi 	zh,high(2*cmgl1)
0001eb e5e8      		ldi 	zl,low(2*cmgr)			;Load stringpointer source
0001ec e1fc      		ldi 	zh,high(2*cmgr)
0001ed e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
0001ee e0d1      		ldi	yh,high(TempBuf)
0001ef d455      		rcall	StrSearch
0001f0 23cc      		tst	yl	
0001f1 f009      		breq	TestforTrimBits
0001f2 c1d1      		rjmp	ActionCMGL
                         ;------Test for TrimBits---------------------------------------------
          TestforTrimBits:		
0001f3 eeee      		ldi 	zl,low(2*TrimBits)		;Load stringpointer source
0001f4 e1fb      		ldi 	zh,high(2*TrimBits)
0001f5 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
0001f6 e0d1      		ldi	yh,high(TempBuf)
0001f7 d44d      		rcall	StrSearch
0001f8 23cc      		tst	yl	
0001f9 f009      		breq	Testfornocarrier
0001fa c056      		rjmp	ActionTrimBits
         		;------Test for NO CARRIER----------------------------------------
          Testfornocarrier:	
0001fb e7e2      		ldi 	zl,low(2*nocarrier)			;Load stringpointer source
0001fc e1fc      		ldi 	zh,high(2*nocarrier)
0001fd e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
0001fe e0d1      		ldi	yh,high(TempBuf)
0001ff d445      		rcall	StrSearch
000200 23cc      		tst	yl	
000201 f009      		breq	TestforRing
000202 c2a2      		rjmp	ActionNoCarrier
         		;------Test for RING----------------------------------------
          TestforRing:	
000203 e7ee      		ldi 	zl,low(2*ring)			;Load stringpointer source
000204 e1fc      		ldi 	zh,high(2*ring)
000205 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
000206 e0d1      		ldi	yh,high(TempBuf)
000207 d43d      		rcall	StrSearch
000208 23cc      		tst	yl	
000209 f009      		breq	TestforEEprom
00020a c29e      		rjmp	ActionRing
         		;------Test for EEprom------------------------------------------
          TestforEEprom:
         		;ldi 	zl,low(2*eeprom)		;Load stringpointer source
         		;ldi 	zh,high(2*eeprom)
         		;ldi	yl,low(TempBuf)			;Load stringpointer destination
         		;ldi	yh,high(TempBuf)
         		;rcall	StrSearch
         		;tst	yl
         		;breq	TestforConnect
         		;rjmp	ActionEEprom 
00020b efec      		ldi 	zl,low(2*eeprom)			;Load stringpointer source
00020c e1fb      		ldi 	zh,high(2*eeprom)
00020d e5c0      		ldi	yl,low(TempBuf)				;Load stringpointer destination
00020e 93cf      		push	yl
00020f e0d1      		ldi	yh,high(TempBuf)
000210 d434      		rcall	StrSearch
000211 9723      		sbiw	yl,3
000212 912f      		pop	tempchar
000213 17c2      		cp	yl,tempchar
000214 f411      		brne	TestforConnect
000215 9623      		adiw	yl,3
000216 c293      		rjmp	ActionEEprom
         	
         		;------Test for CONNECT----------------------------------------
          TestforConnect:	
000217 e8e4      		ldi 	zl,low(2*connect)		;Load stringpointer source
000218 e1fc      		ldi 	zh,high(2*connect)
000219 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
00021a e0d1      		ldi	yh,high(TempBuf)
00021b d429      		rcall	StrSearch
00021c 23cc      		tst	yl	
00021d f009      		breq	TestforClock
00021e c39a      		rjmp	ActionConnect				
         		;-------Test for Clock----------------------------------------
          TestforClock:		
00021f ede0      		ldi 	zl,low(2*Clock)			;Load stringpointer source
000220 e1fb      		ldi 	zh,high(2*Clock)
000221 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
000222 e0d1      		ldi	yh,high(TempBuf)
000223 d421      		rcall	StrSearch
000224 23cc      		tst	yl	
000225 f569      		brne	ActionClock		
         		;------Test for ClearAC-----------------------------------------------
000226 ede6      		ldi 	zl,low(2*ClearAC)		;Load stringpointer source
000227 e1fb      		ldi 	zh,high(2*ClearAC)
000228 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
000229 e0d1      		ldi	yh,high(TempBuf)
00022a d41a      		rcall	StrSearch
00022b 23cc      		tst	yl	
00022c f561      		brne	ActionClearAC
         		;------Test for ReadCC--------------------------------------------
00022d edee      		ldi 	zl,low(2*ReadCC)		;Load stringpointer source
00022e e1fb      		ldi 	zh,high(2*ReadCC)
00022f e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
000230 e0d1      		ldi	yh,high(TempBuf)
000231 d413      		rcall	StrSearch
000232 23cc      		tst	yl	
000233 f509      		brne	ActionReadCC
         		;------Test for ClearCC-----------------------------------------------
000234 eee6      		ldi 	zl,low(2*ClearCC)		;Load stringpointer source
000235 e1fb      		ldi 	zh,high(2*ClearCC)
000236 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
000237 e0d1      		ldi	yh,high(TempBuf)
000238 d40c      		rcall	StrSearch
000239 23cc      		tst	yl	
00023a f4e1      		brne	ActionClearCC
         		;--------Test for Ver------------------------------------		
00023b efe8      		ldi 	zl,low(2*Ver)			;Load stringpointer source
00023c e1fb      		ldi 	zh,high(2*Ver)
00023d e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
00023e 93cf      		push	yl
00023f e0d1      		ldi	yh,high(TempBuf)
000240 d404      		rcall	StrSearch
         		;lds	tempchar,smsFlag
         		;clr	temp0
         		;cpse	tempchar,temp0
         		;sbiw	yl,2
000241 9722      		sbiw	yl,2
000242 912f      		pop	tempchar
000243 17c2      		cp	yl,tempchar
000244 f409      		brne	Testmodeno						
000245 c039      		rjmp	ActionVer
         
         		
         		
         		;------Test for getsubuf----------------------------------------------
          TestforGetsubuf:		
         	;	ldi 	zl,low(2*getsubuf)		;Load stringpointer source
         	;	ldi 	zh,high(2*getsubuf)
         	;	ldi	yl,low(TempBuf)			;Load stringpointer destination
         	;	ldi	yh,high(TempBuf)
         	;	rcall	StrSearch
         	;	tst	yl	
         	;	brne	Actiongetsubuf
         		
         		;----------------Test modeno-------------------------------
          Testmodeno:	
         	;;	lds	tempchar,SmsFlag
         	;;	cpi	tempchar,1
         	;;	breq	TestModeSms
000246 9120 0206 		lds	tempchar,Bflags
000248 fd21      		sbrc	tempchar,1
000249 c006      		rjmp	TestModeSms
00024a 9120 01d5 		lds	tempchar,Mode
00024c 3321      		cpi	tempchar,'1'
00024d f009      		breq	TestmodenoExit	;brne
00024e c36e      		rjmp	ConvertToSoftU
          TestmodenoExit:	
00024f c371      		rjmp	sendexit
          TestmodeSms:
000250 c384      		rjmp	TestModeSmsExit
         		
         		;-------------------------------------------------------------
         
         
         ;---------------------Load protocolregister Ds 1603------------------------------------
         
         
          ActionTrimBits:
000251 ed48      		ldi	temp0,216
000252 c007      		rjmp	ActionClock0
          ActionClock:
000253 e441      		ldi	temp0,65			
000254 c005      		rjmp	ActionClock0
          ActionReadCC:
000255 e841      		ldi	temp0,129
000256 c003      		rjmp	ActionClock0
          ActionClearCC:
000257 e044      		ldi	temp0,4		
000258 c001      		rjmp	ActionClock0
          ActionClearAC:		
000259 e042      		ldi	temp0,2
         
          ActionClock0:		
00025a eda1      		ldi	xl,low(LongWord)
00025b e0b1      		ldi	xh,high(LongWord)		;Load pointer to clock return value
00025c d4a0      		rcall	DsClock
         		
         
         		;---------Print high word-----------------
00025d ede1      		ldi	zl,low(LongWord)
00025e e0f1      		ldi	zh,high(LongWord)
00025f eca9      		ldi	xl,low(Str6)
000260 e0b1      		ldi	xh,high(Str6)
000261 d43d      		rcall	Itoa
000262 ece9      		ldi 	zl,low(Str6)			;Load strinpointer
000263 e0f1      		ldi 	zh,high(Str6)
         		;rcall	PrintBuf
000264 e5c0      		ldi	yl,low(TempBuf)			;t
000265 e0d1      		ldi	yh,high(TempBuf)		;t
000266 d4f0      		rcall	MoveString			;t
000267 e0e8      		ldi 	zl,low(2*Text1)			;Load strinpointer
000268 e1fd      		ldi 	zh,high(2*Text1)
         		;rcall	PrintStr
000269 9721      		sbiw	yl,1				;t
00026a d4f1      		rcall	MFTR				;t
00026b 93cf      		push	yl				;t
00026c 93df      		push	yh				;t
         		;--------Print low word----------------
00026d ede1      		ldi	zl,low(LongWord)
00026e e0f1      		ldi	zh,high(LongWord)
00026f 9631      		adiw	zl,1
000270 9631      		adiw	zl,1
000271 eca9      		ldi	xl,low(Str6)
000272 e0b1      		ldi	xh,high(Str6)
000273 d42b      		rcall	Itoa
000274 ece9      		ldi 	zl,low(Str6)			;Load strinpointer
000275 e0f1      		ldi 	zh,high(Str6)
         		;rcall	PrintBuf
000276 91df      		pop	yh				;t
000277 91cf      		pop	yl				;t
000278 9721      		sbiw	yl,1				;t
000279 d4dd      		rcall	MoveString			;t
00027a e0ee      		ldi 	zl,low(2*Text2)			;Load strinpointer
00027b e1fd      		ldi 	zh,high(2*Text2)
         		;rcall	PrintStr
00027c 9721      		sbiw	yl,1				;t
00027d d4de      		rcall	MFTR				;t
         		
         		;rjmp	sendexit0
00027e c348      		rjmp	sendexit1			;t		
         		
         		
          ActionVer:	
         		
         		
         		;ldi 	zl,low(Text4)			;Load strinpointer
         		;ldi 	zh,high(Text4)
         		
         		;ldi 	zl,$02			;Load strinpointer
         		;ldi 	zh,$00
         		;rcall	PrintEEtoSoftU
         		
         		
00027f eee8      		ldi 	zl,low(2*Text)			;Load strinpointer
000280 e1fc      		ldi 	zh,high(2*Text)
000281 e5c0      		ldi	yl,low(TempBuf)
000282 e0d1      		ldi	yh,high(TempBuf)
000283 d4d8      		rcall	MFTR
         		;ldi	zl,low(TempBuf)
         		;ldi	zh,high(TempBuf)
         		;lds	tempchar,SmsFlag
         		;cpi	tempchar,1
         		;breq	ActionVer1
         		;rcall	PrintBuf
         		;rcall	PrintStr
000284 c342      		rjmp	sendexit1
         ;ActionVer1:
         		
         		
         		;rcall	PrintSoftU
         		;rcall	SendSms
         		;clr	tempchar
         		;sts	SmsFlag,tempchar
         
         		;rjmp	sendexit0
         		
          ActionSuart:	
000285 2fec      		mov	zl,yl
000286 2ffd      		mov	zh,yh
000287 9631      		adiw	zl,1
         		;;lds	tempchar,SmsFlag
         		;;cpi	tempchar,0
         		;;breq	ActionSuart1
000288 9120 0206 		lds	tempchar,Bflags
00028a ff21      		sbrs	tempchar,1
00028b c00a      		rjmp	ActionSuart1
         		;----Eliminate cr and linefeed----------------------------------------
00028c 93ef      		push	zl
00028d 93ff      		push	zh
          ActionSuart0:	
00028e 9121      		ld	tempchar,z+		;Load byte from program memory into tempchar
00028f 2322      		tst	tempchar		;Test if we have reached the end of the string
000290 f7e9      		brne	ActionSuart0		;If not so, go to ActionSuart0
000291 9734      		sbiw	zl,4
000292 2722      		clr	tempchar
000293 8320      		st	z,tempchar
000294 91ff      		pop	zh
000295 91ef      		pop	zl
         		;----End of eliminat cr and linefeed-----------------------------------
          ActionSuart1:				
         		
000296 d389      		rcall	PrintSoftU
000297 d606      		rcall	ReadSoftUart			;t
000298 2744      		clr 	temp0				;t
000299 9340 0150 		sts	Tempbuf,temp0			;t
00029b e5c0      		ldi	yl,low(TempBuf)			;t
00029c e0d1      		ldi	yh,high(TempBuf)		;t
00029d ede8      		ldi	zl,low(SUARTbuf)		;t
00029e e0f0      		ldi	zh,high(SUARTbuf)		;t
00029f 9631      		adiw	zl,1
         		;pop	yh				;t
         		;pop	yl				;t
         		;sbiw	yl,1				;t
0002a0 d4b6      		rcall	MoveString			;t
         ;		rcall 	LongDelay
0002a1 d581      		rcall	SendSms0
0002a2 d807      		rcall	ClearSmsFlag		;ClearSmsFlag 
0002a3 2744      		clr	temp0
0002a4 9340 01f9 		sts	Count,temp0		;clear time counter	
0002a6 9140 0206 		lds	temp0,Bflags
0002a8 6041      		sbr	temp0,1
         ;		cbr	temp0,4
0002a9 9340 0206 		sts	Bflags,temp0
0002ab 2799      		clr	flag
0002ac de6f      		rcall	timer1_init
         		
         		
0002ad c315      		rjmp	sendexit0	
         		
         	        ;rjmp	sendexit0
         
         
         ;------------------------------------------------------------------------------------------
          ActionSetTempRef:
         	
         
         		
         	
0002ae 9621      		adiw	yl,1	
0002af 8148      		ld	temp0,y
0002b0 9621      		adiw	yl,1
0002b1 8128      		ld	tempchar,y
0002b2 9488      		clc
0002b3 5320      		subi	tempchar,48
0002b4 9488      		clc
0002b5 5340      		subi	temp0,48
0002b6 9488      		clc
0002b7 0f24      		add	tempchar,temp0
0002b8 0f24      		add	tempchar,temp0
0002b9 0f24      		add	tempchar,temp0
0002ba 0f24      		add	tempchar,temp0
0002bb 0f24      		add	tempchar,temp0
0002bc 0f24      		add	tempchar,temp0
0002bd 0f24      		add	tempchar,temp0
0002be 0f24      		add	tempchar,temp0
0002bf 0f24      		add	tempchar,temp0
0002c0 0f24      		add	tempchar,temp0
         	
         	;	rcall	PutcHardUart
         	
         	
         
0002c1 e1e9      		ldi 	zl,low(tempref)		;Load strinpointer
0002c2 e0f0      		ldi 	zh,high(tempref)
0002c3 d6fb      		rcall	EEWrite	
         				
         		
         		
0002c4 d42b      		rcall	LongDelay
0002c5 e524      		ldi	tempchar,'T'
0002c6 de68      		rcall	PutcHardUart
0002c7 e625      		ldi	tempchar,'e'
0002c8 de66      		rcall	PutcHardUart
0002c9 e62d      		ldi	tempchar,'m'
0002ca de64      		rcall	PutcHardUart
0002cb e720      		ldi	tempchar,'p'
0002cc de62      		rcall	PutcHardUart
0002cd e722      		ldi	tempchar,'r'
0002ce de60      		rcall	PutcHardUart
0002cf e625      		ldi	tempchar,'e'
0002d0 de5e      		rcall	PutcHardUart
0002d1 e626      		ldi	tempchar,'f'
0002d2 de5c      		rcall	PutcHardUart
0002d3 e32a      		ldi	tempchar,':'
0002d4 de5a      		rcall	PutcHardUart
0002d5 2722      		clr	tempchar
0002d6 9320 01d1 		sts	LongWord,tempchar
0002d8 e1e9      		ldi 	zl,low(tempref)		;Load strinpointer
0002d9 e0f0      		ldi 	zh,high(tempref)
0002da d6f4      		rcall	EERead	
0002db 9320 01d2 		sts	LongWord+1,tempchar
         		;---------Print low word-----------------
0002dd ede1      		ldi	zl,low(LongWord)
0002de e0f1      		ldi	zh,high(LongWord)
0002df eca9      		ldi	xl,low(Str6)
0002e0 e0b1      		ldi	xh,high(Str6)
0002e1 d3bd      		rcall	Itoa
0002e2 9120 01cc 		lds	tempchar,str6+3
0002e4 de4a      		rcall	PutcHardUart
0002e5 9120 01cd 		lds	tempchar,str6+4
0002e7 de47      		rcall	PutcHardUart
0002e8 e02d      		ldi	tempchar,13
0002e9 de45      		rcall	PutcHardUart
         	
         	
          ActionSetTempRefExit:		
         	
         	
         	
         	
         	
         
0002ea d7bf      		rcall	ClearSmsFlag		;ClearSmsFlag 
0002eb 2744      		clr	temp0
0002ec 9340 01f9 		sts	Count,temp0		;clear time counter	
0002ee 9140 0206 		lds	temp0,Bflags
0002f0 6041      		sbr	temp0,1
0002f1 9340 0206 		sts	Bflags,temp0
0002f3 de28      		rcall	timer1_init
0002f4 d448      		rcall	ClearTempBuf
0002f5 d452      		rcall	ClearBuf
0002f6 d455      		rcall	ClearSuartBuf
0002f7 2744      		clr	temp0
0002f8 2f04      		mov	rxhead,temp0
0002f9 2f14      		mov	rxtail,temp0
0002fa c2c8      		rjmp	sendexit0
         ;----------------------------------------------------------------------------
         				
          ActionStxEtx:
0002fb e320      		ldi	tempchar,48
0002fc de32      		rcall	PutcHardUart
0002fd 2fec      		mov	zl,yl
0002fe 2ffd      		mov	zh,yh
0002ff 9631      		adiw	zl,1
         		;lds	tempchar,SmsFlag
         		;cpi	tempchar,0
         		;breq	ActionStxEtx1
000300 9120 0206 		lds	tempchar,Bflags
000302 ff21      		sbrs	tempchar,1
000303 c00a      		rjmp	ActionStxEtx1
         		;----Eliminate cr and linefeed----------------------------------------
000304 93ef      		push	zl
000305 93ff      		push	zh
          ActionStxEtx0:	
000306 9121      		ld	tempchar,z+		;Load byte from program memory into tempchar
000307 2322      		tst	tempchar		;Test if we have reached the end of the string
000308 f7e9      		brne	ActionStxEtx0		;If not so, go to ActionSuart0
000309 9734      		sbiw	zl,4
00030a 2722      		clr	tempchar
00030b 8320      		st	z,tempchar
00030c 91ff      		pop	zh
00030d 91ef      		pop	zl
         		;----End of eliminat cr and linefeed-----------------------------------
          ActionStxEtx1:
00030e e052      		ldi	u_data,02				;Load byte
00030f de18      		rcall	putc	
000310 d30f      		rcall	PrintSoftU
000311 e053      		ldi	u_data,03				;Load byte
000312 de15      		rcall	putc	
         		;;clr	tempchar
         		;;sts	SmsFlag,tempchar
         		;lds	tempchar,Bflags
         		;cbr	tempchar,2
         		;sts	Bflags,tempchar
         		;ldi 	zl,low(ireg)		;Load strinpointer
         		;ldi 	zh,high(ireg)
         		;rcall	EERead			;Get initreg ireg
000313 d796      		rcall	ClearSmsFlag		;Clear SmsFlag
000314 e090      		ldi	flag,0
000315 2744      		clr	temp0			 
000316 9340 01f9 		sts	Count,temp0		;clear time counter
         		;;lds	tempchar,pollFlag
         		;;cpse	tempchar,temp0
000318 9120 0206 		lds	tempchar,Bflags
00031a fd20      		sbrc	tempchar,0
00031b de00      		rcall	timer1_init	
00031c c2a6      		rjmp	sendexit0
         		
         
         
         
          ActionStxEtx10:	
00031d 2fec      		mov	zl,yl
00031e 2ffd      		mov	zh,yh
00031f 9631      		adiw	zl,1
         		;lds	tempchar,SmsFlag
         		;cpi	tempchar,0
         		;breq	ActionStxEtx12
000320 9120 0206 		lds	tempchar,Bflags
000322 ff21      		sbrs	tempchar,1
000323 c00a      		rjmp	ActionStxEtx12
         		;----Eliminate cr and linefeed----------------------------------------
000324 93ef      		push	zl
000325 93ff      		push	zh	
          ActionStxEtx11:		
000326 9121      		ld	tempchar,z+		;Load byte from program memory into tempchar
000327 2322      		tst	tempchar		;Test if we have reached the end of the string
000328 f7e9      		brne	ActionStxEtx11		;If not so, go to ActionSuart0
000329 9734      		sbiw	zl,4
00032a 2722      		clr	tempchar
00032b 8320      		st	z,tempchar
00032c 91ff      		pop	zh
00032d 91ef      		pop	zl
         		;----End of eliminat cr and linefeed-----------------------------------		
          ActionStxEtx12:		
00032e e052      		ldi	u_data,02				;Load byte
00032f ddf8      		rcall	putc	
000330 d2ef      		rcall	PrintSoftU
000331 e053      		ldi	u_data,03				;Load byte
000332 ddf5      		rcall	putc	
000333 c28f      	        rjmp	sendexit0
         
         
         
         
          ActionSetPassPno:
000334 2fec      		mov	zl,yl
000335 2ffd      		mov	zh,yh
000336 9631      		adiw	zl,1
000337 e4c6      		ldi 	yl,low(pslistE)			;Load strinpointer
000338 e0d0      		ldi 	yh,high(pslistE)
000339 9120 0206 		lds	tempchar,Bflags
00033b ff21      		sbrs	tempchar,1
         ;		rjmp	ActionSetTargetPno2
         ;		rjmp 	ActionSetTargetPno00
00033c c031      		rjmp	ActionSetPassPno2
00033d c026      		rjmp	ActionSetPassPno1
          ActionSetCustomerNo:
00033e 2fec      		mov	zl,yl
00033f 2ffd      		mov	zh,yh
000340 9631      		adiw	zl,1
000341 ecc9      		ldi 	yl,low(customernoE)			;Load strinpointer
000342 e0d0      		ldi 	yh,high(customernoE)
000343 9120 0206 		lds	tempchar,Bflags
000345 ff21      		sbrs	tempchar,1
000346 c014      		rjmp	ActionSetTargetPno2
000347 c009      		rjmp 	ActionSetTargetPno00
         
         
         
          ActionSetTargetPno:
000348 2fec      		mov	zl,yl
000349 2ffd      		mov	zh,yh
00034a 9631      		adiw	zl,1
         		;;lds	tempchar,SmsFlag
         		;;cpi	tempchar,0
         		;;breq	ActionSetTargetPno1
00034b e0c7      		ldi 	yl,low(targetPno)			;Load strinpointer
00034c e0d0      		ldi 	yh,high(targetPno)
00034d 9120 0206 		lds	tempchar,Bflags
00034f ff21      		sbrs	tempchar,1
000350 c00a      		rjmp	ActionSetTargetPno1
         		
         
         		
         		;----Eliminate cr and linefeed----------------------------------------
          ActionSetTargetPno00:
000351 93ef      		push	zl
000352 93ff      		push	zh
          ActionSetTargetPno0:
000353 9121      		ld	tempchar,z+		;Load byte from program memory into tempchar
000354 2322      		tst	tempchar		;Test if we have reached the end of the string
000355 f7e9      		brne	ActionSetTargetPno0	;If not so, go to ActionSuart0
         		;sbiw	zl,4
000356 9735      		sbiw	zl,5
000357 2722      		clr	tempchar
000358 8320      		st	z,tempchar
000359 91ff      		pop	zh
00035a 91ef      		pop	zl
         		;----End of eliminat cr and linefeed-----------------------------------	
          ActionSetTargetPno1:
         		;ldi	u_data,02				;Load byte
         		;rcall	putc	
         		;rcall	PrintSoftU
         		;ldi	u_data,03				;Load byte
         		;rcall	putc
         		
         		
         	        
         
         ;---------------------------------------------------------------------------
         		
         ;		ldi 	yl,low(targetPno)			;Load strinpointer
         ;		ldi 	yh,high(targetPno)
         		;sbi	PORTD,6			;Set RTS On
          ActionSetTargetPno2:
00035b 8120      		ld	tempchar,z		;Load byte from program memory into tempchar
00035c d66a      		rcall	EEWriteY
00035d 2322      		tst	tempchar		;Test if we have reached the end of the string
00035e f019      		breq	ActionSetTargetPno3	;If so, quit
         		;mov	u_data,tempchar		;Load byte
         		;rcall	putc			;Send byte to soft-uart
00035f 9631      		adiw	zl,1			;increase z
000360 9621      		adiw	yl,1			;increase y
000361 cff9      		rjmp	ActionSetTargetPno2	;
          ActionSetTargetPno3:	
         		;cbi	PORTD,6			;Set RTS Off
         		;;clr	tempchar
         		;;sts	SmsFlag,tempchar
         		;lds	tempchar,Bflags
         		;cbr	tempchar,2
         		;sts	Bflags,tempchar
000362 d747      		rcall	ClearSmsFlag		
000363 c25f      		rjmp	sendexit0
         ;----------------------------------------------------------------------------
         		;----Eliminate cr and linefeed----------------------------------------
          ActionSetPassPno1:
         
          LineFeed:
         
000364 93ef      		push	zl
000365 93ff      		push	zh
          LineFeed0:
000366 9121      		ld	tempchar,z+		;Load byte from program memory into tempchar
000367 2322      		tst	tempchar		;Test if we have reached the end of the string
000368 f7e9      		brne	LineFeed0		;If not so, go to ActionSuart0
000369 9735      		sbiw	zl,5
00036a 2722      		clr	tempchar
00036b 8320      		st	z,tempchar
00036c 91ff      		pop	zh
00036d 91ef      		pop	zl
         		;----End of eliminat cr and linefeed-----------------------------------	
         
         
          ActionSetPassPno2:
         
00036e 8120      		ld	tempchar,z
00036f 5320      		subi	tempchar,48
         
000370 9631      		adiw	zl,1
          ActionSetPassPnoLoop:
000371 2322      		tst	tempchar
000372 f019      		breq	ActionSetPassPno3		
000373 962d      		adiw	yl,13
000374 952a      		dec	tempchar
000375 cffb      		rjmp	ActionSetPassPnoLoop
          ActionSetPassPno3:
         
         
000376 8120      		ld	tempchar,z		;Load byte from program memory into tempchar
000377 2322      		tst	tempchar		;Test if we have reached the end of the string
000378 f021      		breq	ActionSetPassPno4	;If so, quit
000379 d64d      		rcall	EEWriteY
00037a 9631      		adiw	zl,1			;increase z
00037b 9621      		adiw	yl,1			;increase y
00037c cff9      		rjmp	ActionSetPassPno3	;
          ActionSetPassPno4:	
00037d e220      		ldi	tempchar,32
00037e d648      		rcall	EEWriteY
         		;cbi	PORTD,6			;Set RTS Off
00037f d72a      		rcall	ClearSmsFlag		
000380 c242      		rjmp	sendexit0
         
         
         ;---------------------------------------------------------------------------------------------------------
         
         
         
         	        
         ;ActionAbsent:
          ActionSspi:
         		
         		
         		
000381 9621      		adiw	yl,1
000382 8128      		ld	tempchar,y	
000383 3320      		cpi	tempchar,48
000384 f021      		breq	ActionSspi_10
000385 3321      		cpi	tempchar,49
000386 f091      		breq	ActionSspi_20
000387 3322      		cpi	tempchar,50
000388 f0b1      		breq	ActionSspi_30
         		
          ActionSspi_10:		
000389 9621      		adiw	yl,1
00038a 8128      		ld	tempchar,y	
00038b 98c4      		cbi	portb,ss
00038c d8b5      		rcall	rw_spi		
00038d 9ac4      		sbi	portb,ss
         		
         		
00038e e726      		ldi	tempchar,'v'
00038f 98c4      		cbi	portb,ss
000390 d8b1      		rcall	rw_spi
000391 9ac4      		sbi	portb,ss
         		;mov	u_data,tempchar
         		;rcall	putc
000392 dd9c      		rcall	PutcHardUart
000393 e726      		ldi	tempchar,'v'
000394 98c4      		cbi	portb,ss
000395 d8ac      		rcall	rw_spi
000396 9ac4      		sbi	portb,ss
         		;mov	u_data,tempchar
         		;rcall	putc
000397 dd97      		rcall	PutcHardUart
000398 c00c      		rjmp	ActionSspiexit	
         		
          ActionSspi_20:		
000399 9621      		adiw	yl,1
00039a 8128      		ld	tempchar,y	
00039b 98a8      		cbi	portc,ss1
00039c d8a5      		rcall	rw_spi		
00039d 9aa8      		sbi	portc,ss1
00039e c006      		rjmp	ActionSspiexit
         		
          ActionSspi_30:		
00039f 9621      		adiw	yl,1
0003a0 8128      		ld	tempchar,y	
0003a1 98a9      		cbi	portc,ss2
0003a2 d89f      		rcall	rw_spi		
0003a3 9aa9      		sbi	portc,ss2
0003a4 c000      		rjmp	ActionSspiexit				
         		
         		
          ActionSspiexit:		
         		;ldi 	zl,low(2*atcmgd)	;Clear all sms
         		;ldi 	zh,high(2*atcmgd)
         		;rcall	PrintStr
         		;rcall	longdelay
         
         
0003a5 d704      		rcall	ClearSmsFlag		;ClearSmsFlag 
0003a6 2744      		clr	temp0
0003a7 9340 01f9 		sts	Count,temp0		;clear time counter
         		;;ldi	temp0,1
         		;;sts	pollFlag,temp0		;set pollFlag	
0003a9 9140 0206 		lds	temp0,Bflags
0003ab 6041      		sbr	temp0,1
0003ac 9340 0206 		sts	Bflags,temp0
         		;sts	lampStatus,temp0	;clear lampStatus
0003ae dd6d      		rcall	timer1_init
0003af d38d      		rcall	ClearTempBuf
0003b0 d397      		rcall	ClearBuf
0003b1 d39a      		rcall	ClearSuartBuf
0003b2 2744      		clr	temp0
0003b3 2f04      		mov	rxhead,temp0
0003b4 2f14      		mov	rxtail,temp0
0003b5 c20d      		rjmp	sendexit0
         
         ;		sbi	PORTD,6
         ;		mov	zl,yl
         ;		mov	zh,yh
         ;		adiw	zl,1
         		;;lds	tempchar,SmsFlag
         		;;cpi	tempchar,0
         		;;breq	ActionAbsent4
         ;		lds	tempchar,Bflags
         ;		sbrs	tempchar,1
         ;		rjmp	ActionAbsent4	
         		;----Eliminate cr and linefeed----------------------------------------
         ;		push	zl
         ;		push	zh
         ;ActionAbsent0:	
         ;		ld	tempchar,z+		;Load byte from program memory into tempchar
         ;		tst	tempchar		;Test if we have reached the end of the string
         ;		brne	ActionAbsent0		;If not so, go to ActionAbsent0
         ;		sbiw	zl,5
         ;		ldi	tempchar,'/'
         ;		st	z,tempchar
         ;		adiw	zl,1
         		;-----Add phoneno-----------------------------------------
         ;		mov	yl,zl
         ;		mov	yh,zh
         ;		ldi	zl,low(Phoneno)
         ;		ldi	zh,high(Phoneno)
         ;		rcall	MoveString
         		;clr	tempchar
         		;st	z,tempchar
         ;		pop	zh
         ;		pop	zl
         		;-----Add space--------------------------------------------
         ;		push	zl
         ;		push	zh
         ;		clr	temp0
         ;ActionAbsent2:		
         ;		ld	tempchar,z+		;Load byte from program memory into tempchar
         ;		inc	temp0			;Increace counter
         ;		tst	tempchar		;Test if we have reached the end of the string
         ;		brne	ActionAbsent2		;If not so, go to ActionAbsent2
         ;		sbiw	zl,1
         ;		dec	temp0
         ;ActionAbsent3:		
         ;		inc	temp0
         ;		ldi	tempchar,' '
         ;		st	z,tempchar
         ;		adiw	zl,1
         ;		cpi	temp0,32
         ;		brne	ActionAbsent3
         ;		clr	tempchar
         ;		st	z,tempchar	
         ;		pop	zh
         ;		pop	zl
         		;----End of eliminat cr and linefeed-----------------------------------
         ;ActionAbsent4:		
         		;sbi	PORTD,6				;Set RTS On
         ;		rcall	PrintSoftU
         	        ;cbi	PORTD,6				;Set RTS Off
         ;	        sbi	PORTD,6
         	        ;rjmp	sendexit0
         ;	        rjmp	sendexit2
         	        
         ;Actiongetsubuf:
         ;		ldi	zl,low(SUARTbuf)		;load stringpointer
         ;		ldi	zh,high(SUARTbuf)
         ;		lds	temp1,SUARTbuf			;load buf length counter
         ;		inc	temp1
         ;		add	zl,temp1
         ;		ldi	temp0,0				;terminate buffer	
         ;		st	z,temp0
         ;		sub	zl,temp1
         ;		adiw	zl,1
         ;		rcall	PrintBuf			;print-out buffer to uart
         ;		clr 	temp0
         ;		sts	SUARTbuf,temp0			;clear counter
         
         ;M		rjmp	sendexit0
          ActionCMTI:
         		;ejldi 	zl,low(TempBuf)			;Load strinpointer
         		;ejldi 	zh,high(TempBuf)
         		;mov	zl,yl
         		;mov	zh,yh
         		;adiw	zl,1
         		;rcall	PrintSoftU
         		;rcall printbuf
         		;ldi	u_data,'J'
         	        ;rcall	putc
         	        ;clr	tempchar
         		;sts	TempBuf,tempchar
0003b6 9896      		cbi	PORTD,6
0003b7 e041      		ldi	temp0,1
0003b8 9340 0200 		sts	SmsCount,temp0
         	;******************************
         	;	ldi 	zl,low(2*unread)			;Load strinpointer source
         	;	ldi 	zh,high(2*unread)
         	;	rcall	StrSearch
         	;	ldi	xl,low(phoneno)
         	;	ldi	xh,high(phoneno)
         ;ActionCMGL0:
0003ba 9621      		adiw	yl,1	
0003bb 9129      		ld	tempchar,y+
         		;mov	u_data,tempchar
         		;rcall	putc
0003bc 9320 0201 		sts	SmsNo,tempchar
0003be 9129      		ld	tempchar,y+
         		;mov	u_data,tempchar
         		;rcall	putc
0003bf 9320 0202 		sts	SmsNo+1,tempchar
         		;ld	tempchar,y+
         		;mov	u_data,tempchar
         		;rcall	putc
         		;ld	tempchar,y+
         		;mov	u_data,tempchar
         		;rcall	putc
         ;		st	x+,tempchar
         ;		cpi	tempchar,'"'
         ;		brne	ActionCMGL0
         ;		clr	tempchar
         ;		st	-x,tempchar
         		;******************************
0003c1 d4c6      		rcall	ReadSms00
         	        ;ldi 	zl,low(2*atcmgl)			;Load strinpointer
         		;ldi 	zh,high(2*atcmgl)
         		;tldi 	zl,low(2*atcmgr1)			;Load strinpointer
         		;tldi 	zh,high(2*atcmgr1)
         		;trcall	PrintStr
         		;cbi	PORTD,6
         		;trcall	LongDelay
         		;trcall	LongDelay
         		;trcall	LongDelay
         		;trcall	LongDelay
         	
0003c2 c200      	        rjmp	sendexit0
          ActionCMTI2:
         		;cbi	PORTD,6
         		;ldi 	zl,low(2*atcmgr2)			;Load strinpointer
         		;ldi 	zh,high(2*atcmgr2)
         		;rcall	PrintStr
         		;rcall	LongDelay
         		;rcall	LongDelay
         		;rcall	LongDelay
         		;rcall	LongDelay
0003c3 c1ff      	        rjmp	sendexit0	        
         	        
          ActionCMGL:
         		;------Get SMS Phoneno from sender-------------------------------------
         		;cbi	PORTD,6					;Set RTS On
0003c4 e6e0      		ldi 	zl,low(2*unread)			;Load strinpointer source
0003c5 e1fc      		ldi 	zh,high(2*unread)
0003c6 d27e      		rcall	StrSearch
0003c7 edab      		ldi	xl,low(phoneno)
0003c8 e0b1      		ldi	xh,high(phoneno)
          ActionCMGL0:	
0003c9 9129      		ld	tempchar,y+
0003ca 932d      		st	x+,tempchar
0003cb 3222      		cpi	tempchar,'"'
0003cc f7e1      		brne	ActionCMGL0
0003cd 2722      		clr	tempchar
0003ce 932e      		st	-x,tempchar
         		;------Securety check---------------------------------------------------
0003cf 93cf      		push	yl				;Save SMS message pointer on stack
0003d0 93df      		push	yh
0003d1 edcb      		ldi	yl,low(phoneno)
0003d2 e0d1      		ldi	yh,high(phoneno)
         ;		ldi	zl,low(2*pslist)
         ;		ldi	zh,high(2*pslist)		
         ;		rcall	StrSearchEE			;Check for matching phoneno in list	
         
0003d3 e4e6      		ldi	zl,low(pslistE)
0003d4 e0f0      		ldi	zh,high(pslistE)		
0003d5 d2ab      		rcall	StrSearchEEP			;Check for matching phoneno in list
         
0003d6 23ee      		tst	zl	
0003d7 f439      		brne	S00
0003d8 91df      		pop	yh
0003d9 91cf      		pop	yl
0003da e7e0      		ldi 	zl,low(2*atcmgd)		;Clear all sms
0003db e1fd      		ldi 	zh,high(2*atcmgd)
0003dc d22f      		rcall	PrintStr
0003dd d312      		rcall	longdelay
0003de c1e4      		rjmp	sendexit0
          S00:		
         		;------If Mode=0 printout Phoneno to softuart---------------------------
0003df 9120 01d5 		lds	tempchar,Mode
0003e1 3320      		cpi	tempchar,'0'
0003e2 f429      		brne	GetSmsMessage
0003e3 edeb      		ldi	zl,low(phoneno)
0003e4 e0f1      		ldi	zh,high(phoneno)
         		;ldi 	zl,low(2*comma2)			;Load stringpointer source
         		;ldi 	zh,high(2*comma2)
         		;rcall	StrSearch
         		
         		;mov	zl,yl
         		;mov	zh,yh
         		;adiw	zl,1
0003e5 d23a      		rcall	PrintSoftU
         		;clr	tempchar
         		;sts	TempBuf,tempchar
         		;rcall printbuf
0003e6 e05d      		ldi	u_data,13
0003e7 dd40      	        rcall	putc
         	        ;------Get SMS message------------------------------
          GetSmsMessage:
0003e8 91df      		pop	yh;securety
0003e9 91cf      		pop	yl;securety
0003ea 2fec      		mov	zl,yl
0003eb 2ffd      		mov	zh,yh
0003ec 9678      		adiw	zl,24
0003ed 93ef      		push	zl				;Save SMS message pointer on stack
0003ee 93ff      		push	zh
         		;----get end of SMS message----
0003ef e1ec      		ldi	zl,low(2*ok)
0003f0 e1fc      		ldi	zh,high(2*ok)
0003f1 d253      		rcall	StrSearch
0003f2 2722      		clr	tempchar
0003f3 932a      		st	-y,tempchar
0003f4 932a      		st	-y,tempchar
         		;-----print SMS message to SoftUart-----
0003f5 91ff      		pop	zh
0003f6 91ef      		pop	zl
         		;------------------------------
0003f7 e5c0      		ldi	yl,low(TempBuf)
0003f8 e0d1      		ldi	yh,high(TempBuf)
0003f9 9722      		sbiw	yl,2	
0003fa d35c      		rcall	MoveString
0003fb e5c0      		ldi	yl,low(TempBuf)
0003fc e0d1      		ldi	yh,high(TempBuf)
         		;;ldi	tempchar,1
         		;;sts	SmsFlag,tempchar		;Set SmsFlag on
0003fd d6a0      		rcall	SetSmsFlag			;Set SmsFlag 
0003fe 9120 0206 		lds	tempchar,Bflags
000400 6022      		sbr	tempchar,2
000401 9320 0206 		sts	Bflags,tempchar
000403 9120 0150 		lds	tempchar,TempBuf;+2		
000405 9896      		cbi	PORTD,6				;Set RTS Off
000406 e243      		ldi	temp0,'#'
000407 1324      		cpse	tempchar,temp0
000408 cd42      		rjmp	lsend2
         		;------------------------------
         		;sbi	PORTD,6				;Set RTS On
000409 e5e0      		ldi	zl,low(TempBuf)
00040a e0f1      		ldi	zh,high(TempBuf)
00040b 9631      		adiw	zl,1;3
         		;rcall	PrintSoftU
00040c d209      		rcall	PrintBuf
         		;rcall	LongDelay
00040d e02d      		ldi	tempchar,13
00040e dd20      		rcall	PutcHardUart
00040f d2e0      		rcall	LongDelay;t
         		;rcall	LongDelay;t
         		;ldi	tempchar,0
         		;sts	SmsFlag,tempchar		;Set SmsFlag on
         		;--Clear all SMS----------------------------
         		;ldi 	zl,low(2*atcmgd)			;Load strinpointer
         		;ldi 	zh,high(2*atcmgd)
         		;rcall	PrintStr
         	        ;trjmp	sendexit0
         	        ;cbi	PORTD,6				;Set RTS on
000410 cd32      	        rjmp	send	        
         
          ActionModeno:
         		
000411 9621      		adiw	yl,1
000412 8128      		ld	tempchar,y			;Get modeno
000413 3421      		cpi	tempchar,'A'			;Set toggle source video,data1
000414 f059      		breq	ActionModeno1
000415 3422      		cpi	tempchar,'B'			;Set toggle source video,data1,data2
000416 f081      		breq	ActionModeno2
000417 3320      		cpi	tempchar,48
000418 f0a8      		brlo	ExitModenoError
000419 3323      		cpi	tempchar,51
00041a f498      		brsh	ExitModenoError	
00041b 9320 01d5 		sts	Mode,tempchar			;Store modeno
00041d e1ec      		ldi 	zl,low(2*OK)			;Load strinpointer
00041e e1fc      		ldi 	zh,high(2*OK)
00041f c010      		rjmp	ExitModenoOk
          ActionModeno1:
000420 e0e5      		ldi 	zl,low(buttonFlag)		;Load strinpointer
000421 e0f0      		ldi 	zh,high(buttonFlag)
000422 e020      		ldi	tempchar,0
000423 d59b      		rcall	EEWrite	
000424 e1ec      		ldi 	zl,low(2*OK)			;Load strinpointer
000425 e1fc      		ldi 	zh,high(2*OK)
000426 c009      		rjmp	ExitModenoOk
          ActionModeno2:	
000427 e0e5      		ldi 	zl,low(buttonFlag)		;Load strinpointer
000428 e0f0      		ldi 	zh,high(buttonFlag)
000429 e021      		ldi	tempchar,1
00042a d594      		rcall	EEWrite	
00042b e1ec      		ldi 	zl,low(2*OK)			;Load strinpointer
00042c e1fc      		ldi 	zh,high(2*OK)
00042d c002      		rjmp	ExitModenoOk	
         		
          ExitModenoError:
00042e e2e0      		ldi	zl,low(2*Error)
00042f e1fc      		ldi	zh,high(2*Error)
          ExitModenoOk:		
000430 e5c0      		ldi	yl,low(TempBuf)
000431 e0d1      		ldi	yh,high(TempBuf)
000432 d329      		rcall	MFTR
000433 c193      		rjmp	sendexit1	
         		
          ActionBaud:
000434 9621      		adiw	yl,1
000435 8128      		ld	tempchar,y			;Get modeno
000436 3320      		cpi	tempchar,48
000437 f061      		breq	Action9600
000438 3321      		cpi	tempchar,49
000439 f0e9      		breq	Action19200
00043a 3322      		cpi	tempchar,50
00043b f169      		breq	Action38400
00043c 3323      		cpi	tempchar,51
00043d f1e9      		breq	Action57600
00043e 3324      		cpi	tempchar,52
         		;breq	Action115200
00043f f019      		breq	Action115200T
000440 e2e0      		ldi	zl,low(2*Error)
000441 e1fc      		ldi	zh,high(2*Error)
000442 c05e      		rjmp	ExitBaudError
          Action115200T:
000443 c049      		rjmp	Action115200
          Action9600:;----BitLength------------------------	
000444 e0e1      		ldi 	zl,low(baudrates)		;Load strinpointer
000445 e0f0      		ldi 	zh,high(baudrates)
000446 e022      		ldi	tempchar,2
000447 d577      		rcall	EEWrite	
000448 e042      		ldi	temp0,2
000449 9340 01c9 		sts	str6,temp0
00044b dcc9      		rcall	u_init				;Initialize SUART (software uart)	
         		;tldi	temp0,(256-N+N1+8) 		;(256-N+8)
00044c e62b      		ldi	tempchar,(256-170+13+8)
00044d 9631      		adiw	zl,1				;increase z
00044e d570      		rcall	EEWrite
00044f 9320 01d6 		sts	BL1,tempchar			; reset T/C0 to one bit lenght
         		;tldi	temp0,(256-(N+N/2)+8+12+N2)	;(256-(N+N/2)+8+12);
000451 e422      		ldi	tempchar,(256-(170+170/2)+8+12+45)	;(256-(N+N/2)+8+12);
000452 9631      		adiw	zl,1
000453 d56b      		rcall	EEWrite
000454 9320 01d7 		sts	BL15,tempchar 			; preset T/C0 to 1.5 bit lengths		
000456 c048      		rjmp	ExitBaudOk
          Action19200:;----BitLength---------------------------
000457 e0e1      		ldi 	zl,low(baudrates)			;Load strinpointer
000458 e0f0      		ldi 	zh,high(baudrates)
000459 e022      		ldi	tempchar,2
00045a d564      		rcall	EEWrite	
         		;ldi	temp0,2
00045b 9320 01c9 		sts	str6,tempchar
00045d dcb7      		rcall	u_init					;Initialize SUART (software uart)
00045e eb28      		ldi	tempchar,184;(256-79+8)
00045f 9631      		adiw	zl,1					;increase z
000460 d55e      		rcall	EEWrite
000461 9320 01d6 		sts	BL1,tempchar				; reset T/C0 to one bit lenght
000463 e92b      		ldi	tempchar,155;(256-(79+79/2)+8+12);
000464 9631      		adiw	zl,1
000465 d559      		rcall	EEWrite
000466 9320 01d7 		sts	BL15,tempchar 				; preset T/C0 to 1.5 bit lengths				
000468 c036      		rjmp	ExitBaudOk
         
          Action38400:;----BitLength------------------------		
000469 e0e1      		ldi 	zl,low(baudrates)			;Load strinpointer
00046a e0f0      		ldi 	zh,high(baudrates)
00046b e022      		ldi	tempchar,2
00046c d552      		rcall	EEWrite	
         		;ldi	temp0,2
00046d 9320 01c9 		sts	str6,tempchar
00046f dca5      		rcall	u_init					;Initialize SUART (software uart)
000470 ed2d      		ldi	tempchar,(256-43+8)
000471 9631      		adiw	zl,1					;increase z
000472 d54c      		rcall	EEWrite
000473 9320 01d6 		sts	BL1,tempchar				; reset T/C0 to one bit lenght
000475 ed24      		ldi	tempchar,(256-(43+43/2)+8+12);
000476 9631      		adiw	zl,1
000477 d547      		rcall	EEWrite
000478 9320 01d7 		sts	BL15,tempchar 				; preset T/C0 to 1.5 bit lengths		
00047a c024      		rjmp	ExitBaudOk
          Action57600:;----BitLength------------------------
00047b e0e1      		ldi 	zl,low(baudrates)			;Load strinpointer
00047c e0f0      		ldi 	zh,high(baudrates)
00047d e022      		ldi	tempchar,2
00047e d540      		rcall	EEWrite	
00047f 9320 01c9 		sts	str6,tempchar
000481 dc93      		rcall	u_init					;Initialize SUART (software uart)
000482 ee29      		ldi	tempchar,(256-31+8)
000483 9631      		adiw	zl,1					;increase z
000484 d53a      		rcall	EEWrite
000485 9320 01d6 		sts	BL1,tempchar				; reset T/C0 to one bit lenght			; reset T/C0 to one bit lenght
000487 ee26      		ldi	tempchar,(256-(31+31/2)+8+12);
000488 9631      		adiw	zl,1
000489 d535      		rcall	EEWrite
00048a 9320 01d7 		sts	BL15,tempchar 				; preset T/C0 to 1.5 bit lengths				
00048c c012      		rjmp	ExitBaudOk
          Action115200:;----BitLength------------------------
00048d e0e1      		ldi 	zl,low(baudrates)			;Load strinpointer
00048e e0f0      		ldi 	zh,high(baudrates)
00048f e021      		ldi	tempchar,1
000490 d52e      		rcall	EEWrite	
000491 9320 01c9 		sts	str6,tempchar
000493 dc81      		rcall	u_init					;Initialize SUART (software uart)
000494 ea29      		ldi	tempchar,(256-95+8)
000495 9631      		adiw	zl,1					;increase z
000496 d528      		rcall	EEWrite
000497 9320 01d6 		sts	BL1,tempchar				; reset T/C0 to one bit lenght	
000499 e826      		ldi	tempchar,(256-(95+95/2)+8+12);
00049a 9631      		adiw	zl,1
00049b d523      		rcall	EEWrite
00049c 9320 01d7 		sts	BL15,tempchar 				; preset T/C0 to 1.5 bit lengths				
00049e c000      		rjmp	ExitBaudOk		
          ExitBaudOk:;--------------------------------------		
00049f e1ec      		ldi 	zl,low(2*OK)				;Load strinpointer
0004a0 e1fc      		ldi 	zh,high(2*OK)
          ExitBaudError:
0004a1 e5c0      		ldi	yl,low(TempBuf)
0004a2 e0d1      		ldi	yh,high(TempBuf)
0004a3 d2b8      		rcall	MFTR
0004a4 c122      		rjmp	sendexit1						
         		
          ActionNoCarrier:
0004a5 e321      		ldi	tempchar,'1'
0004a6 9320 01d5 		sts	Mode,tempchar
0004a8 c11a      		rjmp	sendexit0
         		
         
          ActionRing:	
0004a9 c119      		rjmp	sendexit0
         		
          ActionEEprom:
0004aa 9621      		adiw	yl,1
0004ab 8128      		ld	tempchar,y			;Get value (On=1,Off=0)
0004ac 3320      		cpi	tempchar,48
0004ad f1e1      		breq	ActionGetBoxStatus
0004ae 3321      		cpi	tempchar,49	
0004af f039      		breq	ActionReset
0004b0 3322      		cpi	tempchar,50
0004b1 f081      		breq	ActionPumpOn
         		;breq	ActionButtonLock
0004b2 3323      		cpi	tempchar,51
         		;breq	ActionButtonUnLock
0004b3 f0c1      		breq	ActionPumpOff
         ;		cpi	tempchar,52
         ;		breq	ActionCustomerNoOn
         ;		cpi	tempchar,53
         ;		breq	ActionCustomerNoOff
         		
0004b4 e2e0      		ldi	zl,low(2*Error)
0004b5 e1fc      		ldi	zh,high(2*Error)
0004b6 c082      		rjmp	ExitBoxTest	
          ActionReset:	
0004b7 cfff      		rjmp	ActionReset
         
         
         ;ActionButtonLock:
         ;		ldi 	zl,low(ireg)		;Load strinpointer
         ;		ldi 	zh,high(ireg)
         		;set
         		;bld	tempchar,0			;Set bit 0 in ireg		
         ;		ldi	tempchar,39
         ;		rcall	EEWrite
         ;		rjmp	ActionReset
         		
         ;ActionButtonUnLock:
         ;		ldi 	zl,low(ireg)		;Load strinpointer
         ;		ldi 	zh,high(ireg)
         ;		ldi	tempchar,7
         ;		rcall	EEWrite
         ;		rjmp	ActionReset
         		
          ActionCustomerNoOn:
0004b8 e0e6      		ldi 	zl,low(fieldFlag)		;Load strinpointer
0004b9 e0f0      		ldi 	zh,high(fieldFlag)
0004ba e021      		ldi	tempchar,1
0004bb d503      		rcall	EEWrite
0004bc cffa      		rjmp	ActionReset
         
         
          ActionCustomerNoOff:		
0004bd e0e6      		ldi 	zl,low(fieldFlag)		;Load strinpointer
0004be e0f0      		ldi 	zh,high(fieldFlag)
0004bf e020      		ldi	tempchar,0
0004c0 d4fe      		rcall	EEWrite
0004c1 cff5      		rjmp	ActionReset			
         
         
          ActionPumpOn:
         	
0004c2 e1e8      		ldi 	zl,low(pumpflag)		;Load strinpointer
0004c3 e0f0      		ldi 	zh,high(pumpflag)
0004c4 e021      		ldi	tempchar,1
0004c5 d4f9      		rcall	EEWrite	
0004c6 d229      		rcall	LongDelay
0004c7 e42f      		ldi	tempchar,'O'
0004c8 dc66      		rcall	PutcHardUart
0004c9 e62e      		ldi	tempchar,'n'
0004ca dc64      		rcall	PutcHardUart
0004cb c00b      		rjmp	ActionPumpExit		
         	
         	
         		
         	
          ActionPumpOff:	
         		
0004cc e020      		ldi	tempchar,0
0004cd e1e8      		ldi 	zl,low(pumpflag)		;Load strinpointer
0004ce e0f0      		ldi 	zh,high(pumpflag)
0004cf d4ef      		rcall	EEWrite	
0004d0 d21f      		rcall	LongDelay	
0004d1 e42f      		ldi	tempchar,'O'
0004d2 dc5c      		rcall	PutcHardUart
0004d3 e626      		ldi	tempchar,'f'
0004d4 dc5a      		rcall	PutcHardUart
0004d5 e626      		ldi	tempchar,'f'
0004d6 dc58      		rcall	PutcHardUart
          ActionPumpExit:	
0004d7 e02d      		ldi	tempchar,13
0004d8 dc56      		rcall	PutcHardUart
0004d9 d5d0      		rcall	ClearSmsFlag		;ClearSmsFlag 
0004da 2744      		clr	temp0
0004db 9340 01f9 		sts	Count,temp0		;clear time counter	
0004dd 9140 0206 		lds	temp0,Bflags
0004df 6041      		sbr	temp0,1
0004e0 9340 0206 		sts	Bflags,temp0
0004e2 dc39      		rcall	timer1_init
0004e3 d259      		rcall	ClearTempBuf
0004e4 d263      		rcall	ClearBuf
0004e5 d266      		rcall	ClearSuartBuf
0004e6 2744      		clr	temp0
0004e7 2f04      		mov	rxhead,temp0
0004e8 2f14      		mov	rxtail,temp0
0004e9 c0d9      		rjmp	sendexit0
         
         
          ActionGetBoxStatus:		
0004ea d205      		rcall	LongDelay
0004eb e524      		ldi	tempchar,'T'
0004ec dc42      		rcall	PutcHardUart
0004ed e625      		ldi	tempchar,'e'
0004ee dc40      		rcall	PutcHardUart
0004ef e62d      		ldi	tempchar,'m'
0004f0 dc3e      		rcall	PutcHardUart
0004f1 e720      		ldi	tempchar,'p'
0004f2 dc3c      		rcall	PutcHardUart
0004f3 e32a      		ldi	tempchar,':'
0004f4 dc3a      		rcall	PutcHardUart
         
         
         		
         				
0004f5 95a8      		wdr
0004f6 2722      		clr	tempchar
0004f7 9320 01d1 		sts	LongWord,tempchar
0004f9 d7e8      		rcall	ReadDs18s20
0004fa 9320 01d2 		sts	LongWord+1,tempchar
         		;---------Print low word-----------------
0004fc ede1      		ldi	zl,low(LongWord)
0004fd e0f1      		ldi	zh,high(LongWord)
0004fe eca9      		ldi	xl,low(Str6)
0004ff e0b1      		ldi	xh,high(Str6)
000500 d19e      		rcall	Itoa
000501 9120 01cc 		lds	tempchar,str6+3
000503 dc2b      		rcall	PutcHardUart
000504 9120 01cd 		lds	tempchar,str6+4
000506 dc28      		rcall	PutcHardUart
000507 e22f      		ldi	tempchar,'/'
000508 dc26      		rcall	PutcHardUart
         		
         		
000509 e524      		ldi	tempchar,'T'
00050a dc24      		rcall	PutcHardUart
00050b e625      		ldi	tempchar,'e'
00050c dc22      		rcall	PutcHardUart
00050d e62d      		ldi	tempchar,'m'
00050e dc20      		rcall	PutcHardUart
00050f e720      		ldi	tempchar,'p'
000510 dc1e      		rcall	PutcHardUart
000511 e722      		ldi	tempchar,'r'
000512 dc1c      		rcall	PutcHardUart
000513 e625      		ldi	tempchar,'e'
000514 dc1a      		rcall	PutcHardUart
000515 e626      		ldi	tempchar,'f'
000516 dc18      		rcall	PutcHardUart
000517 e32a      		ldi	tempchar,':'
000518 dc16      		rcall	PutcHardUart
000519 2722      		clr	tempchar
00051a 9320 01d1 		sts	LongWord,tempchar
00051c e1e9      		ldi 	zl,low(tempref)		;Load strinpointer
00051d e0f0      		ldi 	zh,high(tempref)
00051e d4b0      		rcall	EERead	
00051f 9320 01d2 		sts	LongWord+1,tempchar
         		;---------Print low word-----------------
000521 ede1      		ldi	zl,low(LongWord)
000522 e0f1      		ldi	zh,high(LongWord)
000523 eca9      		ldi	xl,low(Str6)
000524 e0b1      		ldi	xh,high(Str6)
000525 d179      		rcall	Itoa
000526 9120 01cc 		lds	tempchar,str6+3
000528 dc06      		rcall	PutcHardUart
000529 9120 01cd 		lds	tempchar,str6+4
00052b dc03      		rcall	PutcHardUart
00052c e02d      		ldi	tempchar,13
00052d dc01      		rcall	PutcHardUart
         	
         
         
         
         ;		ldi	zl,low(Str6)
         ;		ldi	zh,high(Str6)
         		
         		
         		
         ;		adiw	zl,1
         ;		pop	yh				;t
         ;		pop	yl				;t
         ;		sbiw	yl,1				;t
         ;		rcall	MoveString			;t
         
         ;		sbiw	yl,1
         ;		ldi	temp0,'/'
         ;		st	y+,temp0
         ;		adiw	yl,1
         ;		push	yl
         ;		push	yh
         
         ;		clr	tempchar
         ;		sts	LongWord,tempchar
         ;		lds	tempchar,hour
         ;		sts	LongWord+1,tempchar
         		;---------Print low word-----------------
         ;		ldi	zl,low(LongWord)
         ;		ldi	zh,high(LongWord)
         ;		ldi	xl,low(Str6)
         ;		ldi	xh,high(Str6)
         ;		rcall	Itoa
         		
         		
         		
         		
         ;		ldi	zl,low(Str6)
         ;		ldi	zh,high(Str6)
         		
         		
         		
         ;		adiw	zl,1
         ;		pop	yh				;t
         ;		pop	yl				;t
         ;		sbiw	yl,1				;t
         ;		rcall	MoveString			;t
         	
         ;		sbiw	yl,1
         ;		ldi	temp0,'/'
         ;		st	y+,temp0
         ;		adiw	yl,1
         ;		push	yl
         ;		push	yh
         
         ;		clr	tempchar
         ;		sts	LongWord,tempchar
         ;		lds	tempchar,minute
         ;		sts	LongWord+1,tempchar
         		;---------Print low word-----------------
         ;		ldi	zl,low(LongWord)
         ;		ldi	zh,high(LongWord)
         ;		ldi	xl,low(Str6)
         ;		ldi	xh,high(Str6)
         ;		rcall	Itoa
         		
         		
         		
         		
         ;		ldi	zl,low(Str6)
         ;		ldi	zh,high(Str6)
         		
         		
         		
         ;		adiw	zl,1
         ;		pop	yh				;t
         ;		pop	yl				;t
         ;		sbiw	yl,1				;t
         ;		rcall	MoveString			;t
         		
         ;		sbiw	yl,1
         ;		ldi	temp0,'/'
         ;		st	y+,temp0	
         	
         ;		adiw	yl,1
         ;		push	yl
         ;		push	yh
         
         ;		clr	tempchar
         ;		sts	LongWord,tempchar
         ;		lds	tempchar,seconds
         ;		sts	LongWord+1,tempchar
         		;---------Print low word-----------------
         ;		ldi	zl,low(LongWord)
         ;		ldi	zh,high(LongWord)
         ;		ldi	xl,low(Str6)
         ;		ldi	xh,high(Str6)
         ;		rcall	Itoa
         		
         		
         		
         		
         ;		ldi	zl,low(Str6)
         ;		ldi	zh,high(Str6)
         		
         		
         		
         ;		adiw	zl,1
         ;		pop	yh				;t
         ;		pop	yl				;t
         ;		sbiw	yl,1				;t
         ;		rcall	MoveString			;t
         		
         ;		sbiw	yl,1
         ;		ldi	temp0,'/'
         ;		st	y+,temp0
         		
         		
         		
         ;		adiw	yl,1
         ;		push	yl
         ;		push	yh
         	
         
         		;---------Print Low  word------------------
         ;		lds	tempchar,Svolume
         ;		sts	LongWord+1,tempchar
         		;---------Print high word-----------------
         ;		lds	tempchar,Svolume+1
         ;		sts	LongWord,tempchar
         		
         		
         ;		ldi	zl,low(LongWord)
         ;		ldi	zh,high(LongWord)
         ;		ldi	xl,low(Str6)
         ;		ldi	xh,high(Str6)
         ;		rcall	Itoa
         		
         		
         		
         		
         ;		ldi	zl,low(Str6)
         ;		ldi	zh,high(Str6)
         		
         		
         		
         ;		adiw	zl,1
         ;		pop	yh				;t
         ;		pop	yl				;t
         ;		sbiw	yl,1				;t
         ;		rcall	MoveString			;t
         	
         ;		sbiw	yl,1
         ;		ldi	temp0,'/'
         ;		st	y+,temp0
         	
         		
         ;		adiw	yl,1
         ;		push	yl
         ;		push	yh
         	
         	
         		
         
         		
         			;---------Print Low  word------------------
         ;		lds	tempchar,GTemperature
         ;		sts	LongWord+1,tempchar
         		;---------Print high word-----------------
         ;		lds	tempchar,GTemperature+1
         ;		sts	LongWord,tempchar
         		
         ;		ldi	zl,low(LongWord)
         ;		ldi	zh,high(LongWord)
         ;		ldi	xl,low(Str6)
         ;		ldi	xh,high(Str6)
         ;		rcall	Itoa
         		
         		
         		
         		
         ;		ldi	zl,low(Str6)
         ;		ldi	zh,high(Str6)
         		
         		
         		
         ;		adiw	zl,1
         ;		pop	yh				;t
         ;		pop	yl				;t
         ;		sbiw	yl,1				;t
         ;		rcall	MoveString			;t
         ;		
         ;		sbiw	yl,1
         ;		ldi	temp0,'/'
         ;		st	y+,temp0
         	
         		
         		
         ;		ldi	zl,low(customernoE)
         ;		ldi	zh,high(customernoE)
         ;		rcall	MoveEEtoRam
         ;		sbiw	yl,1
         		
         ;		ldi	temp0,'/'
         ;		st	y+,temp0
         ;		ldi	temp0,'T'
         ;		st	y+,temp0
         ;		ldi	temp0,'e'
         ;		st	y+,temp0
         ;		ldi	temp0,'s'
         ;		st	y+,temp0
         ;		ldi	temp0,'t'
         ;		st	y+,temp0
         	
         ;		clr	temp0
         ;		st	y+,temp0
         	
         ;		wdr
         ;		rcall	SendSms
         ;		wdr
00052e d57b      		rcall	ClearSmsFlag		;ClearSmsFlag 
00052f 2744      		clr	temp0
000530 9340 01f9 		sts	Count,temp0		;clear time counter	
000532 9140 0206 		lds	temp0,Bflags
000534 6041      		sbr	temp0,1
000535 9340 0206 		sts	Bflags,temp0
         	
000537 dbe4      		rcall	timer1_init							
000538 c08a      		rjmp	sendexit0	
         
         
          ExitBoxTest:
000539 e5c0      		ldi	yl,low(TempBuf)
00053a e0d1      		ldi	yh,high(TempBuf)
00053b d220      		rcall	MFTR
00053c c08a      		rjmp	sendexit1	
         
         
          ActionLamp:
         		;mov	zl,yl
         		;mov	zh,yh
00053d 9621      		adiw	yl,1
00053e 8128      		ld	tempchar,y			;Get value (On=1,Off=0)
00053f 3320      		cpi	tempchar,48
000540 f029      		breq	ActionLamptOff
000541 3321      		cpi	tempchar,49
000542 f059      		breq	ActionLamptOn
000543 e2e0      		ldi	zl,low(2*Error)
000544 e1fc      		ldi	zh,high(2*Error)
000545 c032      		rjmp	ExitLamptError
         		
          ActionLamptOff:
000546 e030      		ldi	temp1,0	
000547 bd3e      		out	TCCR1b,temp1		;Stop timer
         		;;clr	temp1
         		;;sts	pollFlag,temp1		;clear pollFlag	
000548 9130 0206 		lds	temp1,Bflags
00054a 7f3e      		cbr	temp1,1
00054b 9330 0206 		sts	Bflags,temp1
00054d c028      		rjmp	ExitLamptOk
          ActionLamptOn:
         		;clr	temp0			 
         		;sts	Count,temp0		;clear time counter
         		;sts	pollFlag,temp0		;clear pollFlag	
         		;sts	lampStatus,temp0	;clear lampStatus
         		;rcall	timer1_init
00054e edeb      		ldi	zl,low(Phoneno)		;Source string
00054f e0f1      		ldi	zh,high(Phoneno)
         		
000550 eeca      		ldi	yl,low(TempPhoneno)	;Target string
000551 e0d1      		ldi	yh,high(TempPhoneno)
000552 d204      		rcall	MoveString		;Copy Phoneno to TempPhoneno
         
         		
000553 2744      		clr 	temp0
000554 9340 00d8 		sts	SUARTbuf,temp0			
000556 e1e8      		ldi 	zl,low(2*tlps)				;Load strinpointer
000557 e1fe      		ldi 	zh,high(2*tlps)
000558 d0d1      		rcall	PrintSoftUstr
000559 d344      		rcall	ReadSoftUart
         		
00055a ede8      		ldi	zl,low(SUARTbuf)
00055b e0f0      		ldi	zh,high(SUARTbuf)
00055c e5c0      		ldi	yl,low(TempBuf)
00055d e0d1      		ldi	yh,high(TempBuf)
00055e e244      		ldi	temp0,'$'
00055f 9349      		st	y+,temp0
000560 e44c      		ldi	temp0,'L'
000561 9349      		st	y+,temp0
000562 e543      		ldi	temp0,'S'
000563 9349      		st	y+,temp0
000564 9631      		adiw	zl,1
000565 d1f1      		rcall	MoveString
         		;-------Test--------------------------
         		;ldi	zl,low(TempPhoneno)	;Target string
         		;ldi	zh,high(TempPhoneno)
         		;adiw	zl,1
         		;rcall	MoveString
         		;-------------------------------------
         		;ld	tempchar,z		;Load byte from program memory into tempchar
000566 9120 0153 		lds	tempchar,TempBuf+3
000568 9320 01ff 		sts	lampStatus,tempchar	;Save lampStatus
00056a d298      		rcall	SendSms
         		;;clr	temp0
         		;;sts	SmsFlag,temp0		;Set SmsFlag off			 
         		;lds	temp0,Bflags
         		;cbr	temp0,2
         		;sts	Bflags,temp0
00056b d53e      		rcall	ClearSmsFlag		;ClearSmsFlag 
00056c 2744      		clr	temp0
00056d 9340 01f9 		sts	Count,temp0		;clear time counter
         		;;ldi	temp0,1
         		;;sts	pollFlag,temp0		;set pollFlag	
00056f 9140 0206 		lds	temp0,Bflags
000571 6041      		sbr	temp0,1
000572 9340 0206 		sts	Bflags,temp0
         		;sts	lampStatus,temp0	;clear lampStatus
000574 dba7      		rcall	timer1_init
000575 c04d      		rjmp	sendexit0
         		;rjmp	ExitLamptOk
         		
          ExitLamptOk:;--------------------------------------		
000576 e1ec      		ldi 	zl,low(2*OK)			;Load strinpointer
000577 e1fc      		ldi 	zh,high(2*OK)
          ExitLamptError:
000578 e5c0      		ldi	yl,low(TempBuf)
000579 e0d1      		ldi	yh,high(TempBuf)
00057a d1e1      		rcall	MFTR
00057b c04b      		rjmp	sendexit1			
         		
         		
         		
         		
         
         ;------------------------------------------------------------------------------------
          ActionPoll:
00057c 9621      		adiw	yl,1
00057d 8128      		ld	tempchar,y			;Get value (On=1,Off=0)
00057e 3320      		cpi	tempchar,48
00057f f059      		breq	ActionPollOff
000580 3321      		cpi	tempchar,49
000581 f089      		breq	ActionPollOn
000582 3322      		cpi	tempchar,50
000583 f0f9      		breq	ActionPollinitFlagOn
000584 3323      		cpi	tempchar,51
000585 f121      		breq	ActionPollinitFlagOff
000586 3324      		cpi	tempchar,52
000587 f149      		breq	ActionPollinitTargetPhoneNo
000588 e2e0      		ldi	zl,low(2*Error)
000589 e1fc      		ldi	zh,high(2*Error)
00058a c02a      		rjmp	ExitPollError
         		
          ActionPollOff:
00058b e030      		ldi	temp1,0	
00058c bd3e      		out	TCCR1b,temp1		;Stop timer
         		;;clr	temp1
         		;;sts	pollFlag,temp1		;clear pollFlag
00058d 9130 0206 		lds	temp1,Bflags
00058f 7f3e      		cbr	temp1,1
000590 9330 0206 		sts	Bflags,temp1	
000592 c020      		rjmp	ExitPollOk
          ActionPollOn:
000593 edeb      		ldi	zl,low(Phoneno)		;Source string
000594 e0f1      		ldi	zh,high(Phoneno)
         		
000595 eeca      		ldi	yl,low(TempPhoneno)	;Target string
000596 e0d1      		ldi	yh,high(TempPhoneno)
000597 d1bf      		rcall	MoveString		;Copy Phoneno to TempPhoneno
         
         		
         		;clr 	temp0
         		;sts	SUARTbuf,temp0			
         		;ldi 	zl,low(2*tlps)				;Load strinpointer
         		;ldi 	zh,high(2*tlps)
         		;rcall	PrintSoftUstr
         		;rcall	ReadSoftUart
         		
         		;ldi	zl,low(SUARTbuf)
         		;ldi	zh,high(SUARTbuf)
         		;ldi	yl,low(TempBuf)
         		;ldi	yh,high(TempBuf)
         		;ldi	temp0,'$'
         		;st	y+,temp0
         		;ldi	temp0,'L'
         		;st	y+,temp0
         		;ldi	temp0,'S'
         		;st	y+,temp0
         		;adiw	zl,1
         		;rcall	MoveString
         
         
         
         		;lds	tempchar,TempBuf+3
         		;sts	lampStatus,tempchar		;Save lampStatus
         		;rcall	SendSms
000598 2744      		clr	temp0
         	;	sts	SmsFlag,temp0			;Set SmsFlag off			 
000599 9340 01f9 		sts	Count,temp0			;clear time counter
         		;;ldi	temp0,1
         		;;sts	pollFlag,temp0			;set pollFlag	
00059b 9140 0206 		lds	temp0,Bflags
00059d 6041      		sbr	temp0,1				;set pollFlag
00059e 7f4d      		cbr	temp0,2				;Set SmsFlag off
00059f 9340 0206 		sts	Bflags,temp0
0005a1 db7a      		rcall	timer1_init
         		;rjmp	sendexit0
0005a2 c010      		rjmp	ExitPollOk
          ActionPollinitFlagOn:
0005a3 e0e4      		ldi 	zl,low(ireg)			;Load strinpointer
0005a4 e0f0      		ldi 	zh,high(ireg)
0005a5 d429      		rcall	EERead
0005a6 9468      		set
0005a7 f920      		bld	tempchar,0			;Set bit 0 in ireg		
         		;ldi	tempchar,1
0005a8 d416      		rcall	EEWrite	
0005a9 c009      		rjmp	ExitPollOk
          ActionPollinitFlagOff:
0005aa e0e4      		ldi 	zl,low(ireg)			;Load strinpointer
0005ab e0f0      		ldi 	zh,high(ireg)
0005ac d422      		rcall	EERead
0005ad 94e8      		clt					;Clear bit 0 in ireg
0005ae f920      		bld	tempchar,0
         		;ldi	tempchar,0
0005af d40f      		rcall	EEWrite	
0005b0 c002      		rjmp	ExitPollOk
          ActionPollinitTargetPhoneNo:
0005b1 d43e      		rcall	initPoll
0005b2 c000      		rjmp	ExitPollOk
          ExitPollOk:;--------------------------------------		
0005b3 e1ec      		ldi 	zl,low(2*OK)			;Load strinpointer
0005b4 e1fc      		ldi 	zh,high(2*OK)
          ExitPollError:
0005b5 e5c0      		ldi	yl,low(TempBuf)
0005b6 e0d1      		ldi	yh,high(TempBuf)
0005b7 d1a4      		rcall	MFTR
0005b8 c00e      		rjmp	sendexit1			
         		
         	
         
         ;------------------------------------------------------------------------------------
         
         
         				
         
          ActionConnect:
0005b9 2722      		clr	tempchar
0005ba 9320 01d5 		sts	Mode,tempchar
0005bc c006      		rjmp	sendexit0
         
         
         
          ConvertToSoftU:
0005bd e5e0      		ldi	zl,low(TempBuf)
0005be e0f1      		ldi	zh,high(TempBuf)
0005bf d060      		rcall	PrintSoftU
         		;clr	tempchar
         		;sts	TempBuf,tempchar
0005c0 c002      		rjmp	sendexit0		
         		
         		
          sendexit:
0005c1 9896      		cbi	PORTD,6
0005c2 9508      		ret
          sendexit0:
0005c3 2722      		clr	tempchar
0005c4 9320 0150 		sts	TempBuf,tempchar
0005c6 cffa      		rjmp	sendexit
          sendexit1:
0005c7 e5e0      		ldi	zl,low(TempBuf)
0005c8 e0f1      		ldi	zh,high(TempBuf)
         		;;lds	tempchar,SmsFlag		;Load SmsFlag
         		;;ldi	temp0,1
         		;;cpse	tempchar,temp0
0005c9 9120 0206 		lds	tempchar,Bflags
0005cb ff21      		sbrs	tempchar,1
0005cc d049      		rcall	PrintBuf
         		;clr	temp0
         		;cpse	tempchar,temp0			;Send SMS if SmsFlag on
0005cd fd21      		sbrc	tempchar,1
0005ce d234      		rcall	SendSms
         		;;clr	tempchar
         		;;sts	SmsFlag,tempchar		;Set SmsFlag off
         		;lds	tempchar,Bflags
         		;cbr	tempchar,2
         		;sts	Bflags,tempchar
0005cf d4da      		rcall	ClearSmsFlag			;Clear SmsFlag			;C
0005d0 cff0      		rjmp	sendexit	
          sendexit2:
0005d1 2722      		clr	tempchar
0005d2 9320 0150 		sts	TempBuf,tempchar
0005d4 9508      		ret
         					
          TestModeSmsExit:
         		;ldi	yl,low(TempBuf)
         		;ldi	yh,high(TempBuf)
         		;rcall	MoveString
         		;-------If Mode=0 print-out to softuart-----------------------------------
0005d5 9120 01d5 		lds	tempchar,Mode
0005d7 3320      		cpi	tempchar,'0'
0005d8 f439      		brne	TME0	
0005d9 e5e0      		ldi	zl,low(TempBuf)
0005da e0f1      		ldi	zh,high(TempBuf)
0005db e451      		ldi	u_data,65
0005dc db4b      	        rcall	putc
0005dd d042      	        rcall	PrintSoftu
0005de e452      	        ldi	u_Data,66
0005df db48      	        rcall	putc
         	        ;tlds	tempchar,TempBuf
         	        ;tcpi	tempchar,13
         	        ;tbreq	TestModeExit0
          TME0:	        ;------Send Sms---------------
0005e0 d222      		rcall	SendSms
         		;;clr	tempchar
         		;;sts	SmsFlag,tempchar
         		;lds	tempchar,Bflags
         		;cbr	tempchar,2
         		;sts	Bflags,tempchar
0005e1 d4c8      		rcall	ClearSmsFlag			;Clear SmsFlag
          TestModeExit0:
0005e2 cfde      		rjmp	sendexit
         		
         ;--------------------------------------------------------------------------------------------
         
         
         ;
         ;**************************
         ;* The RS232 FIFO manager *
         ;**************************
          Rs232GetByte:
0005e3 93ef      	push	r30
0005e4 93ff      	push	r31
0005e5 2722      	clr	tempchar
0005e6 1701      	cp	rxhead,rxtail
0005e7 f071      	breq	Rs232GetBytexit
0005e8 2422      	clr	r2
0005e9 e6e0      	ldi	zl,low(Buf)	; Pointer to the rxbuffer (FIFO)
0005ea e0f0      	ldi	zh,high(Buf)
0005eb 0fe0      	add	zl,rxhead
0005ec 1ff2      	adc	zh,tempchar	; add address offset...  z = &Buf[rxhead]
0005ed 8120      	ld	tempchar,z	; tempchar = Buf[rxhead++]
0005ee 9503      	inc	rxhead
0005ef 3708      	cpi	rxhead,BUFSIZE	; test for the end of the data buffer
0005f0 f008      	brlo	Rs232Gbx
0005f1 2700      	clr	rxhead		; Circle around to the first buffer pos.
          Rs232Gbx:
         ;***** Xon calcs go here *****
0005f2 9408      	sec			; This is not need for ASCII data
0005f3 91ef      	pop	r30		; as a zero value returned in tempchar works
0005f4 91ff      	pop	r31
0005f5 9508      	ret			; But, for binary data, zero may be valid!
          Rs232GetBytexit:		; Return 'No' bytes in yet.
0005f6 9488      	clc			
0005f7 91ef      	pop	r30
0005f8 91ff      	pop	r31
0005f9 9508      	ret
         ;----------------------------------------------------------------------------------------------
          GetStringData:
0005fa 2733      		clr	temp1
0005fb 2722      		clr	tempchar
0005fc efe8      		ldi	zl,low(2*Ver)
0005fd e1fb      		ldi	zh,high(2*Ver)
0005fe e021      		ldi	tempchar,1
0005ff 0fe2      		add	zl,tempchar
000600 2722      		clr	tempchar
         		;adc	zh,tempchar
         	
         		;lpm	tempchar,z
000601 95c8      		lpm
         
         		;st	z+,tempchar
         		;st	z+,tempchar
         		;out	udr,tempchar	;send the recived valuable
          send2:	
000602 9a53      		sbi	ucr,txen	;AT90s8515,set sender bit
         		;sbi	ucsrb,txen	;ATmega8515,set sender bit
000603 9b5d      		sbis	usr,udre	;AT90s8515,wait till register is cleared
         		;sbis	ucsra,udre	;ATmega8515,wait till register is cleared
000604 cffd      		rjmp	send2
000605 b80c      		out	udr,r0	;send the recived valuable
000606 9508      		ret
         		
         ;----------------------------------------------------------------------------------------------
          test:
000607 2733      		clr	temp1
         	;	ldi 	zl,low(2*Text)	;Load strinpointer
         	;	ldi 	zh,high(2*Text)
000608 e5e0      		ldi	zl,low(TempBuf)
000609 e0f1      		ldi	zh,high(TempBuf)
         	;	rcall	PrintStr
00060a d00b      		rcall	printBuf
         
00060b 9508      		ret
         
         ;----------------------------------------------------------------------------------------------
         ;WriteTempBuf:
         ;		ldi	xl,low(TempBuf)			;Load stringpointer destination
         ;		ldi	xh,high(TempBuf)
         ;		ldi	tempchar,'R'	
         ;		st	x+,tempchar
         ;		ldi	tempchar,'e'
         ;		st	x+,tempchar
         ;		ldi	tempchar,'a'
         ;		st	x+,tempchar
         ;		ldi	tempchar,'d'
         ;		st	x+,tempchar
         ;		ldi	tempchar,'C'
         ;		st	x+,tempchar
         ;		ldi	tempchar,'C'
         ;		st	x+,tempchar
         ;		clr	tempchar
         ;		st	x+,tempchar
         
         ;		ret
         ;----------------------------------------------------------------------------------------------		
         
         ;***********************************************************************
         ;*PrintStr
         ;*
         ;*z pointer to the string (zl,zh)
         ;*
         ;***********************************************************************
          PrintStr:
00060c 95c8      		lpm				;Load byte from program memory into r0
00060d 2000      		tst	r0			;Test if we have reached then end of the string
00060e f031      		breq	quitPrintStr		;If so, quit
          PrintStr1:
00060f 9a53      		sbi	ucr,txen		;AT90s8515,set sender bit
         		;sbi	ucsrb,txen		;ATmega8515,set sender bit
000610 9b5d      		sbis	usr,udre		;AT90s8515,wait till register is cleared
         		;sbis	ucsra,udre		;ATmega8515,wait till register is cleared
000611 cffd      		rjmp	PrintStr1
000612 b80c      		out	udr,r0			;send the byte
000613 9631      		adiw	zl,1			;increase z
000614 cff7      		rjmp	PrintStr
          quitPrintStr:
000615 9508      		ret
         ;---------------------------------------------------------------------------------------------
         ;***********************************************************************
         ;*PrintBuf
         ;*
         ;*z pointer to the string (zl,zh)
         ;*
         ;***********************************************************************
          PrintBuf:
000616 8120      		ld	tempchar,z		;Load byte from program memory into r0
000617 2322      		tst	tempchar		;Test if we have reached then end of the string
000618 f031      		breq	quitPrintBuf		;If so, quit
          lPrintBuf:
000619 9a53      		sbi	ucr,txen		;AT90s8515,set sender bit
         		;sbi	ucsrb,txen		;ATmega8515,set sender bit
00061a 9b5d      		sbis	usr,udre		;AT90s8515,wait till register is cleared, tegister name in AT90s8515
         		;sbis	ucsra,udre		;ATmega8515,wait till register is cleared, register name in Atmega 8515
00061b cffd      		rjmp	lPrintBuf
00061c b92c      		out	udr,tempchar		;send the byte
00061d 9631      		adiw	zl,1			;increase z
00061e cff7      		rjmp	PrintBuf
          quitPrintBuf:
00061f 9508      		ret
         ;---------------------------------------------------------------------------------------------
         
         ;---------------------------------------------------------------------------------------------
         ;***********************************************************************
         ;*PrintSoftU
         ;*
         ;*z pointer to the string (zl,zh)
         ;*
         ;***********************************************************************
          PrintSoftU:
         
000620 9a96      		sbi	PORTD,6			;Set RTS On
000621 8120      		ld	tempchar,z		;Load byte from program memory into tempchar
000622 2322      		tst	tempchar		;Test if we have reached the end of the string
000623 f021      		breq	quitPrintSoftU		;If so, quit
000624 2f52      		mov	u_data,tempchar		;Load byte
000625 db02      		rcall	putc			;Send byte to soft-uart
000626 9631      		adiw	zl,1			;increase z
000627 cff8      		rjmp	PrintSoftU
          quitPrintSoftU:
         		;ldi	u_data,13
         		;rcall	putc
000628 9896      		cbi	PORTD,6			;Set RTS Off
000629 9508      		ret
         ;--------------------------------------------------------------------------------------------
         ;***********************************************************************
         ;*PrintSoftUstr
         ;*
         ;*z pointer to the string (zl,zh)
         ;*
         ;***********************************************************************
          PrintSoftUstr:
         
00062a 95c8      		lpm				;Load byte from program memory into r0
00062b 2000      		tst	r0			;Test if we have reached the end of the string
00062c f021      		breq	quitPrintSoftUstr	;If so, quit
00062d 2d50      		mov	u_data,r0		;Load byte
00062e daf9      		rcall	putc			;Send byte to soft-uart
00062f 9631      		adiw	zl,1			;increase z
000630 cff9      		rjmp	PrintSoftUstr
          quitPrintSoftUstr:
         		;ldi	u_data,13
         		;rcall	putc
000631 9508      		ret
         ;--------------------------------------------------------------------------------------------
         ;***********************************************************************
         ;*SendPacketSoftUstr
         ;*
         ;*z pointer to the string (zl,zh)
         ;*temp0 packet length
         ;*
         ;***********************************************************************
          SendPacketSoftUstr:
         		;ldi	temp0,13
          SendPacketSoftUstr0:
000632 95c8      		lpm				;Load byte from program memory into r0
000633 2344      		tst	temp0;r0			;Test if we have reached the end of the string
000634 f029      		breq	quitSendPacketSoftUstr	;If so, quit
000635 2d50      		mov	u_data,r0		;Load byte
000636 daf1      		rcall	putc			;Send byte to soft-uart
000637 9631      		adiw	zl,1			;increase z
000638 954a      		dec	temp0			;decrease temp0
000639 cff8      		rjmp	SendPacketSoftUstr0
          quitSendPacketSoftUstr:
         		;ldi	u_data,13
         		;rcall	putc
00063a 9508      		ret
         ;--------------------------------------------------------------------------------------------
         
         
         
         
         
         
         
         ;***********************************************************************
         ;*PrintEESoftU
         ;*
         ;*z pointer to the string (zl,zh)
         ;*
         ;***********************************************************************
          PrintEEtoSoftU:
         
00063b 9a96      		sbi	PORTD,6				;Set RTS On
         		;ld	tempchar,z			;Load byte from program memory into tempchar
00063c d392      		rcall	EERead
00063d 2322      		tst	tempchar			;Test if we have reached the end of the string
00063e f021      		breq	quitPrintEEtoSoftU		;If so, quit
00063f 2f52      		mov	u_data,tempchar			;Load byte
000640 dae7      		rcall	putc				;Send byte to soft-uart
000641 9631      		adiw	zl,1				;increase z
000642 cff8      		rjmp	PrintEEtoSoftU
          quitPrintEEtoSoftU:
         		;ldi	u_data,13
         		;rcall	putc
000643 9896      		cbi	PORTD,6				;Set RTS Off
000644 9508      		ret
         ;--------------------------------------------------------------------------------------------
         ;------------------------------------------------------------------------------
         ;Routine to search for one string within another
         ;y=pointer to the destination string (1)
         ;z=pointer to the source string(2)
         ;
          StrSearch:
000645 2fae      		mov	xl,zl			;Save z in x
000646 2fbf      		mov	xh,zh
         		
         		
          StrSearchL:
000647 95c8      		lpm				;Load byte from source string
000648 8128      		ld	tempchar,y		;Load byte from destination string
000649 1602      		cp	r0,tempchar		;if r0[z]=tempchar[y] then 
00064a f069      		breq	StrSearch1
         		
00064b 2fea      		mov	zl,xl			;else
00064c 2ffb      		mov	zh,xh			;Pointer to beginning of source string
00064d 9721      		sbiw	yl,1
00064e 95c8      		lpm
00064f 8128      		ld	tempchar,y
000650 1602      		cp	r0,tempchar
000651 f059      		breq	StrSearch2
          StrSearch01:	
000652 9621      		adiw	yl,1			;Increase y		
         						;end else
          StrSearch0:
000653 9621      		adiw	yl,1			;Increase y
000654 8128      		ld	tempchar,y
000655 2322      		tst	tempchar		;If tempchar=0 then exit	
000656 f041      		breq	StrSearchNosucess
000657 cfef      		rjmp	StrSearchL
         
          StrSearch1:
000658 9631      		adiw	zl,1			;Increase z
000659 95c8      		lpm	
00065a 2000      		tst	r0			;If r0=0 then exit
00065b f031      		breq	StrSearchExit		;(a match was found)
00065c cff6      		rjmp	StrSearch0	
         		
          StrSearch2:
00065d 9631      		adiw	zl,1			;Increase z
00065e cff3      		rjmp	StrSearch01
         
          StrSearchNosucess:
00065f 27cc      		clr	yl
000660 27dd      		clr	yh
000661 c000      		rjmp	StrSearchExit
         
         
          StrSearchExit:
         ;	POP	CX				;Restore registers
         ;	POP	DI			
         ;	POP	SI
000662 9508      		ret
         
         
         ;------------------------------------------------------------------------------
         ;*******************************************************************************
         ;*FUNCTION
         ;* StrSearchEE
         ;*
         ;*DESCRIPTION
         ;*
         ;*Routine to search for one string within another
         ;*y=pointer to the destination string (1)
         ;*z=pointer to the source string(2)
         ;*
         ;*
         ;*
         ;*******************************************************************************
         
          StrSearchEE:
         		;push	yl
         		;push	yh
000663 2fac      		mov	xl,yl			;Save z in x
000664 2fbd      		mov	xh,yh
         		
         		
          StrSearchEEL:
000665 8128      		ld	tempchar,y		;Load byte from source string
000666 95c8      		lpm				;Load byte from destination string
         		;cp	r0,tempchar		;if r0[z]=tempchar[y] then 
000667 1520      		cp	tempchar,r0		;if tempchar[z]=r0[y] then 
000668 f069      		breq	StrSearchEE1
         		
000669 2fca      		mov	yl,xl			;else
00066a 2fdb      		mov	yh,xh			;Pointer to beginning of source string
00066b 9731      		sbiw	zl,1
00066c 8128      		ld	tempchar,y
00066d 95c8      		lpm		
         		;cp	r0,tempchar
00066e 1520      		cp	tempchar,r0
00066f f059      		breq	StrSearchEE2
          StrSearchEE01:	
000670 9631      		adiw	zl,1			;Increase y		
         						;end else
          StrSearchEE0:
000671 9631      		adiw	zl,1			;Increase y
000672 95c8      		lpm				;ld	tempchar,y
         		;tst	tempchar		;If tempchar=0 then exit
000673 2000      		tst	r0			;If r0=0 then exit	
000674 f041      		breq	StrSearchEENosucess
000675 cfef      		rjmp	StrSearchEEL
         
          StrSearchEE1:
000676 9621      		adiw	yl,1			;Increase z
000677 8128      		ld	tempchar,y	
         		;tst	r0			;If r0=0 then exit
000678 2322      		tst	tempchar		;If tempchar=0 then exit
000679 f031      		breq	StrSearchEEExit		;(a match was found)
00067a cff6      		rjmp	StrSearchEE0	
         		
          StrSearchEE2:
00067b 9621      		adiw	yl,1			;Increase z
00067c cff3      		rjmp	StrSearchEE01
         
          StrSearchEENosucess:
00067d 27ee      		clr	zl
00067e 27ff      		clr	zh
00067f c000      		rjmp	StrSearchEEExit
         
         
          StrSearchEEExit:
         		;pop	yh
         		;pop	yl	
         
000680 9508      		ret
         
         ;------------------------------------------------------------------------------
         ;*******************************************************************************
         ;*FUNCTION
         ;* StrSearchEEP
         ;*
         ;*DESCRIPTION
         ;*
         ;*Routine to search for one string within another
         ;*y=pointer to the destination string (1)
         ;*z=pointer to the source string(2)
         ;*
         ;*
         ;*
         ;*******************************************************************************
         
          StrSearchEEP:
         		;push	yl
         		;push	yh
000681 2fac      		mov	xl,yl			;Save z in x
000682 2fbd      		mov	xh,yh
         		
         		
          StrSearchEEPL:
         ;		ld	tempchar,y		;Load byte from source string
000683 8008      		ld	r0,y			;Load byte from source string
000684 d34a      		rcall	EERead
         ;		lpm				;Load byte from destination string
000685 1602      		cp	r0,tempchar		;if r0[z]=tempchar[y] then 
         ;		cp	tempchar,r0		;if tempchar[z]=r0[y] then 
000686 f069      		breq	StrSearchEEP1
         		
000687 2fca      		mov	yl,xl			;else
000688 2fdb      		mov	yh,xh			;Pointer to beginning of source string
000689 9731      		sbiw	zl,1
         ;		ld	tempchar,y
00068a 8008      		ld	r0,y
         ;		lpm		
00068b d343      		rcall	EERead
00068c 1602      		cp	r0,tempchar
         ;		cp	tempchar,r0
00068d f059      		breq	StrSearchEEP2
          StrSearchEEP01:	
00068e 9631      		adiw	zl,1			;Increase y		
         						;end else
          StrSearchEEP0:
00068f 9631      		adiw	zl,1			;Increase y
         ;		lpm				;ld	tempchar,y
000690 d33e      		rcall 	EERead
000691 2322      		tst	tempchar		;If tempchar=0 then exit
         ;		tst	r0			;If r0=0 then exit	
000692 f041      		breq	StrSearchEEPNosucess
000693 cfef      		rjmp	StrSearchEEPL
         
          StrSearchEEP1:
000694 9621      		adiw	yl,1			;Increase z
         ;		ld	tempchar,y	
000695 8008      		ld	r0,y
000696 2000      		tst	r0			;If r0=0 then exit
         ;		tst	tempchar		;If tempchar=0 then exit
000697 f031      		breq	StrSearchEEPExit		;(a match was found)
000698 cff6      		rjmp	StrSearchEEP0	
         		
          StrSearchEEP2:
000699 9621      		adiw	yl,1			;Increase z
00069a cff3      		rjmp	StrSearchEEP01
         
          StrSearchEEPNosucess:
00069b 27ee      		clr	zl
00069c 27ff      		clr	zh
00069d c000      		rjmp	StrSearchEEPExit
         
         
          StrSearchEEPExit:
         		;pop	yh
         		;pop	yl	
         
00069e 9508      		ret
         
         ;------------------------------------------------------------------------------
         
         
         ;*******************************************************************************
         ;*FUNCTION
         ;* Itoa
         ;*
         ;*DESCRIPTION
         ;*Convert a 16-bit integer to a nullterminated string (min 6byte)
         ;*
         ;*Input parameter  z=Pointer to number to be converted (2byte)
         ;*Output parameter x=Pointer to the string with the converted integer
         ;*
         ;*******************************************************************************
          Itoa:
00069f 9488      		clc
0006a0 9141      		ld	temp0,z+		;high load nuber to be converted
0006a1 8130      		ld	temp1,z			;low
0006a2 2fe3      		mov	zl,temp1
0006a3 2ff4      		mov	zh,temp0
0006a4 e030      		ldi	temp1,0			;init digit counter
0006a5 e044      		ldi	temp0,4			;init exponent counter
0006a6 e1c0      		ldi	yl,16			;load exponent 10000
0006a7 e2d7      		ldi	yh,39	
          itoal:
0006a8 9533      		inc	temp1			;increase digit counter
0006a9 1bec      		sub	zl,yl			;Subtract low bytes
0006aa 0bfd      		sbc	zh,yh			;Subtract high byte with carry
0006ab f7e0      		brcc	itoal
         		
         		
         
          itoa1xxxx:
0006ac 9488      		clc
0006ad 953a      		dec	temp1			;decrease digit counter
0006ae 0fec      		add	zl,yl
0006af 1ffd      		adc	zh,yh
0006b0 954a      		dec	temp0			;decrease exponent counter
         		
0006b1 e320      		ldi	tempchar,48	
0006b2 0f23      		add	tempchar,temp1
0006b3 932d      		st	x+,tempchar		;store digit
0006b4 e030      		ldi	temp1,0			;clear exponent counter
0006b5 3041      		cpi	temp0,1
0006b6 f059      		breq	itoa10
0006b7 3042      		cpi	temp0,2
0006b8 f031      		breq	itoa100
0006b9 3043      		cpi	temp0,3
0006ba f009      		breq	itoa1000
         			
0006bb c009      		rjmp	itoa0
         		
         ;------------------------------------------------------
         
         
          itoa1000:
0006bc eec8      		ldi	yl,232
0006bd e0d3      		ldi	yh,3
0006be cfe9      		rjmp	itoal
          itoa100:	
0006bf e6c4      		ldi	yl,100
0006c0 e0d0      		ldi	yh,0
0006c1 cfe6      		rjmp	itoal
         		
          itoa10:		
0006c2 e0ca      		ldi	yl,10 
0006c3 e0d0      		ldi	yh,0
0006c4 cfe3      		rjmp	itoal
          itoa0:		
0006c5 2f3e      		mov	temp1,zl
0006c6 e320      		ldi	tempchar,48
0006c7 0f23      		add	tempchar,temp1
0006c8 932d      		st	x+,tempchar
0006c9 e020      		ldi	tempchar,0
0006ca 932c      		st	x,tempchar		;store last digit
0006cb 9508      		ret
         ;-----------------------------------------------------------------------------------
         ;************************************************************************************
         ;*FUNCTION
         ;*  Delay
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*Input: DelayV
         ;************************************************************************************
          Delay:
0006cc 934f      		push	temp0
0006cd 933f      		push	temp1
0006ce 932f      		push	tempchar
         		;ldi	temp0,0x20    ;0x30		;load counter
0006cf 9140 01d8 		lds	temp0,DelayV
          delayl00:	
         		;ldi	temp1,0x50		;load counter
0006d1 9130 01d9 		lds	temp1,DelayV+1
0006d3 954a      		dec	temp0			;decrease counter
          delayl01:
         		;ldi	tempchar,0x01;0x90		;
0006d4 9120 01da 		lds	tempchar,DelayV+2
0006d6 953a      		dec	temp1			;decrease counter
          delayl02:					;	
0006d7 95a8      		wdr				;watchdog reset
0006d8 952a      		dec	tempchar		;
0006d9 2322      		tst	tempchar		;
0006da f7e1      		brne	delayl02		;
0006db 2333      		tst	temp1
0006dc f7b9      		brne	delayl01
0006dd 2344      		tst	temp0
0006de f791      		brne	delayl00
0006df 912f      		pop	tempchar
0006e0 913f      		pop	temp1
0006e1 914f      		pop	temp0
0006e2 9508      		ret
         
         ;-------------------------------------------------------------------------------------
         ;************************************************************************************
         ;*FUNCTION
         ;*  ShortDelay
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*Input:
         ;************************************************************************************
          ShortDelay:;----Set Delay Value---------------------
0006e3 932f      		push	tempchar
0006e4 e220      		ldi	tempchar,0x20
0006e5 9320 01d8 		sts	DelayV,tempchar
0006e7 e520      		ldi	tempchar,0x50
0006e8 9320 01d9 		sts	DelayV+1,tempchar
0006ea e021      		ldi	tempchar,0x01
0006eb 9320 01da 		sts	DelayV+2,tempchar
         		
0006ed dfde      		rcall	Delay
0006ee 912f      		pop	tempchar
0006ef 9508      		ret
         ;-----------------------------------------------------------------------------------------
         ;************************************************************************************
         ;*FUNCTION
         ;*  LongDelay
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*Input:
         ;************************************************************************************
          LongDelay:;----Set Delay Value---------------------
0006f0 932f      		push	tempchar
0006f1 ef2f      		ldi	tempchar,0xff
0006f2 9320 01d8 		sts	DelayV,tempchar
0006f4 ef2f      		ldi	tempchar,0xff
0006f5 9320 01d9 		sts	DelayV+1,tempchar
0006f7 e82f      		ldi	tempchar,0x8f
0006f8 9320 01da 		sts	DelayV+2,tempchar
0006fa dfd1      		rcall	Delay
0006fb 912f      		pop	tempchar
0006fc 9508      		ret
         ;--------------------------------------------------------------------------------------------
         ;************************************************************************************
         ;*FUNCTION
         ;*  DsClock:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*input temp0=protocol register
         ;*input x=pointer to the clock return parameter (4byte)
         ;************************************************************************************
          DsClock:
         	
         		;----Set Delay Value---------------------
0006fd e230      		ldi	temp1,0x20
0006fe 9330 01d8 		sts	DelayV,temp1
000700 e530      		ldi	temp1,0x50
000701 9330 01d9 		sts	DelayV+1,temp1
000703 e031      		ldi	temp1,0x01
000704 9330 01da 		sts	DelayV+2,temp1
         		;------------------------------------------
000706 9613      		adiw	xl,3			;increase iput pointer
000707 9ab8      		sbi	DDRB,0
000708 9ab9      		sbi	DDRB,1
000709 9aba      		sbi	DDRB,2
00070a 9ac0      		sbi	portb,0			;set portb bit0=1 (reset)
00070b 98c2      		cbi	portb,2			;set portb bit2=0 (clock)
00070c e038      		ldi	temp1,8			;load counter
         		
          DsClockl01:		
         	;-------------Send  bits to protocol register (DS1603)-------------------	
00070d 9547      		ror	temp0
00070e f138      		brcs	DsClock03
00070f 98c1      		cbi	portb,1			;set portb bit1=0  (protocolregister)
         
          DsClock00:	
         	
000710 953a      		dec	temp1			;decrease counter
000711 98c2      		cbi	portb,2			;set portb bit2=0  (clock)
000712 dfb9      		rcall	Delay			;delay
000713 9ac2      		sbi	portb,2			;set portb bit2=1  (clock)
000714 dfb7      		rcall	Delay			;delay
000715 2333      		tst	temp1
000716 f7b1      		brne	DsClockl01
         	     ;----------------------------------------------	
000717 dfb4      		rcall	Delay			;delay
000718 98c1      		cbi	portb,1			;set portb bit1=0  
000719 dfb2      		rcall	Delay			;delay
         	     ;---------------------------------------------	
00071a 98b9      		cbi	DDRB,1			;Config pin 1 as an input
00071b 9ac0      		sbi	portb,0			;reset
00071c 98c2      		cbi	portb,2			;clock
00071d e230      		ldi	temp1,32		;Load counter
00071e e020      		ldi	tempchar,0		;clear tempchar
         	;-----------Read data-bits from DS1603--------------------------------------
          DsClockl02:		
00071f dfac      		rcall	Delay			;delay
000720 98c2      		cbi	portb,2			;set portb bit2=0  (clock)
000721 dfaa      		rcall	Delay			;delay
000722 9ac2      		sbi	portb,2			;set portb bit2=1  (clock)
000723 b346      		in	temp0,pinb		;read portb
000724 9488      		clc				;clear carry
000725 7042      		andi	temp0,2			;get bit 1
000726 f409      		brne	DsClock01
000727 c001      		rjmp	DsClock02
          DsClock01:
000728 9408      		sec				;set carry
          DsClock02:		
000729 9527      		ror	tempchar		;ror carry into tempchar
00072a 953a      		dec	temp1			;decrease counter
00072b 3138      		cpi	temp1,24
00072c f061      		breq	DsClock04
00072d 3130      		cpi	temp1,16
00072e f051      		breq	DsClock04
00072f 3038      		cpi	temp1,8
000730 f041      		breq	DsClock04		
000731 3030      		cpi	temp1,0
000732 f761      		brne	DsClockl02
         	    ;-----------Store Clock high word (bit25-32)-----------------	
000733 932c      	    	st	x,tempchar		;store last byte  
000734 98c0      		cbi	portb,0			;reset
000735 9508      		ret				;exit
         		
          DsClock03:  ;----------Set portb bit0=1----------------------
000736 9ac1      		sbi	portb,1			;set portb bit1=1  (protocolregister)	
000737 9488      		clc		
000738 cfd7      		rjmp	DsClock00
         
          DsClock04:  ;--Store Clock byte low word(bit1-8),(bit9-16) and high word (17-24),(25-32)---	
000739 932c      		st	x,tempchar		;store byte
00073a 9711      		sbiw	xl,1			
00073b e020      		ldi	tempchar,0		;clear tempchar
00073c cfe2      		rjmp	DsClockl02
         
         ;---------------------------------------------------------------------------------------------
         ;************************************************************************************
         ;*FUNCTION
         ;*  ClearTempBuf:
         ;*
         ;*DESCRIPTION Fill TempBuf with 0
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         
          ClearTempBuf:
00073d 933f      		push	temp1
00073e 2733      		clr	temp1		
00073f e5c0      		ldi	yl,low(TempBuf)			;Load TempBuf pointer
000740 e0d1      		ldi	yh,high(TempBuf)
000741 2722      		clr	tempchar			;Clear tempchar
          ClearTempBuf1:
000742 9329      		st	y+,tempchar
000743 9533      		inc	temp1
000744 3738      		cpi	temp1,BUFSIZE
000745 f7e1      		brne	ClearTempBuf1
000746 913f      		pop	temp1
000747 9508      		ret
         ;---------------------------------------------------------------------------------------------
         ;---------------------------------------------------------------------------------------------
         ;************************************************************************************
         ;*FUNCTION
         ;*  ClearBuf:
         ;*
         ;*DESCRIPTION Fill Buf with 0
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         
          ClearBuf:
         		;push	temp1
         		;clr	temp1		
         		;ldi	yl,low(Buf)			;Load Buf pointer
         		;ldi	yh,high(Buf)
         		;clr	tempchar			;Clear tempchar
         	
          ClearBuf1:
000748 de9a      		rcall 	Rs232GetByte
000749 3020      		cpi	tempchar,0     
00074a f7e9      		brne	ClearBuf1
         		;st	y+,tempchar
         		;inc	temp1
         		;cpi	temp1,BUFSIZE
         		;brne	ClearBuf1
         		;pop	temp1
00074b 9508      		ret
         ;---------------------------------------------------------------------------------------------
         
         ;---------------------------------------------------------------------------------------------
         ;************************************************************************************
         ;*FUNCTION
         ;*  ClearSuartBuf:
         ;*
         ;*DESCRIPTION Fill SuartBuf with 0
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         
          ClearSuartBuf:
00074c 933f      		push	temp1
00074d 2733      		clr	temp1		
00074e edc8      		ldi	yl,low(SUARTbuf)		;Load SUARTbuf pointer
00074f e0d0      		ldi	yh,high(SUARTbuf)
000750 2722      		clr	tempchar			;Clear tempchar
          ClearSuartBuf1:
000751 9329      		st	y+,tempchar
000752 9533      		inc	temp1
000753 3738      		cpi	temp1,BUFSIZE
000754 f7e1      		brne	ClearSuartBuf1
000755 913f      		pop	temp1
000756 9508      		ret
         ;---------------------------------------------------------------------------------------------
         ;************************************************************************************
         ;*FUNCTION
         ;*  MoveString:
         ;*
         ;*DESCRIPTION Moves string from source positon to target positon
         ;*            z points at source positon and y points at target positon
         ;*	      Sorce string must be null terminated.
         ;*
         ;*PARAMETER
         ;*  z source pointer, y target pointer
         ;*
         ;*
         ;************************************************************************************
         
          MoveString:
000757 9121      		ld	tempchar,z+
000758 9329      		st	y+,tempchar
000759 3020      		cpi	tempchar,0
00075a f7e1      		brne	MoveString
00075b 9508      		ret
         ;---------------------------------------------------------------------------------------------
         
         ;---------------------------------------------------------------------------------------------
         ;************************************************************************************
         ;*FUNCTION
         ;*  MFTR:
         ;*
         ;*DESCRIPTION Moves data from flash memory to ram memory
         ;*            z points at source positon and y points at target positon
         ;*	      Sorce string must be null terminated.
         ;*
         ;*PARAMETER
         ;*  z source pointer, y target pointer
         ;*
         ;*
         ;************************************************************************************
         
          MFTR:
00075c 95c8      		lpm	
00075d 9631      		adiw	zl,1
00075e 9209      		st	y+,r0
00075f 2d20      		mov	tempchar,r0
000760 3020      		cpi	tempchar,0
000761 f7d1      		brne	MFTR
000762 9508      		ret
         ;---------------------------------------------------------------------------------------------
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  PhoneInit:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         
          PhoneInit:
         		;----Set echo off------------------------
000763 e1e2      		ldi 	zl,low(2*ate0)				;Load strinpointer
000764 e1fd      		ldi 	zh,high(2*ate0)
000765 dea6      		rcall	PrintStr
000766 e5c0      		ldi	yl,low(TempBuf)
000767 e0d1      		ldi	yh,high(TempBuf)
000768 df87      		rcall	LongDelay
         		;----Set Delay Value---------------------
000769 e240      		ldi	temp0,0x20
00076a 9340 01d8 		sts	DelayV,temp0
00076c e540      		ldi	temp0,0x50
00076d 9340 01d9 		sts	DelayV+1,temp0
00076f e041      		ldi	temp0,0x01
000770 9340 01da 		sts	DelayV+2,temp0
         		;----------------------------------------
000772 2744      		clr	temp0					;Init counter
         	
          PhoneInit0:
         		;rcall	ClearBuf
         		;ldi	rxhead,0
         		;ldi	rxtail,0
000773 2722      		clr	tempchar
000774 9320 0150 		sts	TempBuf,tempchar
000776 3040      		cpi	temp0,0
000777 f131      		breq	PhoneInit_ate0
000778 3041      		cpi	temp0,1
000779 f161      		breq	PhoneInit_atcicb
00077a 3042      		cpi	temp0,2
00077b f091      		breq	PhoneInit_ats0;PhoneInit_atcpin
00077c 3043      		cpi	temp0,3
00077d f0c1      		breq	PhoneInit_atcpin ;PhoneInit_ats0
00077e 3044      		cpi	temp0,4
00077f f031      		breq	PhoneInit_atcpa;PhoneInit_atcmgd
000780 3045      		cpi	temp0,5
000781 f161      		breq	PhoneInit_atcmgd
000782 3046      		cpi	temp0,6
000783 f009      		breq	PhoneTinitExit
000784 c031      		rjmp	PhoneInit1
          PhoneTinitExit: 
000785 c056      		rjmp	PhoneInitExit	
         ;----------------------------------------------------------------------------------			
          PhoneInit_atcpa:;-----------------------------------------------------
000786 e8ec      		ldi 	zl,low(2*atcpina)			;Load strinpointer
000787 e1fd      		ldi 	zh,high(2*atcpina)
000788 de83      		rcall	PrintStr
000789 e5c0      		ldi	yl,low(TempBuf)
00078a e0d1      		ldi	yh,high(TempBuf)
         			;----Set Delay Value---------------------
         	;	ldi	tempchar,0xff
         	;	sts	DelayV,tempchar
         	;	ldi	tempchar,0xff
         	;	sts	DelayV+1,tempchar
         	;	ldi	tempchar,0xff
         	;	sts	DelayV+2,tempchar
         		;----------------------------------------
         		;rcall	Delay
00078b df64      		rcall	LongDelay
00078c df56      		rcall	ShortDelay
         			;----Set Delay Value---------------------
         	;	ldi	tempchar,0x20
         	;	sts	DelayV,tempchar
         	;	ldi	tempchar,0x50
         	;	sts	DelayV+1,tempchar
         	;	ldi	tempchar,0x01
         	;	sts	DelayV+2,tempchar
         		;----------------------------------------
         		
00078d c028      		rjmp	PhoneInit1
          PhoneInit_ats0:;-----------------------------------------------
00078e e6e0      		ldi 	zl,low(2*ats01)				;Load strinpointer
00078f e1fd      		ldi 	zh,high(2*ats01)
000790 de7b      		rcall	PrintStr
000791 e5c0      		ldi	yl,low(TempBuf)
000792 e0d1      		ldi	yh,high(TempBuf)
         			;----Set Delay Value---------------------
         		
         		;----------------------------------------
         		;rcall	Delay
000793 df5c      		rcall	LongDelay
000794 df4e      		rcall	ShortDelay
         		
000795 c020      		rjmp	PhoneInit1
          PhoneInit_atcpin:;-----------------------------------------------
000796 e2e4      		ldi 	zl,low(2*atcpin)			;Load strinpointer
000797 e1fd      		ldi 	zh,high(2*atcpin)
000798 de73      		rcall	PrintStr
000799 e5c0      		ldi	yl,low(TempBuf)
00079a e0d1      		ldi	yh,high(TempBuf)
00079b df54      		rcall	LongDelay
00079c df46      		rcall	ShortDelay
         		;rcall	Delay
00079d c018      		rjmp	PhoneInit1
          PhoneInit_ate0:;----------Print ate0----------------------------
00079e e1e2      		ldi 	zl,low(2*ate0)				;Load strinpointer
00079f e1fd      		ldi 	zh,high(2*ate0)
0007a0 de6b      		rcall	PrintStr
0007a1 e5c0      		ldi	yl,low(TempBuf)
0007a2 e0d1      		ldi	yh,high(TempBuf)			
         				;----Set Delay Value---------------------
         		;ldi	tempchar,0xff
         		;sts	DelayV,tempchar
         		;ldi	tempchar,0xff
         		;sts	DelayV+1,tempchar
         		;ldi	tempchar,0xff
         		;sts	DelayV+2,tempchar
         		;----------------------------------------
0007a3 df4c      		rcall	LongDelay
0007a4 df3e      		rcall	ShortDelay
         			;----Set Delay Value---------------------
         		;ldi	tempchar,0x20
         		;sts	DelayV,tempchar
         		;ldi	tempchar,0x50
         		;sts	DelayV+1,tempchar
         		;ldi	tempchar,0x01
         		;sts	DelayV+2,tempchar
         		;----------------------------------------
0007a5 c010      		rjmp	PhoneInit1
          PhoneInit_atcicb:;-----------------------------------------------
0007a6 e1e8      		ldi 	zl,low(2*atcicb)			;Load strinpointer
0007a7 e1fd      		ldi 	zh,high(2*atcicb)
0007a8 de63      		rcall	PrintStr
0007a9 e5c0      		ldi	yl,low(TempBuf)
0007aa e0d1      		ldi	yh,high(TempBuf)
         		;rcall	Delay
0007ab df44      		rcall	LongDelay
0007ac df36      		rcall	ShortDelay
0007ad c008      		rjmp	PhoneInit1
          PhoneInit_atcmgd:;-----------------------------------------------
0007ae e7e0      		ldi 	zl,low(2*atcmgd)			;Load strinpointer
0007af e1fd      		ldi 	zh,high(2*atcmgd)
0007b0 de5b      		rcall	PrintStr
         		;rcall	Delay
0007b1 e5c0      		ldi	yl,low(TempBuf)
0007b2 e0d1      		ldi	yh,high(TempBuf)
0007b3 df3c      		rcall	LongDelay
0007b4 df2e      		rcall	ShortDelay
0007b5 c000      		rjmp	PhoneInit1													
         ;---------------------------------------------------------------------------------
          PhoneInit1:	
0007b6 df15      		rcall	Delay	
0007b7 de2b      		rcall 	Rs232GetByte				;Get char
         		;cpi	tempchar,13
         		;breq	PhoneInit1;PhoneInit1
0007b8 302a      		cpi	tempchar,10
0007b9 f021      		breq	PhoneInit2
0007ba 3020      		cpi	tempchar,0				
0007bb f3d1      		breq 	PhoneInit1
0007bc 9329      		st	y+,tempchar
0007bd cff8      		rjmp	PhoneInit1
          PhoneInit2:
0007be 2722      		clr	tempchar
0007bf 9329      		st	y+,tempchar
         		;ldi	rxhead,0
         		;ldi	rxtail,0
         ;----------------Test--------------------------------------------------------
         
         ;---------------Test for OK--------------------------------------------------
0007c0 e1ec      		ldi 	zl,low(2*OK)			;Load stringpointer source
0007c1 e1fc      		ldi 	zh,high(2*OK)
0007c2 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
0007c3 e0d1      		ldi	yh,high(TempBuf)
0007c4 de80      		rcall	StrSearch
0007c5 23cc      		tst	yl	
0007c6 f009      		breq	PhoneInit3 ;PhoneInitExit     ;TestforClock
0007c7 c015      		rjmp	ActionOk
         ;---------------Test for ERROR--------------------------------------------------				
          PhoneInit3:
0007c8 e2e0      		ldi 	zl,low(2*Error)			;Load stringpointer source
0007c9 e1fc      		ldi 	zh,high(2*Error)
0007ca e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
0007cb e0d1      		ldi	yh,high(TempBuf)
0007cc de78      		rcall	StrSearch
0007cd 23cc      		tst	yl	
0007ce f009      		breq	PhoneInit4 ;PhoneInitExit     ;TestforClock
0007cf c012      		rjmp	ActionError				
         		;rcall	Rs232GetByte				;Get char
         		;cpi	tempchar,13
         		;brne	PhoneInit3
         ;---------------Test for +CPIN: READY------------------------------------------------------		
          PhoneInit4:
0007d0 e2e6      		ldi 	zl,low(2*cpiready)			;Load stringpointer source
0007d1 e1fc      		ldi 	zh,high(2*cpiready)
0007d2 e5c0      		ldi	yl,low(TempBuf)			;Load stringpointer destination
0007d3 e0d1      		ldi	yh,high(TempBuf)
0007d4 de70      		rcall	StrSearch
0007d5 23cc      		tst	yl	
0007d6 f009      		breq	PhoneTinit0 ;PhoneInitExit     ;TestforClock
0007d7 c00e      		rjmp	ActionCpinready	
         		;rcall	Rs232GetByte				;Get char
         		;cpi	tempchar,10
         		;brne	PhoneInit4		
         		;inc	temp0					;Increase counter
         		;rjmp	PhoneInit0
          PhoneTinit0:
         		;rcall	Rs232GetByte
         		;cpi	tempchar,0
         		;brne	PhoneTinit0
0007d8 2722      		clr	tempchar
0007d9 9320 0150 		sts	TempBuf,tempchar
0007db cf97      		rjmp	PhoneInit0		
          PhoneInitExit:	
0007dc 9508      		ret
         		
         
         
         	
         
         	
         	
         ;---------------------Phone_Action--------------------------------------------------------		
          ActionOk:
0007dd 9543      		inc	temp0					;Increase counter
0007de 2722      		clr	tempchar
0007df 9320 0150 		sts	TempBuf,tempchar
         		;rcall	ClearTempBuf
0007e1 cf91      		rjmp	PhoneInit0					
         ;------------------------------------------------------------------------------------------
          ActionError:
0007e2 2722      		clr	tempchar
0007e3 9320 0150 		sts	TempBuf,tempchar
         		;rcall	ClearTempBuf
0007e5 cf8d      		rjmp	PhoneInit0
         ;------------------------------------------------------------------------------------------
          ActionCpinready:
0007e6 9543      		inc	temp0
0007e7 2722      		clr	tempchar
0007e8 9320 0150 		sts	TempBuf,tempchar
0007ea cf88      		rjmp	PhoneInit0		
         ;-------------------------------------------------------------------------------------------
         ;************************************************************************************
         ;*FUNCTION
         ;*  PhoneInit00:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         
          PhoneInit00:
         		;----To start modem set pin 16 high (power ON)--------------------- 
0007eb 9ad8      		sbi	porta,0
0007ec df03      		rcall	LongDelay
0007ed df02      		rcall	LongDelay
0007ee df01      		rcall	LongDelay
0007ef 98d8      		cbi	porta,0
         		;----Set echo off------------------------
0007f0 e1e2      		ldi 	zl,low(2*ate0)				;Load strinpointer
0007f1 e1fd      		ldi 	zh,high(2*ate0)
0007f2 de19      		rcall	PrintStr
0007f3 defc      		rcall	LongDelay
0007f4 defb      		rcall	LongDelay
         		;---Set incoming call type to data------------
0007f5 e1e8      		ldi 	zl,low(2*atcicb)			;Load strinpointer
0007f6 e1fd      		ldi 	zh,high(2*atcicb)
0007f7 de14      		rcall	PrintStr
0007f8 def7      		rcall	LongDelay	
         		;--Set pin code--------------------------------
0007f9 e2e4      		ldi 	zl,low(2*atcpin)				;Load strinpointer
0007fa e1fd      		ldi 	zh,high(2*atcpin)
0007fb de10      		rcall	PrintStr
0007fc def3      		rcall	LongDelay
         		;rcall	LongDelay
         		;rcall	LongDelay
         		;--Automatic answer after 2 rings-------------
         		;ldi 	zl,low(2*ats01)				;Load strinpointer
         		;ldi 	zh,high(2*ats01)
         		
         		;--No automatic answer---------------------------------------
0007fd e6e8      		ldi 	zl,low(2*ats00)				;Load strinpointer
0007fe e1fd      		ldi 	zh,high(2*ats00)
0007ff de0c      		rcall	PrintStr
000800 deef      		rcall	LongDelay
000801 deee      		rcall	LongDelay
         		;--Clear all SMS----------------------------
         		;ldi 	zl,low(2*atcmgd)			;Load strinpointer
         		;ldi 	zh,high(2*atcmgd)
         		;rcall	PrintStr
         		;rcall 	Rs232GetByte	
000802 9508      		ret
         		
         ;************************************************************************************
         ;*FUNCTION
         ;*  '
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         
          SendSms:
         		;sbi	PORTD,6
         		;----------------------------
000803 e9e6      		ldi 	zl,low(2*atcmgf1)				;Load strinpointer
000804 e1fd      		ldi 	zh,high(2*atcmgf1)
000805 de06      		rcall	PrintStr
000806 dee9      		rcall	LongDelay
         		;trcall	LongDelay
         		;--Set nuber to Sms-station-------------------
         		;ldi 	zl,low(2*atcsca)			;Load strinpointer
         		;ldi 	zh,high(2*atcsca)
         		;rcall	PrintStr
         		;rcall	LongDelay	
         		;----------------------------------
000807 e5e6      		ldi 	zl,low(2*atcmgs)				;Load strinpointer
000808 e1fd      		ldi 	zh,high(2*atcmgs)
000809 de02      		rcall	PrintStr
00080a edeb      		ldi	zl,low(phoneno)
00080b e0f1      		ldi	zh,high(phoneno)
00080c de09      		rcall	PrintBuf
00080d e222      		ldi	tempchar,34
00080e d920      		rcall	PutcHardUart
         		;rcall	LongDelay
00080f e02d      		ldi	tempchar,13
000810 d91e      		rcall 	PutcHardUart
000811 dede      		rcall	LongDelay
         		;---------------
         	
         		;--Write SMS-message---------------------------
000812 e5e0      		ldi 	zl,low(TempBuf)			;Load strinpointer
000813 e0f1      		ldi 	zh,high(TempBuf)
000814 de01      		rcall	PrintBuf
000815 deda      		rcall	LongDelay	;t
000816 e12a      		ldi	tempchar,26
000817 d917      		rcall	PutcHardUart
000818 ded7      		rcall	LongDelay
000819 ded6      		rcall	LongDelay
         		;----------------------------------
00081a e7ee      		ldi 	zl,low(2*atcmgd0)				;Load strinpointer
00081b e1fd      		ldi 	zh,high(2*atcmgd0)
         		;ldi 	zl,low(2*atcmgd)				;Load strinpointer
         		;ldi 	zh,high(2*atcmgd)
00081c ddef      		rcall	PrintStr
00081d ded2      		rcall	LongDelay
         		;cbi	PORTD,6
         		;---------------
00081e ded1      		rcall	LongDelay
00081f ded0      		rcall	LongDelay					;test
000820 decf      		rcall	LongDelay
         		
         		;ldi 	zl,low(2*atcmgl)				;test Load strinpointer
         		;ldi 	zh,high(2*atcmgl)				;test
         		;rcall	PrintStr
         		;tldi 	zl,low(2*atcmgr2)			;Load strinpointer
         		;tldi 	zh,high(2*atcmgr2)
         		;trcall	PrintStr
         		;cbi	PORTD,6
         		;trcall	LongDelay
         		;trcall	LongDelay
         		;trcall	LongDelay
         		;trcall	LongDelay
000821 d03c      		rcall	ReadSms					;test
         		
000822 9508      		ret
         		
         ;************************************************************************************
         ;*FUNCTION
         ;*  SendSms:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         
          SendSms0:
         		;sbi	PORTD,6
         		;----------------------------
         
         		;----------------------------
000823 e9e6      		ldi 	zl,low(2*atcmgf1)				;Load strinpointer
000824 e1fd      		ldi 	zh,high(2*atcmgf1)
000825 dde6      		rcall	PrintStr
000826 dec9      		rcall	LongDelay
         		;trcall	LongDelay
         		;--Set nuber to Sms-station-------------------
         		;ldi 	zl,low(2*atcsca)			;Load strinpointer
         		;ldi 	zh,high(2*atcsca)
         		;rcall	PrintStr
         		;rcall	LongDelay	
         		;----------------------------------
000827 e5e6      		ldi 	zl,low(2*atcmgs)				;Load strinpointer
000828 e1fd      		ldi 	zh,high(2*atcmgs)
000829 dde2      		rcall	PrintStr
00082a edeb      		ldi	zl,low(phoneno)
00082b e0f1      		ldi	zh,high(phoneno)
00082c dde9      		rcall	PrintBuf
00082d e222      		ldi	tempchar,34
00082e d900      		rcall	PutcHardUart
         		;rcall	LongDelay
00082f e02d      		ldi	tempchar,13
000830 d8fe      		rcall 	PutcHardUart
000831 debe      		rcall	LongDelay
         		;---------------
         	
         		;--Write SMS-message---------------------------
000832 e5e0      		ldi 	zl,low(TempBuf)			;Load strinpointer
000833 e0f1      		ldi 	zh,high(TempBuf)
000834 dde1      		rcall	PrintBuf
000835 deba      		rcall	LongDelay	;t
000836 e12a      		ldi	tempchar,26
000837 d8f7      		rcall	PutcHardUart
000838 deb7      		rcall	LongDelay
000839 deb6      		rcall	LongDelay
         		;----------------------------------
00083a e7ee      		ldi 	zl,low(2*atcmgd0)				;Load strinpointer
00083b e1fd      		ldi 	zh,high(2*atcmgd0)
         		;ldi 	zl,low(2*atcmgd)				;Load strinpointer
         		;ldi 	zh,high(2*atcmgd)
00083c ddcf      		rcall	PrintStr
00083d deb2      		rcall	LongDelay
         		;cbi	PORTD,6
         		;---------------
00083e deb1      		rcall	LongDelay
00083f deb0      		rcall	LongDelay					;test
000840 deaf      		rcall	LongDelay
         		
         		;ldi 	zl,low(2*atcmgl)				;test Load strinpointer
         		;ldi 	zh,high(2*atcmgl)				;test
         		;rcall	PrintStr
         		;tldi 	zl,low(2*atcmgr2)			;Load strinpointer
         		;tldi 	zh,high(2*atcmgr2)
         		;trcall	PrintStr
         		;cbi	PORTD,6
         		;trcall	LongDelay
         		;trcall	LongDelay
         		;trcall	LongDelay
         		;trcall	LongDelay
000841 d01c      		rcall	ReadSms					;test
000842 dead      		rcall	LongDelay
000843 deac      		rcall	LongDelay
000844 deab      		rcall	LongDelay
         ;		rcall	LongDelay
         ;		rcall	LongDelay
         ;		rcall	LongDelay
         ;		rcall	LongDelay
         ;		rcall	LongDelay
         ;		rcall	LongDelay
         ;		rcall	ClearCrFlag		;Clear CrFlag
         ;		rcall 	ClearBuf
         ;		rcall	ClearTempBuf
         ;		ldi	rxhead,0
         ;		ldi	rxtail,0
000845 9508      		ret		
         ;---------------------------------------------------------------------------------------------
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  lampTest:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         						
         						
          lampTest:		
         		;ldi	zl,low(TempBuf)
         		;ldi	zh,high(TempBuf)
         		;ld	tempchar,z		;Load byte from program memory into tempchar
         		
000846 9120 0153 		lds	tempchar,TempBuf+3
         		;mov	u_data,tempchar
         	        ;rcall	putc
         		;push	tempchar
000848 9140 01ff 		lds	temp0,lampStatus	;Load lampStatus
         		;mov	u_data,temp0
         		;rcall	putc
00084a 1742      		cp	temp0,tempchar
00084b f039      		breq	lampTestExit
         		;clr	temp0
         		;sts	pollFlag,temp0
         		;ldi	temp0,1
         		;sts	SmsFlag,temp0
         		;-------------------------------------------------------
         		;----Copy TempPhoneno to Phoneno--
00084c eeea      		ldi	zl,low(TempPhoneno)
00084d e0f1      		ldi	zh,high(TempPhoneno)
00084e edcb      		ldi	yl,low(Phoneno)
00084f e0d1      		ldi	yh,high(Phoneno)
         		;adiw	zl,1
000850 df06      		rcall	MoveString
         		;-----------------------------------
         		;-------------------------------------------
000851 dfb1      		rcall	SendSms
         		;;clr	temp0
         		;;sts	SmsFlag,temp0		;Set SmsFlag off
         		;lds	temp0,Bflags
         		;cbr	temp0,2
         		;sts	Bflags,temp0
000852 d257      		rcall	ClearSmsFlag		;Clear SmsFlag
         		;--------------------------------------------------------
          lampTestExit:
         		;pop	tempchar		
000853 9120 0153 		lds	tempchar,TempBuf+3
000855 9320 01ff 		sts	lampStatus,tempchar	;Save lampStatus
         		
         
000857 2744      		clr	temp0			 
000858 9340 01f9 		sts	Count,temp0		;clear time counter
00085a 9340 0150 		sts	TempBuf,temp0
00085c d8bf      		rcall	timer1_init	
00085d 9508      		ret
         		
         ;************************************************************************************
         ;*FUNCTION
         ;*  ReadSms:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         						
         						
          ReadSms:
00085e 9140 0200 		lds	temp0,SmsCount
000860 3041      		cpi	temp0,1 
000861 f061      		breq	ReadSms1
000862 3042      		cpi	temp0,2
000863 f069      		breq	ReadSms2
000864 3043      		cpi	temp0,3
000865 f071      		breq	ReadSms3
000866 3044      		cpi	temp0,4
000867 f079      		breq	ReadSms4
000868 3045      		cpi	temp0,5
000869 f081      		breq	ReadSms5
00086a 2744      		clr	temp0
00086b 9340 0200 		sts	SmsCount,temp0
00086d c019      		rjmp	ReadSmsExit0
         		
         		
          ReadSms1:	
         		
00086e ebe2      		ldi 	zl,low(2*atcmgr1)			;Load strinpointer
00086f e1fd      		ldi 	zh,high(2*atcmgr1)
000870 c00c      		rjmp	ReadSmsExit
          ReadSms2:	
000871 ebee      		ldi 	zl,low(2*atcmgr2)			;Load strinpointer
000872 e1fd      		ldi 	zh,high(2*atcmgr2)
000873 c009      		rjmp	ReadSmsExit
          ReadSms3:
000874 ecea      		ldi 	zl,low(2*atcmgr3)			;Load strinpointer
000875 e1fd      		ldi 	zh,high(2*atcmgr3)
000876 c006      		rjmp	ReadSmsExit
          ReadSms4:
000877 ede6      		ldi 	zl,low(2*atcmgr4)			;Load strinpointer
000878 e1fd      		ldi 	zh,high(2*atcmgr4)
000879 c003      		rjmp	ReadSmsExit
          ReadSms5:
00087a eee2      		ldi 	zl,low(2*atcmgr5)			;Load strinpointer
00087b e1fd      		ldi 	zh,high(2*atcmgr5)
00087c c000      		rjmp	ReadSmsExit		
         		
         		
          ReadSmsExit:			
         		
00087d dd8e      		rcall	PrintStr
00087e 9140 0200 		lds	temp0,SmsCount
000880 9543      		inc	temp0
000881 9340 0200 		sts	SmsCount,temp0
000883 2744      		clr	temp0
000884 2f04      		mov	rxhead,temp0
000885 2f14      		mov	rxtail,temp0
000886 de69      		rcall	LongDelay
         		;rcall	LongDelay
         		;rcall	LongDelay
         		;rcall	LongDelay
          ReadSmsExit0:
000887 9508      		ret
         
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  ReadSms:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         						
         						
          ReadSms00:	
         		
000888 eeee      		ldi 	zl,low(2*atcmgr)			;Load strinpointer
000889 e1fd      		ldi 	zh,high(2*atcmgr)
00088a dd81      		rcall	PrintStr
00088b 9120 0201 		lds	tempchar,SmsNo
         		;ldi	tempchar,13
00088d d8a1      		rcall	PutcHardUart
00088e 9120 0202 		lds	tempchar,SmsNo+1
000890 302d      		cpi	tempchar,13 
000891 f009      		breq	ReadSms00Exit
000892 e02d      		ldi	tempchar,13
         		;rcall	LongDelay;t
         		
         		
          ReadSms00Exit:	
000893 d89b      		rcall	PutcHardUart		
000894 9140 0200 		lds	temp0,SmsCount
000896 9543      		inc	temp0
000897 9340 0200 		sts	SmsCount,temp0
000899 2744      		clr	temp0
00089a 2f04      		mov	rxhead,temp0
00089b 2f14      		mov	rxtail,temp0
00089c de53      		rcall	LongDelay
00089d 9508      		ret
         		
         		
         ;************************************************************************************
         ;*FUNCTION
         ;*  ReadSoftUart:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         
          ReadSoftUart:
00089e 2744      		clr	temp0
00089f 9340 01fc 		sts	TimeOutCount,temp0
0008a1 9340 01fd 		sts	TimeOutCount+1,temp0
0008a3 9340 01fe 		sts	TimeOutCount+2,temp0
         		
         		;cpi	flag,1	
         		;brne	ReadSoftUart
         
          ReadSoftUart00: ;------TimeOut loop--------------------------------
0008a5 95a8      		wdr					;watchdog reset
0008a6 3091      		cpi	flag,1
0008a7 f091      		breq	ReadSoftUart0
0008a8 9543      		inc	temp0
0008a9 3f4f      		cpi	temp0,255
0008aa f7d1      		brne	ReadSoftUart00
0008ab 9130 01fc 		lds	temp1,TimeOutCount
0008ad 9533      		inc	temp1
0008ae 9330 01fc 		sts	TimeOutCount,temp1
0008b0 3f3f      		cpi	temp1,255
0008b1 f799      		brne	ReadSoftUart00
         		
         		
0008b2 9130 01fd 		lds	temp1,TimeOutCount+1
0008b4 9533      		inc	temp1
0008b5 9330 01fd 		sts	TimeOutCount+1,temp1
0008b7 3f3f      		cpi	temp1,255
0008b8 f761      		brne	ReadSoftUart00
         		
0008b9 c024      		rjmp	ReadSoftUart5
         		;-----End TimeOutLoop---------------------------------
         ;wint0:
          ReadSoftUart0:
0008ba 9130 01d7 		lds	temp1,BL15
0008bc bf32      		out	TCNT0,temp1 				; preset T/C0 to 1.5 bit lengths
0008bd e032      		ldi	temp1,1<<TOIE0
0008be bf38      		out	TIFR,temp1				; clear T/C0 overflow flag
0008bf bf39      		out	TIMSK,temp1				; enable T/C0 overflow Interrupt
0008c0 2777      		clr	bit_cnt					; clear bit counter
         ;wgetc1:		
          ReadSoftUart1:
0008c1 ff81      		sbrs	u_stat,SRXC				; wait for Receive Complete
         		;rjmp	wgetc1
0008c2 cffe      		rjmp	ReadSoftUart1
0008c3 7f8d      		cbr	u_stat,1<<SRXC				; clear SRXC
0008c4 3050      		cpi	u_data,0				;test to ingnore null
0008c5 f081      		breq	ReadSoftUart3				;test
0008c6 9130 00d8 		lds	temp1,SUARTbuf				;load buf length counter
0008c8 9533      		inc	temp1					;increase counter
0008c9 9330 00d8 		sts	SUARTbuf,temp1				;store counter
0008cb ede8      		ldi	zl,low(SUARTbuf)
0008cc e0f0      		ldi	zh,high(SUARTbuf)
0008cd 1fe3      		adc	zl,temp1
         		;brcc	wgetcj
0008ce f408      		brcc	ReadSoftUart2
0008cf 95f3      		inc	zh
         ;wgetcj:		
          ReadSoftUart2:		
0008d0 8350      		st	z,u_data				;store char in buffer		
         		;breq	wflag
0008d1 f021      		breq	ReadSoftUart3
0008d2 305d      		cpi	u_data,13    				;'cr' 
         		;breq	wgetc2
0008d3 f021      		breq	ReadSoftUart4
0008d4 3053      		cpi	u_data,3				;ETX
0008d5 f011      		breq	ReadSoftUart4				
         		;cpi	u_data,0				;test to ingnore null
         		;brne	ReadSoftUart3				;test
         		;dec	temp1					;test
         		;ldi	u_data,' '				;test
         		
         ;wflag:
          ReadSoftUart3:
0008d6 e090      		ldi	flag,0
         		;cbi	PORTD,6					;RTS Off
         		;rjmp	main
0008d7 cfc6      		rjmp	ReadSoftUart
         ;wgetc2:
          ReadSoftUart4:	
0008d8 ede8      		ldi	zl,low(SUARTbuf)			;load stringpointer
0008d9 e0f0      		ldi	zh,high(SUARTbuf)
0008da 9533      		inc	temp1
0008db 1fe3      		adc	zl,temp1
         		;brcc	wgetcj0
0008dc f408      		brcc	ReadSoftUart5
0008dd 95f3      		inc	zh
         
         
         
         
         
         ;wgetcj0:
          ReadSoftUart5:
0008de 2744      		clr	temp0					;terminate buffer	
0008df 8340      		st	z,temp0
0008e0 ede8      		ldi	zl,low(SUARTbuf)
0008e1 e0f0      		ldi	zh,high(SUARTbuf)
0008e2 9631      		adiw	zl,1
0008e3 2744      		clr 	temp0
0008e4 9340 00d8 		sts	SUARTbuf,temp0				;clear counter
0008e6 e090      		ldi	flag,0
0008e7 9896      		cbi	PORTD,6	
         
         
         
         
0008e8 9508      		ret
         		
         ;************************************************************************************
         ;*FUNCTION
         ;*  ReadPacketSoftUart:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         
          ReadPacketSoftUart:
0008e9 2744      		clr	temp0
0008ea 9340 01fc 		sts	TimeOutCount,temp0
0008ec 9340 01fd 		sts	TimeOutCount+1,temp0
0008ee 9340 01fe 		sts	TimeOutCount+2,temp0
         		
         		;cpi	flag,1	
         		;brne	ReadPacketSoftUart
          ReadPacketSoftUart00: ;------TimeOut loop--------------------------------	
0008f0 3091      		cpi	flag,1
0008f1 f091      		breq	ReadPacketSoftUart0
         		;push	temp0
         		;push	temp1
         		;in	temp1,pinc			;read portc
         		;andi	temp1,63;15			;get bit 0,1,2,3,4,5  1+2+4+8+16+32=63, If not 63 then Button 
         		;ldi	temp0,63;15
         		;cpse	temp1,temp0
         		;rjmp	ReadPacketSoftUartExit
         		;pop	temp1
         		;pop	temp0
0008f2 9543      		inc	temp0
0008f3 3f4f      		cpi	temp0,255
0008f4 f7d9      		brne	ReadPacketSoftUart00
0008f5 9130 01fc 		lds	temp1,TimeOutCount
0008f7 9533      		inc	temp1
0008f8 9330 01fc 		sts	TimeOutCount,temp1
0008fa 3f3f      		cpi	temp1,255
0008fb f7a1      		brne	ReadPacketSoftUart00
         		
         		
0008fc 9130 01fd 		lds	temp1,TimeOutCount+1
0008fe 9533      		inc	temp1
0008ff 9330 01fd 		sts	TimeOutCount+1,temp1
000901 3f3f      		cpi	temp1,255
000902 f769      		brne	ReadPacketSoftUart00
         		
000903 c020      		rjmp	ReadPacketSoftUart5
         		;-----End TimeOutLoop---------------------------------
         ;wint0:
          ReadPacketSoftUart0:
000904 9130 01d7 		lds	temp1,BL15
000906 bf32      		out	TCNT0,temp1 				; preset T/C0 to 1.5 bit lengths
000907 e032      		ldi	temp1,1<<TOIE0
000908 bf38      		out	TIFR,temp1				; clear T/C0 overflow flag
000909 bf39      		out	TIMSK,temp1				; enable T/C0 overflow Interrupt
00090a 2777      		clr	bit_cnt					; clear bit counter
         ;wgetc1:		
          ReadPacketSoftUart1:
00090b ff81      		sbrs	u_stat,SRXC				; wait for Receive Complete
         		;rjmp	wgetc1
00090c cffe      		rjmp	ReadPacketSoftUart1
00090d 7f8d      		cbr	u_stat,1<<SRXC				; clear SRXC
         		;cpi	u_data,0				;test to ingnore null
         		;breq	ReadPacketSoftUart3				;test
00090e 9130 00d8 		lds	temp1,SUARTbuf				;load buf length counter
000910 9533      		inc	temp1					;increase counter
000911 9330 00d8 		sts	SUARTbuf,temp1				;store counter
000913 ede8      		ldi	zl,low(SUARTbuf)
000914 e0f0      		ldi	zh,high(SUARTbuf)
000915 1fe3      		adc	zl,temp1
         		;brcc	wgetcj
000916 f408      		brcc	ReadPacketSoftUart2
000917 95f3      		inc	zh
         ;wgetcj:		
          ReadPacketSoftUart2:		
000918 8350      		st	z,u_data				;store char in buffer		
000919 f011      		breq	ReadPacketSoftUart3
00091a 1723      		cp	tempchar,temp1
         		;cpi	temp1,2
         		;breq	ReadPacketSoftUartExit1			;test
00091b f011      		breq	ReadPacketSoftUart4
         		;cpi	u_data,13    				;'cr' 
         		;breq	ReadPacketSoftUart4
         		;cpi	u_data,3				;ETX
         		;breq	ReadPacketSoftUart4				
         		;cpi	u_data,0				;test to ingnore null
         		;brne	ReadSoftUart3				;test
         		;dec	temp1					;test
         		;ldi	u_data,' '				;test
         		
         ;wflag:
          ReadPacketSoftUart3:
00091c e090      		ldi	flag,0
         		;cbi	PORTD,6					;RTS Off
         		;rjmp	main
00091d cfcb      		rjmp	ReadPacketSoftUart
         ;wgetc2:
          ReadPacketSoftUart4:	
00091e ede8      		ldi	zl,low(SUARTbuf)			;load stringpointer
00091f e0f0      		ldi	zh,high(SUARTbuf)
000920 9533      		inc	temp1
000921 1fe3      		adc	zl,temp1
         		;brcc	wgetcj0
000922 f408      		brcc	ReadPacketSoftUart5
000923 95f3      		inc	zh
         
         
         
         
         
         ;wgetcj0:
          ReadPacketSoftUart5:
000924 2744      		clr	temp0					;terminate buffer	
000925 8340      		st	z,temp0
000926 ede8      		ldi	zl,low(SUARTbuf)
000927 e0f0      		ldi	zh,high(SUARTbuf)
000928 9631      		adiw	zl,1
000929 2744      		clr 	temp0
00092a 9340 00d8 		sts	SUARTbuf,temp0				;clear counter
00092c e090      		ldi	flag,0
00092d 9896      		cbi	PORTD,6	
00092e c00b      		rjmp	ReadPacketSoftUartExit1	
         
          ReadPacketSoftUartExit:
00092f 9130 01f9 		lds	temp1,Count			;Load poll count
000931 3033      		cpi	temp1,3;50			
000932 f408      		brsh	ReadPacketSoftUartExit0
000933 cfbc      		rjmp	ReadPacketSoftUart00	
          ReadPacketSoftUartExit0:
         		
000934 e090      		ldi	flag,0
000935 9896      		cbi	PORTD,6
000936 2744      		clr	temp0
000937 9340 01f9 		sts	Count,temp0
000939 c7a6      		rjmp	main	
          ReadPacketSoftUartExit1:		
00093a 9508      		ret		
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  SharpButton:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************						
         
          SharpButton:
         
         	;	sbi	PORTD,6	
         		;-----Button_1--------
         	;	sbis	pinc,0
         	;	rjmp	SharpButton1
         		;----Button_2----------
         	;	sbis	pinc,1
         	;	rjmp	SharpButton2
         		;----Button_3----------
         	;	sbis	pinc,2
         	;	rjmp	SharpButton3
         		;----Button_4----------
00093b 9b9b      		sbis	pinc,3
00093c c013      		rjmp	SharpButton4
         		;----Button_5----------
00093d 9b9c      		sbis	pinc,4
00093e c014      		rjmp	SharpButton5
         		;----Button_6----------
00093f 9b9d      		sbis	pinc,5
000940 c032      		rjmp	SharpButton6
000941 c07a      		rjmp	SharpButtonExit0
         
          SharpButton1:
000942 d40c      		rcall	Ds2406_pioaON
000943 c06e      		rjmp	SharpButtonExit1
         	;	ldi	temp0,2
         	;	ldi	xl,low(LongWord)
         	;	ldi	xh,high(LongWord)		;Load pointer to clock return value
         	;	wdr
         	;	rcall	DsClock
         	;	wdr
000944 c001      		rjmp	SharpButton1_1
         		
         		
         ;		cbi	portb,sck
         ;		cbi	portb,mosi
         ;		cbi	portb,ss
         		;ldi	tempchar,0x06
         		;ldi	tempchar,130
         		;ldi	tempchar,0x4
         		;ldi	tempchar,146
         		;ldi	tempchar,130
         		;ldi	tempchar,0x02
         ;		ldi	tempchar,194
         ;		rcall	rw_spi
         		;ldi	u_data,65
         ;		mov	u_data,tempchar
         ;		rcall	putc
         		;rjmp	SharpButton1_1		
         ;		rcall	delay
         ;		ldi	tempchar,0x04
         		;ldi	tempchar,20
         ;		rcall	rw_spi
         ;		mov	u_data,tempchar
         ;		rcall	putc
         ;		rcall	delay
         ;		rjmp	SharpButton1_1
         ;		ldi	tempchar,0x00
         		;ldi	tempchar,16
         ;		rcall	rw_spi
         ;		mov	u_data,tempchar
         ;		rcall	putc
         ;		rjmp	SharpButton1_1
         ;		rcall 	Delay
         ;		ldi	tempchar,146
         ;		rcall	rw_spi
         ;		mov	u_data,tempchar
         ;		rcall	putc
         ;		rjmp	SharpButton1_1
         
         
         	;	ldi	tempchar,0x00
         	;	rcall	rw_spi
         	;	ldi	tempchar,0x82
         		;ldi	tempchar,0x00
         		;ldi	tempchar,129
         	;	rcall	rw_spi
         	;	rjmp	SharpButton1_1
         		
         		
         ;		ldi 	zl,low(2*powr1)				;Load strinpointer to commandlist 
         ;		ldi 	zh,high(2*powr1)
         		
         		
         ;		rcall	PrintSoftUstr				;Send command to projector
         ;		rcall	ReadSoftUart				;Read projector respons
         
         ;		ldi	zl,low(2*ok)				;respons sharp
         ;		ldi	zh,high(2*ok)				;respons sharp
         		
         		
         ;		ldi	yl,low(SUARTbuf)			;Load stringpointer destination
         ;		ldi	yh,high(SUARTbuf)
         ;		adiw	yl,1
         ;		rcall	StrSearch
         ;		tst	yl					;Test for OK	
         ;		breq	SharpButton1_1
         		;ldi 	zl,low(2*powr1)				;Load strinpointer
         		;ldi 	zh,high(2*powr1)
         		;rcall	PrintStr
         		;ldi	yl,low(TempBuf)
         		;ldi	yh,high(TempBuf)
         		;sbi	PORTC,6;4				;Set led button 1 On
         ;		cbi	PORTC,7;5
         ;		rcall	LedFlashC6
         ;		sbi	PORTA,5					;Set led Source Button On
000945 c06c      		rjmp	SharpButtonExit1	 
          SharpButton1_1:		
000946 98ae      		cbi	PORTC,6;4				;Set led button 1 Off 
000947 c06a      		rjmp	SharpButtonExit1
         		
          SharpButton2:	
000948 d415      		rcall	Ds2406_pioaOFF
000949 c068      		rjmp	SharpButtonExit1
         ;		ldi 	zl,low(2*powr0)				;sharp
         ;		ldi 	zh,high(2*powr0)			;sharp
         ;		rcall	PrintSoftUstr				;toshiba
         ;		rcall	ReadSoftUart		
         ;		ldi	zl,low(2*ok)
         ;		ldi	zh,high(2*ok)
         ;		ldi	yl,low(SUARTbuf)			;Load stringpointer destination
         ;		ldi	yh,high(SUARTbuf)
         ;		adiw	yl,1
         ;		rcall	StrSearch
         ;		tst	yl					;Test for OK	
         ;		breq	SharpButton2_1
         		;sbi	PORTC,7;5				;Set led button 1 On
         ;		clr	temp0
         ;		sts	Mcount,temp0				;clear Moute counter
         ;		cbi	PORTA,6					;Set led Mute Button Off
         ;		cbi	PORTC,6;4
         ;		cbi	PORTA,5					;Set led Source Button Off
         ;		rcall	LedFlashC7
         		;		cbi	PORTA,5
         		;		cbi	PORTA,6
         		;ldi 	zl,low(2*powr0)				;Load strinpointer
         		;ldi 	zh,high(2*powr0)
         		;rcall	PrintStr
         		;ldi	yl,low(TempBuf)
         		;ldi	yh,high(TempBuf)
00094a c067      		rjmp	SharpButtonExit1	 
          SharpButton2_1:		
00094b 98af      		cbi	PORTC,7;5					;Set led button 1 Off 
00094c c065      		rjmp	SharpButtonExit1
         	
         	
          SharpButton3:	
         	
         		;----------------Mute Button toggle On_Off-----------------------------------------------------------------			
         		;lds	temp0,Mcount				;Load Mount counter
         		;cpi	temp0,1
         		;breq	SharpButton3_2
         
         		;---------------End mute Button toggle---------------------------------------------------------------------
         	
         		;ldi	temp0,1
         		;sts	Mcount,temp0				;increase Moute counter
         		;rcall	ClearSuartBuf
         		;ldi 	zl,low(2*muteOn)			;sharp xr-10x,xr-20x
         		;ldi 	zh,high(2*muteOn)			;sharp xr-10x,xr-20x
         		;rcall	PrintSoftUstr				;Send command to projector
         		;rcall	ReadSoftUart				;Read projector respons
         		;ldi	zl,low(2*ok)
         		;ldi	zh,high(2*ok)
         		;ldi	yl,low(SUARTbuf)			;Load stringpointer destination
         		;ldi	yh,high(SUARTbuf)
         		;adiw	yl,1
         		;rcall	StrSearch
         		;tst	yl					;Test for OK	
         		;breq	SharpButton3_1
         		;cbi	PORTA,5
         		;rcall	LedFlashA6
00094d c064      		rjmp	SharpButtonExit1	 
          SharpButton3_1:		
00094e 98de      		cbi	PORTA,6					;Set led button 1 Off 
00094f c062      		rjmp	SharpButtonExit1
         		
          SharpButton3_2:
         ;		clr	temp0
         ;		sts	Mcount,temp0				;clear Moute counter
         ;		ldi 	zl,low(2*muteOff)			;sharp xr-10x,xr-20x
         ;		ldi 	zh,high(2*muteOff)			;sharp xr-10x,xr-20x
         ;		rcall	PrintSoftUstr				;Send command to projector
         ;		rcall	ReadSoftUart				;Read projector respons
         ;		ldi	zl,low(2*ok)
         ;		ldi	zh,high(2*ok)
         ;		ldi	yl,low(SUARTbuf)			;Load stringpointer destination
         ;		ldi	yh,high(SUARTbuf)
         ;		adiw	yl,1
         ;		rcall	StrSearch
         ;		tst	yl					;Test for OK	
         ;		breq	SharpButton3_3
         ;		cbi	PORTA,5
         ;		rcall	LedFlashA6
         ;		cbi	PORTA,6					;Set led Mute Button Off
         ;		sbi	PORTA,5					;Set led Source Button On
         ;		rjmp	SharpButtonExit1	 
          SharpButton3_3:		
         ;		cbi	PORTA,6					;Set led button 1 Off 
         ;		rjmp	SharpButtonExit1
         	
         		
          SharpButton4:		
000950 d372      		rcall	GetDs64BitCode
000951 c060      		rjmp	SharpButtonExit1
         		
         	;	ldi	xl,low(phoneno)
         	;	ldi	xh,high(phoneno)
         		
         	;	ldi	tempchar,0x55
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x12
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x2f
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x22
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x73	
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x00
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x00
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x00
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x48
         	;	st	x+,tempchar
         	
         	
         	;	ldi	tempchar,0x55	;
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x07	;
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x00	
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x0e	;
         	;	st	x+,tempchar
         		
         	;	ldi	xl,low(phoneno)
         	;	ldi	xh,high(phoneno)
         		
         	
         	;	rcall	Ds2406_pioaON
         		
         		
         		
000952 c05f      		rjmp	SharpButtonExit1
         
         		;-------------------Source Button toggle---------------------------------------------------------------------------
         	;	lds	temp0,Scount				;Load source counter
         	;	cpi	temp0,1
         	;	breq	SharpButton4_2	
         	;	cpi	temp0,2
         	;	breq	SharpButton4_4	
         		;----------------------End Button toggle--------------------------------------------------	
         	;	ldi	temp0,1
         	;	sts	Scount,temp0				;increase Scounter
         		
         	;	ldi 	zl,low(2*svideo)				;sharp xr-10x, xr-20x
         	;	ldi 	zh,high(2*svideo)				;sharp xr-10x, xr-20x
         	;	rcall	PrintSoftUstr				;Send command to projector
         	;	rcall	ReadSoftUart				;Read projector respons
         	;	ldi	zl,low(2*ok)
         	;	ldi	zh,high(2*ok)
         	;	ldi	yl,low(SUARTbuf)			;Load stringpointer destination
         	;	ldi	yh,high(SUARTbuf)
         	;	adiw	yl,1
         	;	rcall	StrSearch
         	;	tst	yl					;Test for OK	
         	;	breq	SharpButton4_1
         	;	cbi	PORTA,6
         	;	rcall 	LedFlashA5
         	;	rjmp	SharpButtonExit1	 
          SharpButton4_1:		
         	;	cbi	PORTA,5					;Set led button 1 Off 
         	;	rjmp	SharpButtonExit1
         
          SharpButton4_2:
         	;	ldi 	zl,low(buttonFlag)			;Load strinpointer
         	;	ldi 	zh,high(buttonFlag)
         	;	rcall	EERead					;Get buttonFlag
         	;	clr 	temp0
         	;	sbrc	tempchar,0				;Skip if bit0 is cleared
         	;	ldi	temp0,2					
         	;	sts	Scount,temp0				;increase Scounter							
         	;	ldi 	zl,low(2*rgb1)				;sharp xr-10x, xr-20x
         	;	ldi 	zh,high(2*rgb1)				;sharp xr-10x, xr-20x
         	;	rcall	PrintSoftUstr				;Send command to projector
         	;	rcall	ReadSoftUart				;Read projector respons
         	;	ldi	zl,low(2*ok)
         	;	ldi	zh,high(2*ok)
         	;	ldi	yl,low(SUARTbuf)			;Load stringpointer destination
         	;	ldi	yh,high(SUARTbuf)
         	;	adiw	yl,1
         	;	rcall	StrSearch
         	;	tst	yl					;Test for OK	
         	;	breq	SharpButton4_3
         	;	cbi	PORTA,6
         	;	rcall 	LedFlashA5
         	;	rjmp	SharpButtonExit1	 
          SharpButton4_3:		
         	;	cbi	PORTA,5					;Set led button 1 Off 
         	;	rjmp	SharpButtonExit1
         
         
          SharpButton4_4:
         	;	clr	temp0
         	;	sts	Scount,temp0				;increase Scounter							
         	;	ldi 	zl,low(2*rgb2)				;sharp xr-10x, xr-20x
         	;	ldi 	zh,high(2*rgb2)				;sharp xr-10x, xr-20x
         	;	rcall	PrintSoftUstr				;Send command to projector
         	;	rcall	ReadSoftUart				;Read projector respons
         	;	ldi	zl,low(2*ok)
         	;	ldi	zh,high(2*ok)
         	;	ldi	yl,low(SUARTbuf)			;Load stringpointer destination
         	;	ldi	yh,high(SUARTbuf)
         	;	adiw	yl,1
         	;	rcall	StrSearch
         	;	tst	yl					;Test for OK	
         	;	breq	SharpButton4_5
         	;	cbi	PORTA,6
         	;	rcall 	LedFlashA5
         	;	rjmp	SharpButtonExit1	 
          SharpButton4_5:		
         	;	cbi	PORTA,5					;Set led button 1 Off 
         	;	rjmp	SharpButtonExit1
         					
         		
          SharpButton5:
         		;rcall	GetDs64BitCode
         	
000953 edab      		ldi	xl,low(phoneno)
000954 e0b1      		ldi	xh,high(phoneno)
         		
000955 e525      		ldi	tempchar,0x55
000956 932d      		st	x+,tempchar
000957 e122      		ldi	tempchar,0x12
000958 932d      		st	x+,tempchar
000959 ea20      		ldi	tempchar,0xa0
00095a 932d      		st	x+,tempchar
00095b e12f      		ldi	tempchar,0x1f
00095c 932d      		st	x+,tempchar
00095d e723      		ldi	tempchar,0x73	
00095e 932d      		st	x+,tempchar
00095f e020      		ldi	tempchar,0x00
000960 932d      		st	x+,tempchar
000961 e020      		ldi	tempchar,0x00
000962 932d      		st	x+,tempchar
000963 e020      		ldi	tempchar,0x00
000964 932d      		st	x+,tempchar
000965 ee2e      		ldi	tempchar,0xee
000966 932d      		st	x+,tempchar
         	
         	
000967 e525      		ldi	tempchar,0x55	;
000968 932d      		st	x+,tempchar
000969 e027      		ldi	tempchar,0x07	;
00096a 932d      		st	x+,tempchar
00096b e020      		ldi	tempchar,0x00	
00096c 932d      		st	x+,tempchar
00096d e02e      		ldi	tempchar,0x0e	;
00096e 932d      		st	x+,tempchar
         		
00096f edab      		ldi	xl,low(phoneno)
000970 e0b1      		ldi	xh,high(phoneno)
         		
         	
000971 d3dd      		rcall	Ds2406_pioaON
000972 c03f      		rjmp	SharpButtonExit1
         	;	ldi	tempchar,0xff
         	;	sts	DelayV,tempchar
         	;	ldi	tempchar,0xff
         	;	sts	DelayV+1,tempchar
         	;	ldi	tempchar,0x4
         	;	sts	DelayV+2,tempchar
         	;	rcall	Delay
         	;	ldi	tempchar,0
         	;	sts	LongWord,tempchar
         		;lds	tempchar,Svolume
         	;	tst	tempchar
         	;	breq	SharpButton5_2
         	;	ldi	temp0,2
         	;	sub	tempchar,temp0
         		;sts	Svolume,tempchar
         	;	sts	LongWord+1,tempchar
         	;	ldi	zl,low(LongWord)
         	;	ldi	zh,high(LongWord)
         	;	ldi	xl,low(Str6)
         	;	ldi	xh,high(Str6)
         	;	rcall	Itoa
         		
         		
         	;	ldi 	zl,low(2*volume)			;Load low stringpointer sharp
         	;	ldi 	zh,high(2*volume)			;Load high stringpointer sharp
         		
         		
         	;	rcall	PrintSoftUstr				;Send command to projector
         	;	ldi 	zl,low(Str6)				;Load strinpointer
         	;	ldi 	zh,high(Str6)
         	;	adiw	zl,3
         	;	rcall	PrintSoftU
         	;	ldi	u_data,13				;Load byte
         	;	rcall	putc					;Send byte to soft-uart
         	;	rcall	ReadSoftUart				;Read projector response
         
         	;	ldi	zl,low(2*ok)				;Load low stringpointer for matching word
         	;	ldi	zh,high(2*ok)				;Loas high stringpointer for matching word
         	;	ldi	yl,low(SUARTbuf)			;Load stringpointer destination
         	;	ldi	yh,high(SUARTbuf)
         	;	adiw	yl,1
         	;	rcall	StrSearch
         	;	tst	yl					;Test for OK	
         	;	breq	SharpButton5_1
         		
         	;	rjmp	SharpButtonExit1	 
         
         
          SharpButton5_1:		 
         		;lds 	tempchar,Svolume
         		;ldi	temp0,2
         		;add	tempchar,temp0
         		;sts	Svolume,tempchar
         
          SharpButton5_2:		
         	;	rjmp	SharpButtonExit1
         		
         
         
          SharpButton6:
         ;		rcall	Ds2406_pioaOFF
000973 edab      		ldi	xl,low(phoneno)
000974 e0b1      		ldi	xh,high(phoneno)
         		
000975 e525      		ldi	tempchar,0x55
000976 932d      		st	x+,tempchar
000977 e122      		ldi	tempchar,0x12
000978 932d      		st	x+,tempchar
000979 ea20      		ldi	tempchar,0xa0
00097a 932d      		st	x+,tempchar
00097b e12f      		ldi	tempchar,0x1f
00097c 932d      		st	x+,tempchar
00097d e723      		ldi	tempchar,0x73	
00097e 932d      		st	x+,tempchar
00097f e020      		ldi	tempchar,0x00
000980 932d      		st	x+,tempchar
000981 e020      		ldi	tempchar,0x00
000982 932d      		st	x+,tempchar
000983 e020      		ldi	tempchar,0x00
000984 932d      		st	x+,tempchar
000985 ee2e      		ldi	tempchar,0xee
000986 932d      		st	x+,tempchar
         	
         	
000987 e525      		ldi	tempchar,0x55	;
000988 932d      		st	x+,tempchar
000989 e027      		ldi	tempchar,0x07	;
00098a 932d      		st	x+,tempchar
00098b e020      		ldi	tempchar,0x00	
00098c 932d      		st	x+,tempchar
00098d e62d      		ldi	tempchar,0x6d	;
00098e 932d      		st	x+,tempchar
         		
00098f edab      		ldi	xl,low(phoneno)
000990 e0b1      		ldi	xh,high(phoneno)
000991 d3bd      		rcall	Ds2406_pioaON
         		
         		
         		
000992 edab      		ldi	xl,low(phoneno)
000993 e0b1      		ldi	xh,high(phoneno)
         		
000994 e525      		ldi	tempchar,0x55
000995 932d      		st	x+,tempchar
000996 e122      		ldi	tempchar,0x12
000997 932d      		st	x+,tempchar
000998 e22f      		ldi	tempchar,0x2f
000999 932d      		st	x+,tempchar
00099a e222      		ldi	tempchar,0x22
00099b 932d      		st	x+,tempchar
00099c e723      		ldi	tempchar,0x73	
00099d 932d      		st	x+,tempchar
00099e e020      		ldi	tempchar,0x00
00099f 932d      		st	x+,tempchar
0009a0 e020      		ldi	tempchar,0x00
0009a1 932d      		st	x+,tempchar
0009a2 e020      		ldi	tempchar,0x00
0009a3 932d      		st	x+,tempchar
0009a4 e428      		ldi	tempchar,0x48
0009a5 932d      		st	x+,tempchar
         	
         	
0009a6 e525      		ldi	tempchar,0x55	;
0009a7 932d      		st	x+,tempchar
0009a8 e027      		ldi	tempchar,0x07	;
0009a9 932d      		st	x+,tempchar
0009aa e020      		ldi	tempchar,0x00	
0009ab 932d      		st	x+,tempchar
0009ac e62d      		ldi	tempchar,0x6d	;
0009ad 932d      		st	x+,tempchar
         		
0009ae edab      		ldi	xl,low(phoneno)
0009af e0b1      		ldi	xh,high(phoneno)
         		
         	
0009b0 d39e      		rcall	Ds2406_pioaON
         		
0009b1 c000      		rjmp	SharpButtonExit1
         		;ldi	tempchar,0xff
         		;sts	DelayV,tempchar
         		;ldi	tempchar,0xff
         		;sts	DelayV+1,tempchar
         		;ldi	tempchar,0x4
         		;sts	DelayV+2,tempchar
         		;rcall	Delay
         		
         		;ldi	tempchar,0
         		;sts	LongWord,tempchar
         		;lds	tempchar,Svolume
         		;cpi	tempchar,60
         		;breq	SharpButton6_2
         		;ldi	temp0,2
         		;add	tempchar,temp0
         		;sts	Svolume,tempchar
         		;sts	LongWord+1,tempchar
         		;ldi	zl,low(LongWord)
         		;ldi	zh,high(LongWord)
         		;ldi	xl,low(Str6)
         		;ldi	xh,high(Str6)
         		;rcall	Itoa
         		
         		
         		;ldi 	zl,low(2*volume)			;Load low stringpointer sharp
         		;ldi 	zh,high(2*volume)			;Load high stringpointer sharp
         		
         		
         		;rcall	PrintSoftUstr				;Send command to projector
         		;ldi 	zl,low(Str6)				;Load strinpointer
         		;ldi 	zh,high(Str6)
         		;adiw	zl,3
         		;rcall	PrintSoftU
         		;ldi	u_data,13				;Load byte
         		;rcall	putc					;Send byte to soft-uart
         		;rcall	ReadSoftUart				;Read projector response
         
         		;ldi	zl,low(2*ok)				;Load low stringpointer for matching word
         		;ldi	zh,high(2*ok)				;Loas high stringpointer for matching word
         		;ldi	yl,low(SUARTbuf)			;Load stringpointer destination
         		;ldi	yh,high(SUARTbuf)
         		;adiw	yl,1
         		;rcall	StrSearch
         		;tst	yl					;Test for OK	
         		;breq	SharpButton6_1
         		
         		;rjmp	SharpButtonExit1	 	 
         
          SharpButton6_1:		 
         		;lds 	tempchar,Svolume
         		;ldi	temp0,2
         		;sub	tempchar,temp0
         		;sts	Svolume,tempchar
         
         
         
          SharpButton6_2:		
         		 
         		;rjmp	SharpButtonExit1				
         		
          SharpButtonExit:		
         		;rcall	PrintSoftUstr
         		;rcall	ReadSoftUart
         		;rcall	LongDelay
         		;---------------Init timer1 if pollFlag=1---------------------------------------------------
          SharpButtonExit1:
         		;
0009b2 e090      		ldi	flag,0
0009b3 2744      		clr	temp0			 
0009b4 9340 01f9 		sts	Count,temp0		;clear time counter
0009b6 9340 0150 		sts	TempBuf,temp0
         		;lds	tempchar,pollFlag
         		;clr	temp0
         		;cpse	tempchar,temp0
0009b8 9120 0206 		lds	tempchar,Bflags
0009ba fd20      		sbrc	tempchar,0
0009bb d760      		rcall	timer1_init	
         		;-------------------------------------------------------------------
          SharpButtonExit0:
         		;cbi	PORTD,6
0009bc 9508      		ret
         
         
         
         
         
         
         	
         	
         ;-----------------------------------------------------------------------------------
         
         	
         	
         ;-----------------------------------------------------------------------------------
         
         
         
         
         ;------------------------------------------------------------------------------------------------------------------												
         ;************************************************************************************
         ;*FUNCTION
         ;*  LedFlashA5
         ;*
         ;*DESCRIPTION
         ;*		LedFlash for PORTA,5
         ;*PARAMETER
         ;*
         ;*Input:
         ;************************************************************************************
         ;LedFlashA5:;----Set Delay Value---------------------
         		
         ;		ldi	temp0,15
         		
         ;LedFlashA50:
         ;		ldi	tempchar,0xff
         ;		sts	DelayV,tempchar
         ;		ldi	tempchar,0xff
         ;		sts	DelayV+1,tempchar
         ;		ldi	tempchar,0xa
         ;		sts	DelayV+2,tempchar
         ;		cbi	PORTA,5					;Set led button On
         ;		rcall	Delay
         ;		sbi	PORTA,5					;Set led button Off
         ;		rcall	Delay
         ;		dec	temp0
         ;		tst	temp0
         ;		brne	LedFlashA50
         ;		ret
         ;--------------------------------------------------------------------------------------------
         	
         ;------------------------------------------------------------------------------------------------------------------												
         ;************************************************************************************
         ;*FUNCTION
         ;*  LedFlashA6
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*Input:
         ;************************************************************************************
         ;LedFlashA6:;----Set Delay Value---------------------
         		
         ;		ldi	temp0,15
         		
         ;LedFlashA60:
         ;		ldi	tempchar,0xff
         ;		sts	DelayV,tempchar
         ;		ldi	tempchar,0xff
         ;		sts	DelayV+1,tempchar
         ;		ldi	tempchar,0xa
         ;		sts	DelayV+2,tempchar
         ;		cbi	PORTA,6					;Set led button On
         ;		rcall	Delay
         ;		sbi	PORTA,6					;Set led button Off
         ;		rcall	Delay
         ;		dec	temp0
         ;		tst	temp0
         ;		brne	LedFlashA60
         ;		ret
         ;--------------------------------------------------------------------------------------------
         ;************************************************************************************
         ;*FUNCTION
         ;*  LedFlashC6
         ;*
         ;*DESCRIPTION
         ;*		LedFlash for PORTC,6
         ;*PARAMETER
         ;*
         ;*Input:
         ;************************************************************************************
         ;LedFlashC6:;----Set Delay Value---------------------
         		
         ;		ldi	temp0,50
         		
         ;LedFlashC60:
         ;		ldi	tempchar,0xff
         ;		sts	DelayV,tempchar
         ;		ldi	tempchar,0xff
         ;		sts	DelayV+1,tempchar
         ;		ldi	tempchar,0xa
         ;		sts	DelayV+2,tempchar
         ;		cbi	PORTC,6					;Set led button On
         ;		rcall	Delay
         ;		sbi	PORTC,6					;Set led button Off
         ;		rcall	Delay
         ;		dec	temp0
         ;		tst	temp0
         ;		brne	LedFlashC60
         ;		ret
         ;--------------------------------------------------------------------------------------------
         
         ;------------------------------------------------------------------------------------------------------------------		
         ;************************************************************************************
         ;*FUNCTION
         ;*  LedFlashC7
         ;*
         ;*DESCRIPTION
         ;*		LedFlash for PORTC,7
         ;*PARAMETER
         ;*
         ;*Input:
         ;************************************************************************************
         ;LedFlashC7:;----Set Delay Value---------------------
         		
         ;		ldi	temp0,90
         		
         ;LedFlashC70:
         ;		ldi	tempchar,0xff
         ;		sts	DelayV,tempchar
         ;		ldi	tempchar,0xff
         ;		sts	DelayV+1,tempchar
         ;		ldi	tempchar,0xa
         ;		sts	DelayV+2,tempchar
         ;		cbi	PORTC,7					;Set led button On
         ;		rcall	Delay
         ;		sbi	PORTC,7					;Set led button Off
         ;		rcall	Delay
         ;		dec	temp0
         ;		tst	temp0
         ;		brne	LedFlashC70
         ;		ret
         ;--------------------------------------------------------------------------------------------
         	
         		
         ;************************************************************************************
         ;*FUNCTION
         ;*  Button:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************						
         
          Button:
         		
         		;rcall	ViewSonicButton
0009bd df7d      		rcall	SharpButton
         		;rcall	BarcoButton
         		;rcall  PanasonicButton
0009be 9508      		ret
         		
         ;***************************************************************************
         ;* 
         ;* EEWrite
         ;*
         ;* This subroutine waits until the EEPROM is ready to be programmed, then
         ;* programs the EEPROM with register variable "tempchar" at address "zl:zh"
         ;*
         ;* Number of words	:8515 ; 7 + return
         ;* Number of cycles	:8515 ; 11 + return (if EEPROM is ready)
         ;* Low Registers used	:zl
         ;* High Registers used:	;zh
         ;*
         ;***************************************************************************
         
         ;***** Subroutine register variables
         
         ;.def	EEdwr	=r16		;data byte to write to EEPROM
         ;.def	EEawr	=r17		;address low byte to write to
         ;.def	EEawrh	=r18		;address high byte to write to
         
         ;***** Code
         
          EEWrite:
0009bf 99e1      	sbic	EECR,EEWE	;if EEWE not clear
0009c0 cffe      	rjmp	EEWrite		;    wait more
         
         
         ; the two following lines must be replaced with the line above if 1200 is used
0009c1 bbff      	out 	EEARH,zh;EEawrh	;output address high for 8515
0009c2 bbee      	out	EEARL,zl;EEawr	;output address low for 8515
         		
         
0009c3 bb2d      	out	EEDR,tempchar	;output data
0009c4 9ae2      	sbi 	EECR,EEMWE	;set master write enable, remove if 1200 is used	
0009c5 9ae1      	sbi	EECR,EEWE	;set EEPROM Write strobe
         				;This instruction takes 4 clock cycles since
         				;it halts the CPU for two clock cycles
0009c6 9508      	ret
         	
         ;***************************************************************************
         ;* 
         ;* EEWriteY
         ;*
         ;* This subroutine waits until the EEPROM is ready to be programmed, then
         ;* programs the EEPROM with register variable "tempchar" at address "zl:zh"
         ;*
         ;* Number of words	:8515 ; 7 + return
         ;* Number of cycles	:8515 ; 11 + return (if EEPROM is ready)
         ;* Low Registers used	:yl
         ;* High Registers used:	;yh
         ;*
         ;***************************************************************************
         
         ;***** Subroutine register variables
         
         ;.def	EEdwr	=r16		;data byte to write to EEPROM
         ;.def	EEawr	=r17		;address low byte to write to
         ;.def	EEawrh	=r18		;address high byte to write to
         
         ;***** Code
         
          EEWriteY:
0009c7 99e1      	sbic	EECR,EEWE	;if EEWE not clear
0009c8 cffe      	rjmp	EEWriteY	;wait more
         
         
         ; the two following lines must be replaced with the line above if 1200 is used
0009c9 bbdf      	out 	EEARH,yh;EEawrh	;output address high for 8515
0009ca bbce      	out	EEARL,yl;EEawr	;output address low for 8515
         		
         
0009cb bb2d      	out	EEDR,tempchar	;output data
0009cc 9ae2      	sbi 	EECR,EEMWE	;set master write enable, remove if 1200 is used	
0009cd 9ae1      	sbi	EECR,EEWE	;set EEPROM Write strobe
         				;This instruction takes 4 clock cycles since
         				;it halts the CPU for two clock cycles
0009ce 9508      	ret	
         	
         	
         ;***************************************************************************
         ;* 
         ;* EERead
         ;*
         ;* This subroutine waits until the EEPROM is ready to be programmed, then
         ;* reads the register variable "tempchar" from address "zh:zl"
         ;*
         ;* Number of words	:8515 ; 6 + return
         ;*			:8515 ; 9 + return (if EEPROM is ready)
         ;* Low Registers used	:1 (zl)
         ;* High Registers used:	:2 (zh)
         ;*
         ;***************************************************************************
         
         ;***** Subroutine register variables
         
         ;.def	EEdrd	=r0		;result data byte
         ;.def	EEard	=r17		;address low to read from
         ;.def	EEardh	=r18		;address high to read from
         
         ;***** Code
         
          EERead:
0009cf 99e1      	sbic	EECR,EEWE	;if EEWE not clear
0009d0 cffe      	rjmp	EERead		;    wait more
         ;
         
         
0009d1 bbff      	out 	EEARH,zh;EEardh	;output address high for 8515
0009d2 bbee      	out	EEARL,zl;EEard	;output address low for 8515
         
         
0009d3 9ae0      	sbi	EECR,EERE	;set EEPROM Read strobe
         				;This instruction takes 4 clock cycles since
         				;it halts the CPU for two clock cycles
0009d4 b32d      	in	tempchar,EEDR	;get data
0009d5 9508      	ret	
         	
         ;***************************************************************************
         ;* 
         ;* EEReadY
         ;*
         ;* This subroutine waits until the EEPROM is ready to be programmed, then
         ;* reads the register variable "tempchar" from address "zh:zl"
         ;*
         ;* Number of words	:8515 ; 6 + return
         ;*			:8515 ; 9 + return (if EEPROM is ready)
         ;* Low Registers used	:1 (yl)
         ;* High Registers used:	:2 (yh)
         ;*
         ;***************************************************************************
         
         ;***** Subroutine register variables
         
         ;.def	EEdrd	=r0		;result data byte
         ;.def	EEard	=r17		;address low to read from
         ;.def	EEardh	=r18		;address high to read from
         
         ;***** Code
         
          EEReadY:
0009d6 99e1      	sbic	EECR,EEWE	;if EEWE not clear
0009d7 cffe      	rjmp	EEReadY		;    wait more
         ;
         
         
0009d8 bbdf      	out 	EEARH,yh;EEardh	;output address high for 8515
0009d9 bbce      	out	EEARL,yl;EEard	;output address low for 8515
         
         
0009da 9ae0      	sbi	EECR,EERE	;set EEPROM Read strobe
         				;This instruction takes 4 clock cycles since
         				;it halts the CPU for two clock cycles
0009db b32d      	in	tempchar,EEDR	;get data
0009dc 9508      	ret			
         	
         ;----------------------------------------------------------------------------------------------
         ;WriteEE:
         ;		ldi	zl,$00
         ;		ldi	zh,$00
         ;		ldi	tempchar,'J'	
         ;		rcall	EEWrite
         ;		adiw	zl,1
         ;		ldi	tempchar,'a'
         ;		rcall	EEWrite
         ;		adiw	zl,1
         ;		ldi	tempchar,'r'
         ;		rcall	EEWrite
         ;		adiw	zl,1
         ;		ldi	tempchar,'l'
         ;		rcall	EEWrite
         ;		adiw	zl,1
         ;		ldi	tempchar,13
         ;		rcall	EEWrite
         ;		adiw	zl,1
         ;		ldi	tempchar,0
         ;		rcall	EEWrite
         ;		adiw	zl,1
         ;		rcall	EEWrite
         
         ;		ret
         ;----------------------------------------------------------------------------------------------			
         ;************************************************************************************
         ;*FUNCTION
         ;*  GetSource:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************						
         
         ;GetSource:
         ;	rcall	ClearSuartBuf
         ;	ldi 	zl,low(2*gss)				;Load strinpointer
         ;	ldi 	zh,high(2*gss)
         ;	rcall	PrintSoftUstr
         ;	ldi	zl,low(2*gssin1)
         ;	ldi	zh,high(2*gssin1)
         ;	ldi	yl,low(SUARTbuf)			;Load stringpointer destination
         ;	ldi	yh,high(SUARTbuf)
         ;	adiw	yl,1
         ;	rcall	StrSearch
         ;	tst	yl					;Test for OK	
         ;	breq	lpollin11
         ;	sbi	PORTA,5					;Set led button 1 On
         ;	cbi	PORTA,6
         ;	rjmp	lpollin4	 
         ;lpollin11:		
         ;	cbi	PORTA,5					;Set led button 1 Off 		 
         	
         ;lpollin4:
         ;		rcall	ClearSuartBuf
         ;		ldi 	zl,low(2*gss)				;pioneer-status
         ;		ldi 	zh,high(2*gss)				;pioneer-status
         ;		rcall	PrintSoftUstr				;Send command to projector
         ;		rcall	ReadSoftUart				;Read projector respons
         ;		ldi	zl,low(2*gssin4)
         ;		ldi	zh,high(2*gssin4)
         		
         ;		ldi	yl,low(SUARTbuf)			;Load stringpointer destination
         ;		ldi	yh,high(SUARTbuf)
         ;		adiw	yl,1
         ;		rcall	StrSearch
         ;		tst	yl					;Test for OK	
         ;		breq	lpollin41
         ;		sbi	PORTA,6					;Set led button 1 On
         ;		cbi	PORTA,5
         ;		rjmp	lpollin42	 
         ;lpollin41:		
         ;		cbi	PORTA,6					;Set led button 1 Off 
         ;lpollin42:	
         
         ;rcall	ClearSuartBuf
         ;ret
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  GetSourceVS:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************						
         
         ;GetSourceVS:
         ;		rcall	ClearSuartBuf
         ;		ldi 	zl,low(2*vsgetsource)			;
         ;		ldi 	zh,high(2*vsgetsource)			;
         ;		ldi	temp0,13				;Set packet length
         ;		rcall	SendPacketSoftUstr
         ;		ldi	tempchar,3				;Set packet length
         ;		rcall	ReadPacketSoftUart
         ;		lds	tempchar,SUARTbuf+2
         ;		clc
         ;		cpi	tempchar,0x01				;if rgb in1 jump
         ;		breq	GetSourceVS00
         ;		cpi	tempchar,0x02				;if rgb in2 jump
         ;		breq	GetSourceVS01
         ;		cpi	tempchar,0x04				;if video jump
         ;		breq	GetSourceVS02
         ;		cbi	PORTA,5
         ;		cbi	PORTA,6
         ;		rjmp	GetSourceVSexit
         		
         		
         ;GetSourceVS00:						;rgb1  input1
         ;	ldi	temp0,1					
         ;	sts	Scount,temp0				;increase Scounter
         ;	sbi	PORTA,5
         ;	cbi	PORTA,6
         ;	rjmp	GetSourceVSexit
         ;GetSourceVS01:						;rgb2  input2
         ;	ldi	temp0,2					
         ;	sts	Scount,temp0				;increase Scounter
         ;	sbi	PORTA,5
         ;	cbi	PORTA,6
         ;	rjmp	GetSourceVSexit
         
         ;GetSourceVS02:						;video input4				
         ;	clr	temp0
         ;	sts	Scount,temp0				;increase Scounter
         ;	sbi	PORTA,5
         ;	cbi	PORTA,6
         ;	rjmp	GetSourceVSexit
         
         
         
         ;GetSourceVSexit:
         
         ;ret
         
         
         
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  GetSourceSH:
         ;*
         ;*DESCRIPTION
         ;* Only sharp xr10
         ;* Implemented width Mute function
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************						
         
         ;GetSourceSH:
         ;		rcall	ClearSuartBuf
         ;		ldi 	zl,low(2*ichk)				;Load strinpointer
         ;		ldi 	zh,high(2*ichk)
         ;		rcall	PrintSoftUstr
         ;		rcall	ReadSoftUart	
         ;		lds	tempchar,SUARTbuf+4
         ;		clc
         ;		cpi	tempchar,'4'				;if video jump
         ;		breq	GetSourceSH02
         		;cpi	tempchar,0x00				;if rgb in1 jump
         		;breq	GetSourceSH00
         ;		cpi	tempchar,'1'				;if rgb in2 jump
         ;		breq	GetSourceSH00
         ;		cpi	tempchar,'2'
         ;		breq	GetSourceSH01
         ;		cbi	PORTA,5
         ;		cbi	PORTA,6
         ;		rjmp	GetSourceSHexit
         		
         		
         ;GetSourceSH00:
         ;	clr	temp0
         	;ldi	temp0,1
         ;	sts	Scount,temp0				;increase Scounter
         ;	rjmp	GetSourceSH00_01
         ;GetSourceSH01:
         ;	clr	temp0
         ;	sts	Scount,temp0				;increase Scounter
         ;GetSourceSH00_01:	
         ;	sbi	PORTA,5
         ;	cbi	PORTA,6
         ;	rjmp	GetSourceSHexit
         ;GetSourceSH02:
         ;	ldi	temp0,1
         ;	sts	Scount,temp0
         ;	sbi	PORTA,5
         ;	cbi	PORTA,6
         ;	rjmp	GetSourceSHexit
         
         
         ;GetSourceSHexit:
         
         ;ret
         
         
         
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  GetTargetNo:
         ;*
         ;*DESCRIPTION Moves data from EEPROM memory to ram memory
         ;*            z points at source positon and y points at target positon
         ;*	      Sorce string must be null terminated.
         ;*
         ;*PARAMETER
         ;*z pointer to the source positon in (zl,zh) in EEPROM memory
         ;*y pointer to the target positon  (yl,yh) in Ram memory
         ;*
         ;************************************************************************************						
         
          MoveEEtoRam:
         
0009dd 9a96      		sbi	PORTD,6				;Set RTS On
0009de dff0      		rcall	EERead
0009df 2322      		tst	tempchar			;Test if we have reached the end of the string
0009e0 f021      		breq	quitMoveEEtoRam			;If so, quit
0009e1 2e02      		mov	r0,tempchar
0009e2 9209      		st	y+,r0				;Store byte in flash memory
0009e3 9631      		adiw	zl,1				;increase z
0009e4 cff8      		rjmp	MoveEEtoRam
          quitMoveEEtoRam:
0009e5 2400      		clr	r0
0009e6 9209      		st	y+,r0
0009e7 9896      		cbi	PORTD,6				;Set RTS Off
0009e8 9508      		ret
         
         
0009e9 9508      ret
         
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  GetTargetPhoneNo:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
          GetTargetPhoneNo:
0009ea e0e7      	ldi	zl,low(targetPno)
0009eb e0f0      	ldi	zh,high(targetPno)
0009ec eeca      	ldi	yl,low(TempPhoneno)
0009ed e0d1      	ldi	yh,high(TempPhoneno)
0009ee dfee      	rcall	MoveEEtoRam
0009ef 9508      ret
         
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  initPoll:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
          initPoll:
0009f0 dff9      	rcall	GetTargetPhoneNo
0009f1 9140 0206 	lds	temp0,Bflags
0009f3 7f4d      	cbr	temp0,2
0009f4 9340 0206 	sts	Bflags,temp0
0009f6 2744      	clr	temp0
         	;;sts	SmsFlag,temp0		;Set SmsFlag off			 
0009f7 9340 01f9 	sts	Count,temp0		;clear time counter
         	;;ldi	temp0,1
         	;;sts	pollFlag,temp0		;set pollFlag	
0009f9 9140 0206 	lds	temp0,Bflags
0009fb 6041      	sbr	temp0,1
0009fc 9340 0206 	sts	Bflags,temp0
0009fe d71d      	rcall	timer1_init
0009ff 9508      ret
         
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  Sharppoll:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         
          SharplPoll: 	
         
         	;wdr				;watchdog reset
         ;	sbi	PORTD,6	
         	;----------------------------poll gsm-modul-------------------------------------------
         	;rcall	ClearCrFlag		;Clear CrFlag
         	;rcall 	ClearBuf
         
         	;	ldi	yl,low(suartbuf)
         	;	ldi	yh,high(suartbuf)	
         	;	ldi	temp0,32
         	;	st	y+,temp0
         	;	ldi	temp0,32
         	;	st	y+,temp0
         	;	ldi	temp0,49
         	;	st	y+,temp0
         	;	ldi	temp0,55
         	;	st	y+,temp0
         		;ldi	temp0,13
         		;st	y+,temp0
         	;	ldi	temp0,0
         	;	st	y+,temp0
         		
         		
         		
         
         	;	ldi	yl,low(suartbuf)
         	;	ldi	yh,high(suartbuf)
         
         	;	adiw	yl,1	
         	;	rcall	atol
         	;	lds	u_data,str6
         	;	rcall	putc
         		
         		;lds	tempchar,str6
         		;rcall	Ds2406				;test
         		;rjmp	Sharplpollexit00		;test
000a00 e1e9      		ldi 	zl,low(tempref)		;Load strinpointer
000a01 e0f0      		ldi 	zh,high(tempref)
000a02 dfcc      		rcall	EERead	
000a03 2f42      		mov	temp0,tempchar
000a04 9120 0205 		lds	tempchar,reftemp
         		
000a06 1742      		cp	temp0,tempchar
000a07 f0a1      		breq	sharppolltempref	
000a08 e1e9      		ldi 	zl,low(tempref)		;Load strinpointer
000a09 e0f0      		ldi 	zh,high(tempref)
000a0a dfb4      		rcall	EEWrite	
         		
000a0b ef5e      		ldi	u_data,254
000a0c d71b      		rcall	putc
000a0d e558      		ldi	u_data,88
000a0e d719      		rcall	putc
000a0f e555      		ldi	u_data,'U'
000a10 d717      		rcall	putc
000a11 e750      		ldi	u_data,'p'
000a12 d715      		rcall	putc
000a13 e654      		ldi	u_data,'d'
000a14 d713      		rcall	putc
000a15 e651      		ldi	u_data,'a'
000a16 d711      		rcall	putc
000a17 e754      		ldi	u_data,'t'
000a18 d70f      		rcall	putc
000a19 e655      		ldi	u_data,'e'
000a1a d70d      		rcall	putc
000a1b c07b      		rjmp	sharppolltempref0
         
          sharppolltempref:
         		
         		
         		
         		
         		
         		
000a1c e1e8      		ldi 	zl,low(pumpflag)		;Load strinpointer
000a1d e0f0      		ldi 	zh,high(pumpflag)
000a1e dfb0      		rcall	EERead	
000a1f ff20      		sbrs	tempchar,0			;Skip if bit0 is set
000a20 c054      		rjmp	pump_off
         		
         		
000a21 ef5e      		ldi	u_data,254
000a22 d705      		rcall	putc
000a23 e558      		ldi	u_data,88
000a24 d703      		rcall	putc
         
000a25 e1e9      		ldi 	zl,low(tempref)		;Load strinpointer
000a26 e0f0      		ldi 	zh,high(tempref)
000a27 dfa7      		rcall	EERead	
000a28 2f42      		mov	temp0,tempchar
000a29 934f      		push	temp0
         		
000a2a e149      		ldi	temp0,25	
000a2b d1a9      		rcall	printff	
         		
         	;	ldi	xl,low(phoneno)
         	;	ldi	xh,high(phoneno)
         		
         	;	ldi	tempchar,0x55
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x10
         	;	st	x+,tempchar
         	;	ldi	tempchar,0xaf
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x26
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x15	
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x02
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x08
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x00
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x67
         	;	st	x+,tempchar
         		;ldi	tempchar,0x33
         		;st	x+,tempchar
         		;ldi	tempchar,0x44
         		;st	x+,tempchar
         	;	ldi	xl,low(phoneno)
         	;	ldi	xh,high(phoneno)
         		
000a2c eae2      		ldi 	zl,low(2*tempa0)				;Load strinpointer to commandlist 
000a2d e1fe      		ldi 	zh,high(2*tempa0)
000a2e d2b3      		rcall	ReadDs18s20
000a2f 914f      		pop	temp0
000a30 1b42      		sub	temp0,tempchar
000a31 f1d1      		breq	TempDifEq
000a32 f40a      		brpl	TempDifPlus
000a33 f0e2      		brmi	TempDifNeg
         	
         	
          TempDifPlus:
000a34 3042      		cpi	temp0,2
000a35 f468      		brsh	TempDifPlus_00
000a36 2f54      		mov	u_data,temp0
000a37 d6f0      		rcall	putc
         		
000a38 e750      		ldi	u_data,'p'
000a39 d6ee      		rcall	putc
         		
000a3a e05d      		ldi	u_data,13
000a3b d6ec      		rcall	putc	
000a3c e05a      		ldi	u_data,10
000a3d d6ea      		rcall	putc
         		
000a3e e62a      		ldi	tempchar,'j'
000a3f 98c4      		cbi	portb,ss
000a40 d201      		rcall	rw_spi
000a41 9ac4      		sbi	portb,ss
         		
000a42 c045      	rjmp	Sharplpollexit00
          TempDifPlus_00:
000a43 2f54      		mov	u_data,temp0
000a44 d6e3      		rcall	putc
         		
000a45 e550      		ldi	u_data,'P'
000a46 d6e1      		rcall	putc
         		
000a47 e05d      		ldi	u_data,13
000a48 d6df      		rcall	putc	
000a49 e05a      		ldi	u_data,10
000a4a d6dd      		rcall	putc
000a4b e725      		ldi	tempchar,'u'
000a4c 98c4      		cbi	portb,ss
000a4d d1f4      		rcall	rw_spi
000a4e 9ac4      		sbi	portb,ss	
         	
000a4f c038      	rjmp	Sharplpollexit00
         
          TempDifNeg:
000a50 3f4e      		cpi	temp0,254
000a51 f068      		brlo	TempDifNeg_00	
000a52 2f54      		mov	u_data,temp0
000a53 d6d4      		rcall	putc
         		
000a54 e65e      		ldi	u_data,'n'
000a55 d6d2      		rcall	putc
         		
000a56 e05d      		ldi	u_data,13
000a57 d6d0      		rcall	putc
000a58 e05a      		ldi	u_data,10
000a59 d6ce      		rcall	putc		
000a5a e62b      		ldi	tempchar,'k'
000a5b 98c4      		cbi	portb,ss
000a5c d1e5      		rcall	rw_spi
000a5d 9ac4      		sbi	portb,ss
         	
000a5e c029      	rjmp	Sharplpollexit00
          TempDifNeg_00:	
000a5f 2f54      		mov	u_data,temp0
000a60 d6c7      		rcall	putc
         		
000a61 e45e      		ldi	u_data,'N'
000a62 d6c5      		rcall	putc
         		
000a63 e05d      		ldi	u_data,13
000a64 d6c3      		rcall	putc
000a65 e05a      		ldi	u_data,10
000a66 d6c1      		rcall	putc		
000a67 e629      		ldi	tempchar,'i'
000a68 98c4      		cbi	portb,ss
000a69 d1d8      		rcall	rw_spi
000a6a 9ac4      		sbi	portb,ss
         	
000a6b c01c      	rjmp	Sharplpollexit00
         
          TempDifEq:	
         
         	
000a6c 2f54      		mov	u_data,temp0
000a6d d6ba      		rcall	putc
         		
000a6e e455      		ldi	u_data,'E'
000a6f d6b8      		rcall	putc
         		
000a70 e05d      		ldi	u_data,13
000a71 d6b6      		rcall	putc
000a72 e05a      		ldi	u_data,10
000a73 d6b4      		rcall	putc	
000a74 c013      	rjmp	Sharplpollexit00
         
          pump_off:	
         		;ldi	tempchar,'i'
         		;cbi	portb,ss
         		;rcall	rw_spi
         		;sbi	portb,ss
         		;mov	u_data,tempchar
         		;ldi	u_data,'Z'
         		;rcall	putc
         		
000a75 e62b      		ldi	tempchar,'k'	
000a76 98c4      		cbi	portb,ss
000a77 d1ca      		rcall	rw_spi		
000a78 9ac4      		sbi	portb,ss
         		
         		
000a79 e726      		ldi	tempchar,'v'
000a7a 98c4      		cbi	portb,ss
000a7b d1c6      		rcall	rw_spi
000a7c 9ac4      		sbi	portb,ss
         		;mov	u_data,tempchar
         		;rcall	putc
000a7d e726      		ldi	tempchar,'v'
000a7e 98c4      		cbi	portb,ss
000a7f d1c2      		rcall	rw_spi
000a80 9ac4      		sbi	portb,ss
000a81 2f52      		mov	u_data,tempchar
000a82 d6a5      		rcall	putc
         		
         	
000a83 c004      	rjmp	Sharplpollexit00
         ;	rjmp    Sharplpoll90
         	;ldi	rxhead,0
         	;ldi	rxtail,0
         ;	ldi	zl,low(2*atcpinask)			;Load low stringpointer for matching word
         ;	ldi	zh,high(2*atcpinask)			;Loas high stringpointer for matching word
         ;	rcall	PrintStr	
         	;rcall	ReadSoftUart	
          SharplPoll85:	
         ;	lds	temp1,Bflags
         ;	sbrc	temp1,4
         ;	rjmp	SharplPoll86
         ;	lds	temp1,Count			;Load poll count
         ;	cpi	temp1,10			
         ;	brge	SharplPoll86	
         ;	rjmp	SharplPoll85
          SharplPoll86:
         ;	rcall	ClearCrFlag		;Clear CrFlag
         ;	cp	rxhead,rxtail
         ;	breq	SharplPoll87
         ;	ldi 	zl,low(2*cpinready)			;Load stringpointer source
         ;	ldi 	zh,high(2*cpinready)
         ;	ldi	yl,low(Buf)			;Load stringpointer destination
         ;	ldi	yh,high(Buf)
         ;	rcall	StrSearch
         ;	tst	yl	
         	;brne	ActionClock	
         	
         	
         	
         	
         	
         	;ldi	zl,low(2*cpinready)			;Load low stringpointer for matching word
         	;ldi	zh,high(2*cpinready)			;Loas high stringpointer for matching word
         	;ldi	yl,low(SUARTbuf)			;Load stringpointer destination
         	;ldi	yh,high(SUARTbuf)
         	;adiw	yl,1
         	;rcall	StrSearch
         	;tst	yl
         ;	brne	Sharplpoll90
         	;sbi	porta,0
         	;cbi	porta,0
         	;ldi	u_data,'&'
         	;rcall	putc
         	;rjmp	reset
          SharplPoll87:
         ;	rcall 	PhoneInit00
         ;	rjmp	Sharplpollexit00
          Sharplpoll90:
         	;------------------------------------------------------------------------------
         ;	rcall	GetSourceSH				;Only sharp xr-10x
         ;	rcall	ClearTempBuf
         ;	rcall	ClearSuartBuf
         ;	ldi 	zl,low(2*tlps)				;Load strinpointer
         ;	ldi 	zh,high(2*tlps)
         ;	rcall	PrintSoftUstr
         
         ;	rcall	ReadSoftUart	
         ;	ldi	zl,low(2*err)				;Load low stringpointer for matching word
         ;	ldi	zh,high(2*err)				;Loas high stringpointer for matching word
         ;	ldi	yl,low(SUARTbuf)			;Load stringpointer destination
         ;	ldi	yh,high(SUARTbuf)
         ;	adiw	yl,1
         ;	rcall	StrSearch
         ;	tst	yl					;Test for Error	
         
         	;;;;cbi	portb,sck
         
         
         
         
         ;	ldi	tempchar,'s'
         ;	cbi	portb,ss
         ;	rcall	rw_spi
         ;	sbi	portb,ss
         ;	mov	u_data,tempchar
         ;	rcall	putc
         ;	ldi	tempchar,'i'
         ;	cbi	portb,ss
         ;	rcall	rw_spi
         ;	sbi	portb,ss
         ;	mov	u_data,tempchar
         ;	rcall	putc
         ;	ldi	tempchar,'v'
         ;	cbi	portb,ss
         ;	rcall	rw_spi
         ;	sbi	portb,ss
         ;	mov	u_data,tempchar
         ;	rcall	putc
         ;	ldi	tempchar,'t'
         ;	cbi	portb,ss
         ;	rcall	rw_spi
         ;	sbi	portb,ss
         ;	mov	u_data,tempchar
         ;	rcall	putc
         ;	ldi	tempchar,'u'
         ;	cbi	portb,ss
         ;	rcall	rw_spi
         ;	sbi	portb,ss
         ;	mov	u_data,tempchar
         ;	rcall	putc
         	
         	
         ;	ldi	u_data,13
         ;	rcall	putc
         	
         	
         
         
         ;	ldi	tempchar,'s'
         ;	cbi	portc,ss1
         ;	rcall	rw_spi
         ;	sbi	portc,ss1
         ;	mov	u_data,tempchar
         ;	rcall	putc
         ;	ldi	tempchar,'i'
         ;	cbi	portc,ss1
         ;	rcall	rw_spi
         ;	sbi	portc,ss1
         ;	mov	u_data,tempchar
         ;	rcall	putc
         ;	ldi	tempchar,'v'
         ;	cbi	portc,ss1
         ;	rcall	rw_spi
         ;	sbi	portc,ss1
         ;	mov	u_data,tempchar
         ;	rcall	putc
         ;	ldi	tempchar,'t'
         ;	cbi	portc,ss1
         ;	rcall	rw_spi
         ;	sbi	portc,ss1
         ;	mov	u_data,tempchar
         ;	rcall	putc
         ;	ldi	tempchar,'u'
         ;	cbi	portc,ss1
         ;	rcall	rw_spi
         ;	sbi	portc,ss1
         ;	mov	u_data,tempchar
         ;	rcall	putc
         	
         	
         ;	ldi	u_data,13
         ;	rcall	putc	
         	
         	
         	
         ;	ldi	tempchar,'s'
         ;	cbi	portc,ss2
         ;	rcall	rw_spi
         ;	sbi	portc,ss2
         ;	mov	u_data,tempchar
         ;	rcall	putc
         ;	ldi	tempchar,'i'
         ;	cbi	portc,ss2
         ;	rcall	rw_spi
         ;	sbi	portc,ss2
         ;	mov	u_data,tempchar
         ;	rcall	putc
         ;	ldi	tempchar,'v'
         ;	cbi	portc,ss2
         ;	rcall	rw_spi
         ;	sbi	portc,ss2
         ;	mov	u_data,tempchar
         ;	rcall	putc
         ;	ldi	tempchar,'t'
         ;	cbi	portc,ss2
         ;	rcall	rw_spi
         ;	sbi	portc,ss2
         ;	mov	u_data,tempchar
         ;	rcall	putc
         ;	ldi	tempchar,'u'
         ;	cbi	portc,ss2
         ;	rcall	rw_spi
         ;	sbi	portc,ss2
         ;	mov	u_data,tempchar
         ;	rcall	putc
         	
         	
         ;	ldi	u_data,13
         ;	rcall	putc	
         	
         	
         	
000a84 c003      rjmp	Sharplpollexit00
         
         	;--------------------------------------
         		;cbi	portb,sck
         		;ldi	tempchar,194
         		;rcall	rw_spi
         		;mov	u_data,tempchar
         		;rcall	putc		
         		;rcall	delay
         		;ldi	tempchar,0x04
         		;rcall	rw_spi
         		;mov	u_data,tempchar
         		;rcall	putc
         		;rcall	delay
         		;ldi	tempchar,0x00
         		;rcall	rw_spi
         		;mov	u_data,tempchar
         		;rcall	putc
         	;--------------------------------------
         		;sbi	PORTD,6	
         ;		wdr
         ;		ldi	temp0,1 		;Switch to AC clock
         ;		ldi	temp1,2			;Svitch to time function
         ;		ldi	tempchar,0
         ;		rcall	GetTimeCC		
         			
         ;		lds	temp0,str6		;Seconds
         ;		sts	str1,temp0
         ;		sts	seconds,temp0
         		
         ;		lds	tempchar,day		;print day
         ;		ldi	temp0,65
         ;		rcall	printff
         		
         		
         ;		lds	tempchar,hour		;print hour
         ;		ldi	temp0,65
         ;		rcall	printff
         		
         ;		lds	tempchar,minute		;print minute
         ;		ldi	temp0,65
         ;		rcall	printff
         		
         ;		lds	tempchar,str1		;print seconds
         ;		ldi	temp0,65
         ;		rcall	printff
         		;-------Print Seconds-------------------
         		
         ;		rcall	GetTemp
         						;set bit0
         ;		ldi	temp0,1   		;switch on the temp function
         ;		ldi	zl,low(2*tempC)
         ;		ldi	zh,high(2*tempC)
         ;		rcall	GetTime
         ;		lds	temp0,LongWord+1
         ;		sts	Svolume,temp0		;store tempvalue in Svolume low byte
         ;		lds	temp0,LongWord
         ;		sts	Svolume+1,temp0		;store tempvalue in Svolume high byte
         ;		ldi	zl,low(LongWord)
         ;		ldi	zh,high(LongWord)
         ;		ldi	temp0,66		;print tempvalue
         ;		rcall	printff
         		
         		
         		
         ;		lds	temp0,day
         ;		cpi	temp0,1
         ;		brge	SharplpollTemp_100_2
         
         		
         ;		lds	temp0,hour
         ;		cpi	temp0,3
         ;		brge	SharplpollTemp_100	
         		
         ;-------------------Tempinterval 0-100  -------------------------------------		
         	
         	
         ;		ldi	temp0,1 		;Switch to AC clock
         ;		ldi	temp1,1			;Switch to time function
         ;		ldi	tempchar,0
         ;		rcall	GetTimeCC		
         		
         		
         						;set bit0
         ;		ldi	temp0,1   		;switch on the temp function
         ;		ldi	zl,low(2*tempGC0)
         ;		ldi	zh,high(2*tempGC0)
         ;		rcall	GetTime
         
         ;		rcall	TempCompare
         
         ;		ldi	zl,low(LongWord)
         ;		ldi	zh,high(LongWord)
         		
         		
         ;		ldi	temp0,130		;print tempgraf_value
         ;		rcall	printff
         ;		rjmp	Sharplpollexit00
         			
         
         ;SharplpollTemp_100:;------------------Tempinterval 100----------------------------
         ;		lds	temp0,hour
         ;		cpi	temp0,12
         ;		brge	SharplpollTemp_100_1
         ;		ldi	temp0,97
         ;		sts	LongWord+1,temp0	
         ;		clr	temp0
         ;		sts	LongWord,temp0
         ;		rcall	TempCompare
         		
         ;		ldi	tempchar,100			;print temp=100	
         ;		ldi	temp0,129	
         ;		rcall	printff			
         ;		rjmp	Sharplpollexit00
         ;SharplpollTemp_100_1:;---------------Tempinterval 100-600  ------------------------		
         		
         		;ldi	u_data,65
         		;rcall	putc
         		
         ;		ldi	temp0,1 		;Switch to AC clock
         ;		ldi	temp1,1			;Switch to time function
         ;		ldi	tempchar,1
         ;		rcall	GetTimeCC			
         						;set bit0
         ;		ldi	temp0,1   		;switch on the temp function
         ;		ldi	zl,low(2*tempGC1)
         ;		ldi	zh,high(2*tempGC1)
         ;		rcall	GetTime
         ;		lds	temp0,LongWord+1
         ;		ldi	temp1,100		;Add 100 to LongWord
         ;		add	temp0,temp1
         ;		sts	LongWord+1,temp0
         ;		lds	temp0,LongWord
         ;		brcc	Temp_Add	
         ;		inc	temp0
         ;Temp_Add:		
         ;		sts	LongWord,temp0
         		
         ;		rcall	TempCompare
         ;		ldi	zl,low(LongWord)
         ;		ldi	zh,high(LongWord)
         		
         ;		ldi	temp0,130		;print tempgraf_value
         ;		rcall	printff
         		
         		
         		
         ;		rjmp	Sharplpollexit00
         
         
         ;SharplpollTemp_100_2:;----------Tempinterval 600-----------------------------------
         ;		lds	temp0,hour
         ;		cpi	temp0,10
         ;		brge	SharplpollTemp_100_3
         		
         						;print temp=600	
         ;		ldi	temp0,2
         ;		sts	LongWord,temp0
         ;		ldi	temp0,88
         ;		sts	LongWord+1,temp0
         ;		clr	temp0
         ;		sts	LongWord+2,temp0
         ;		sts	LongWord+3,temp0
         		
         ;		rcall	TempCompare
         ;		ldi	zl,low(LongWord)
         ;		ldi	zh,high(LongWord)
         ;		ldi	temp0,130	
         ;		rcall	printff	
         ;		rjmp	Sharplpollexit00
         		
         ;SharplpollTemp_100_3:;----------Tempinterval 600-1000 -----------------------------------		
         ;		lds	temp0,hour
         ;		cpi	temp0,18
         ;		brge	SharplpollTemp_100_4
         		
         		
         		
         ;		ldi	temp0,1 		;Switch to AC clock
         ;		ldi	temp1,1			;Switch to time function
         ;		ldi	tempchar,2		;Switch to BreakPoint1
         ;		rcall	GetTimeCC			
         						;set bit0
         ;		ldi	temp0,1   		;switch on the temp function
         ;		ldi	zl,low(2*tempGC2)
         ;		ldi	zh,high(2*tempGC2)
         ;		rcall	GetTime
         ;		lds	temp0,LongWord+1
         ;		ldi	temp1,88		;Add 600=88,2 to LongWord
         ;		add	temp0,temp1
         ;		sts	LongWord+1,temp0
         ;		lds	temp0,LongWord
         ;		brcc	Temp_Add0
         		
         		
         ;		inc	temp0
         ;Temp_Add0:
         ;		inc	temp0
         ;		inc	temp0
         ;		sts	LongWord,temp0
         ;		
         ;		
         ;		rcall	TempCompare
         ;		ldi	zl,low(LongWord)
         ;		ldi	zh,high(LongWord)
         		
         ;		ldi	temp0,130		;print tempgraf_value
         ;		rcall	printff
         ;		rjmp	Sharplpollexit00
         
         ;SharplpollTemp_100_4:;-----------------------Temp 1000 Off------------------------
         		
         		;clr	temp0			;Lundsbrunn
         		;sts	SUARTbuf+2,temp0	;Lundsbrunn
         		;ldi	zl,low(SUARTbuf)
         		;ldi	zh,high(SUARTbuf)
         		;ldi	yl,low(TempBuf)
         		;ldi	yh,high(TempBuf)
         		;ldi	temp0,'$'
         		;st	y+,temp0
         		;ldi	temp0,'L'
         		;st	y+,temp0
         		;ldi	temp0,'S'
         		;st	y+,temp0
         		;adiw	zl,1
         		;rcall	MoveString	
         		;sbiw	yl,1
         		;ldi	temp0,'/'
         		;st	y+,temp0
         		;clr	temp0
         		;st	y+,temp0
         		;rcall	lampTest
         		
         		
         	
000a85 c002      	rjmp	Sharplpollexit00
          Sharplpoll00:
         ;-----------------------------------------------------------------------------
         	;lds	tempchar,SUARTbuf+1
         ;	lds	tempchar,SUARTbuf+4			;Only sharp xr-10x
         ;	cpi	tempchar,48
         ;	breq	Sharplpoll01
         ;	cpi	tempchar,49
         ;	breq	Sharplpoll02
         ;	cpi	tempchar,50
         ;	breq	Sharplpoll03
         ;	cpi	tempchar,51
         ;	breq	Sharplpoll04
         ;	cpi	tempchar,52
         ;	breq	Sharplpoll05
         ;	rjmp	Sharplpoll06
         	;rjmp	Sharplpollexit
          Sharplpoll01:	
         ;	ldi	tempchar,48
         ;	rjmp Sharplpoll07
         
          Sharplpoll02:
         ;	cbi	PORTC,7;4					;Set led button 1 On
         ;	sbi	PORTC,6;5
         ;	ldi	tempchar,49
         ;	sts	SUARTbuf+1,tempchar
         ;	rjmp	Sharplpollexit
         
         
         
         	
          Sharplpoll03:
         ;	ldi	tempchar,50
         ;	rjmp Sharplpoll07
          Sharplpoll04:
         ;	ldi	tempchar,51
         ;	rjmp Sharplpoll07
          Sharplpoll05:
         ;	ldi	tempchar,52
         ;	rjmp Sharplpoll07
          Sharplpoll06:
         ;	ldi	tempchar,'?'
         ;	rjmp Sharplpoll08					;Only sharp xr-10x
         	;rjmp	Sharplpollexit00				;Lunsbrunn
          Sharplpoll07:
         ;	sbi	PORTC,7;5					;Set led button 1 On
         ;	cbi	PORTC,6;4
         ;	cbi	PORTA,5
         ;	cbi	PORTA,6	
         ;	sts	SUARTbuf+1,tempchar
         ;	rjmp	Sharplpollexit
          Sharplpoll08:	
         ;	cbi	PORTC,7;5
         ;	cbi	PORTC,6;4
         ;	cbi	PORTA,5
         ;	cbi	PORTA,6	
         ;	sts	SUARTbuf+1,tempchar
          Sharplpollexit:
         
         ;-------------------------------------------------------------------------------
         	;clr	temp0			;Lundsbrunn
         	;sts	SUARTbuf+2,temp0	;Lundsbrunn
         	;ldi	zl,low(SUARTbuf)
         	;ldi	zh,high(SUARTbuf)
         	;ldi	yl,low(TempBuf)
         	;ldi	yh,high(TempBuf)
         	;ldi	temp0,'$'
         	;st	y+,temp0
         	;ldi	temp0,'L'
         	;st	y+,temp0
         	;ldi	temp0,'S'
         	;st	y+,temp0
         	;adiw	zl,1
         	;rcall	MoveString	
         	;sbiw	yl,1
         	;ldi	temp0,'/'
         	;st	y+,temp0
         	;clr	temp0
         	;st	y+,temp0
         	;push	yl
         	;push	yh
         	;ldi 	zl,low(2*tltt)				;Load strinpointer
         	;ldi 	zh,high(2*tltt)
         	;rcall	PrintSoftUstr				;Get lamptime
         ;	wdr						;watchdog reset
         	;rcall	ReadSoftUart	
         	;ldi	zl,low(SUARTbuf)
         	;ldi	zh,high(SUARTbuf)
         	;adiw	zl,1
         	;pop	yh				;t
         	;pop	yl				;t
         	;sbiw	yl,1				;t
         	;rcall	MoveString			;t
         	;sbiw	yl,2
         ;-----------------------------------------------------------------------------------
         	;ldi 	zl,low(fieldFlag)			;Load strinpointer
         	;ldi 	zh,high(fieldFlag)
         	;rcall	EERead					;Get fieldFlag
         	;clr 	temp0
         	;sbrc	tempchar,0				;Skip if bit0 is cleared
         	;rcall	PrintCustomerNo
         	
         ;	sbiw	yl,2
         ;	ldi	temp0,'/'
         ;	st	y+,temp0
         ;	ldi	zl,low(customernoE)
         ;	ldi	zh,high(customernoE)
         ;	rcall	MoveEEtoRam
         ;	sbiw	yl,1
         ;-----------------------------------------------------------------------------------
         
         
         	;ldi 	zl,low(ireg)		;Load strinpointer
         	;ldi 	zh,high(ireg)
         	;rcall	EERead			;Get initreg ireg
         	;mov	temp0,tempchar
         ;	lds	temp0,Bflags
         ;	sbrs	temp0,2
         ;	rjmp	Sharplpoll09
         ;	cbr	temp0,4			;clear bit 3
         	;mov	tempchar,temp0
         	;rcall	EEWrite
         ;	sts	Bflags,temp0
         ;	sbiw	yl,2
         ;	ldi	temp0,'/'
         ;	st	y+,temp0
         ;	ldi	temp0,'S'
         ;	st	y+,temp0
         ;	ldi	temp0,'t'
         ;	st	y+,temp0
         ;	ldi	temp0,'a'
         ;	st	y+,temp0
         ;	ldi	temp0,'r'
         ;	st	y+,temp0
         ;	ldi	temp0,'t'
         ;	st	y+,temp0
         ;	clr	temp0
         ;	st	y+,temp0
         	
          Sharplpoll09:
000a86 ddbf      	rcall	lampTest		;Only modul
         
000a87 9508      ret					;Only modul
         
          Sharplpollexit00:
         		;ldi	xl,low(phoneno)
         		;ldi	xh,high(phoneno)
         		
         	;	ldi	tempchar,0x55
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x10
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x9d
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x4c
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x15	
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x02
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x08
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x00
         	;	st	x+,tempchar
         	;	ldi	tempchar,0x48
         	;	st	x+,tempchar
         	;	ldi	xl,low(phoneno)
         	;	ldi	xh,high(phoneno)
         		
000a88 eae2      		ldi 	zl,low(2*tempa0)				;Load strinpointer to commandlist 
000a89 e1fe      		ldi 	zh,high(2*tempa0)
000a8a d257      		rcall	ReadDs18s20
000a8b e341      		ldi	temp0,49	
000a8c d148      		rcall	printff	
         		
         		
         		
000a8d eaec      		ldi 	zl,low(2*tempa1)				;Load strinpointer to commandlist 
000a8e e1fe      		ldi 	zh,high(2*tempa1)
000a8f d252      		rcall	ReadDs18s20
000a90 e341      		ldi	temp0,49	
000a91 d143      		rcall	printff	
         		
         ;		ldi	xl,low(phoneno)
         ;		ldi	xh,high(phoneno)
         		
         ;		ldi	tempchar,0x55
         ;		st	x+,tempchar
         ;		ldi	tempchar,0x10
         ;		st	x+,tempchar
         ;		ldi	tempchar,0x97
         ;		st	x+,tempchar
         ;		ldi	tempchar,0x18
         ;		st	x+,tempchar
         ;		ldi	tempchar,0x15	
         ;		st	x+,tempchar
         ;		ldi	tempchar,0x02
         ;		st	x+,tempchar
         ;		ldi	tempchar,0x08
         ;		st	x+,tempchar
         ;		ldi	tempchar,0x00
         ;		st	x+,tempchar
         ;		ldi	tempchar,0x0d
         ;		st	x+,tempchar
         ;		ldi	xl,low(phoneno)
         ;		ldi	xh,high(phoneno)
         		
000a92 ebe6      		ldi 	zl,low(2*tempa2)				;Load strinpointer to commandlist 
000a93 e1fe      		ldi 	zh,high(2*tempa2)
000a94 d24d      		rcall	ReadDs18s20
         		
         	;	ldi	tempchar,100			;print temp=100	
000a95 e149      		ldi	temp0,25	
000a96 d13e      		rcall	printff	
         		
         ;		ldi 	zl,low(tempref)		;Load strinpointer
         ;		ldi 	zh,high(tempref)
         ;		rcall	EERead	
         ;		mov	temp0,tempchar
         ;		lds	tempchar,reftemp
         		
         ;		cp	temp0,tempchar
         ;		breq	sharppolltempref	
         ;		ldi 	zl,low(tempref)		;Load strinpointer
         ;		ldi 	zh,high(tempref)
         ;		rcall	EEWrite	
         ;		ldi	u_data,'X'
         ;		rcall	putc
         
         
         
          sharppolltempref0:
         	;	clr	temp0
         	;	sts	LongWord,temp0
         	;	sts	LongWord+1,temp0
         	;	sts	LongWord+2,temp0
         	;	sts	LongWord+3,temp0
         	;	clc
         	;	ldi	tempchar,64
         	;	sts	LongWord+1,tempchar
         	;	ldi	zl,low(LongWord)
         	;	ldi	zh,high(LongWord)
         	;	ldi	xl,low(Str6)
         	;	ldi	xh,high(Str6)
         	;	rcall	Itoa
         		
         	;	ldi 	zl,low(Str6)				;Load strinpointer
         	;	ldi 	zh,high(Str6)
         	;	adiw	zl,3
         	;	rcall	PrintSoftU
         	;	ldi	u_data,65;13				;Load byte
         	;	rcall	putc					;Send byte to soft-uart
         
         
         
         
         ;***************Not used with modul*********************************	
000a97 2744      	clr	temp0			 
000a98 9340 01f9 	sts	Count,temp0		;clear time counter
000a9a 9340 0150 	sts	TempBuf,temp0
000a9c d67f      	rcall	timer1_init
         ;*******************************************************************	
         ;	cbi	PORTD,6	
000a9d 9508      ret
         
         
         
         
         
         
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  Securety:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         ;Securety:
         
         
         
         
         
         
         ;		ret
         ;------------------------------------------------------------------------------------------------------------------												
         ;************************************************************************************
         ;*FUNCTION
         ;*  SetSmsFlag:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
          SetSmsFlag:
000a9e 9140 0206 		lds	temp0,Bflags
000aa0 6042      		sbr	temp0,2
000aa1 9340 0206 		sts	Bflags,temp0
         
         
000aa3 9508      	ret
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  SetCrFlag:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
          SetCrFlag:
000aa4 9140 0206 		lds	temp0,Bflags
000aa6 6140      		sbr	temp0,16
000aa7 9340 0206 		sts	Bflags,temp0
         
         
000aa9 9508      	ret
         
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  ClearSmsFlag:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         
         
         
         
          ClearSmsFlag:
         
000aaa 9140 0206 		lds	temp0,Bflags
000aac 7f4d      		cbr 	temp0,2
000aad 9340 0206 		sts	Bflags,temp0
         		
000aaf 9508      	ret	
         
         
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  ClearCrFlag:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         
         
         
         
          ClearCrFlag:
         
000ab0 9140 0206 		lds	temp0,Bflags
000ab2 7e4f      		cbr 	temp0,16
000ab3 9340 0206 		sts	Bflags,temp0
         		
000ab5 9508      	ret	
         
         
         
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  PrintCustomerNo:
         ;*
         ;*DESCRIPTION
         ;*
         ;*PARAMETER
         ;*
         ;*
         ;************************************************************************************
         
          PrintCustomerNo:
         		;sbiw	yl,2
000ab6 e24f      		ldi	temp0,'/'
000ab7 9349      		st	y+,temp0
000ab8 ece9      		ldi	zl,low(customernoE)
000ab9 e0f0      		ldi	zh,high(customernoE)
000aba df22      		rcall	MoveEEtoRam
000abb 9721      		sbiw	yl,1
         
000abc 9508      	ret
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	sub_32
         ;*
         ;* DESCRIPTION
         ;*	str6=str6-LongWord
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;* RETURN
         ;*	str6,r22
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
          sub_32:
         
         	;ldi	zl,low(2*dayC)
         	;ldi	zh,high(2*dayC)	
         	;lpm				;Load byte from program memory into r0
         	;sts	LongWord,r0
         	;inc	zl
         	;lpm
         	;sts	LongWord+1,r0
         	;inc	zl
         	;lpm
         	;sts	LongWord+2,r0
         	;inc	zl
         	;lpm
         	;sts	LongWord+3,r0
         	
         	
         	;ldi	temp0,0
         	;sts	str6,temp0
         	
         	;ldi	temp0,0
         	;sts	str6+1,temp0
         	
         	
         	;ldi	temp0,2
         	;sts	str6+2,temp0
         	
         	;ldi	temp0,0
         	;sts	str6+3,temp0
         ;------------------------------------------------------------------------------------------------
000abd e060      	ldi	r22,00
         	;ldi	temp0,200
         	;sts	str6,temp0
         	;ldi	temp0,220
         	;sts	LongWord,temp0
         	
         	;ldi	temp0,0
         	;sts	str6+1,temp0
         	;ldi	temp0,0
         	;sts	LongWord+1,temp0
         	
         	
         	;ldi	temp0,1
         	;sts	str6+2,temp0
         	;ldi	temp0,0
         	;sts	LongWord+2,temp0
         	
         	;ldi	temp0,0
         	;sts	str6+3,temp0
         	;ldi	temp0,0
         	;sts	LongWord+3,temp0
         ;******Check if Str6>LongWord *************************************************************
000abe 9130 01cc 	lds	temp1,Str6+3
000ac0 9140 01d4 	lds	temp0,LongWord+3
000ac2 1743      	cp	temp0,temp1
000ac3 f0f8      	brlo	sub_32_00
000ac4 b76f      	in	r22,SREG
000ac5 ff61      	sbrs	r22,1
000ac6 9508      	ret
         	;-------------------------
000ac7 9130 01cb 	lds	temp1,Str6+2
000ac9 9140 01d3 	lds	temp0,LongWord+2
000acb 1743      	cp	temp0,temp1
000acc f0b0      	brlo	sub_32_00
000acd b76f      	in	r22,SREG
000ace ff61      	sbrs	r22,1
000acf 9508      	ret
         	;--------------------------
000ad0 9130 01ca 	lds	temp1,Str6+1
000ad2 9140 01d2 	lds	temp0,LongWord+1
000ad4 1743      	cp	temp0,temp1
000ad5 f068      	brlo	sub_32_00
000ad6 b76f      	in	r22,SREG
000ad7 ff61      	sbrs	r22,1
000ad8 9508      	ret
         	;--------------------------
000ad9 9130 01c9 	lds	temp1,Str6
000adb 9140 01d1 	lds	temp0,LongWord
000add 1743      	cp	temp0,temp1
000ade f020      	brlo	sub_32_00
000adf b76f      	in	r22,SREG
         	;sbrs	r22,1
         	;clr	r22
         	;ldi	r22,253
000ae0 fd61      	sbrc	r22,1
000ae1 c001      	rjmp sub_32_00
000ae2 9508      	ret
         ;*****************************************************************************************************	
          sub_32_00:
         	;lds	temp0,Str6
         	;lds	temp1,LongWord
000ae3 2722      	clr	tempchar			;init indexcounter
000ae4 ecc9      	ldi	yl,low(Str6)
000ae5 e0d1      	ldi	yh,high(Str6)
000ae6 ede1      	ldi	zl,low(LongWord)
000ae7 e0f1      	ldi	zh,high(LongWord)
000ae8 2f2c      	mov	tempchar,yl
          sub_32_01:
000ae9 8148      	ld	temp0,y
000aea 8130      	ld	temp1,z
000aeb 9488      	clc
         ;sub_32_02:
         	;sec
         	;ldi	temp0,0
         	;ldi	temp1,0
000aec 0b43      	sbc	temp0,temp1
000aed f040      	brcs	sub_32_borrow1
          sub_32_02:
000aee 8348      	st	y,temp0
000aef 9621      	adiw	yl,1	;inc	yl
000af0 9631      	adiw	zl,1	;inc	zl
000af1 9523      	inc	tempchar
000af2 3c2c      	cpi	tempchar,low(str6)+3
000af3 f7a9      	brne	sub_32_01
000af4 b76f      	in	r22,SREG
         	
         	;lds	temp0,str6
         	;lds	temp0,str6+1
         	;lds	temp0,str6+2
         	;lds	temp0,str6+3
000af5 9508      	ret
          sub_32_borrow1:	
         	;clc
         	;ldi	temp1,256
         	;adc	temp0,temp1
         	;sts	Str6,temp1
          sub_32_borrow_01:
         ;rev	inc	tempchar   ;test
000af6 9621      	adiw 	yl,1		;inc	yl	
         	;lds	temp1,Str6+1
000af7 8138      	ld	temp1,y
000af8 3030      	cpi	temp1,0
000af9 f3e1      	breq	sub_32_borrow_01
         	;cln
         	;???????????????????????????????????
         	
         	;dec	temp1
         	;inc	tempchar   ;*************
         	
000afa 953a      	dec	temp1
000afb 8338      	st	y,temp1
         ;rev	dec	tempchar
000afc 9721      	sbiw	yl,1	;dec	yl
         	
         	;???????????????????????????????????????
          sub_32_borrow_02:
         	;st	y,temp1
         	;dec	tempchar    ;test
         	;dec	yl
000afd 8138      	ld	temp1,y
000afe 3030      	cpi	temp1,0
000aff f431      	brne	sub_32_borrow_04
         ;rev	cpi	tempchar,0	;test
         ;rev	breq	sub_32_borrow_04 ;test
000b00 172c      	cp	tempchar,yl
000b01 f021      	breq	sub_32_borrow_04 	
         	;dec	tempchar    ;******
         	;dec	yl		;****
000b02 ef3f      	ldi	temp1,0xff
000b03 8338      	st	y,temp1
         ;rev	dec	tempchar
000b04 9721      	sbiw	yl,1	;dec	yl
000b05 cff7      	rjmp	sub_32_borrow_02
          sub_32_borrow_04:
         	;inc	yl      ;*************
000b06 9488      	clc
         ;	sec
000b07 8148      	ld	temp0,y
000b08 8130      	ld	temp1,z
000b09 0b43      	sbc	temp0,temp1
         	;inc	temp0
         	;------------------
         	;clc
         	;ldi	temp1,256
         	;adc	temp0,temp1
         	;--------------------
000b0a cfe3      	rjmp	sub_32_02	
000b0b 9508      	ret
         
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	GetTemp
         ;*
         ;* DESCRIPTION
         ;*	
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;* RETURN
         ;*	
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          GetTemp:
         	
000b0c 98c7      		cbi	portb,sck
000b0d ec22      		ldi	tempchar,194
000b0e d133      		rcall	rw_spi
         		;mov	u_data,tempchar
         		;rcall	putc		
000b0f 9320 01d1 		sts	LongWord,tempchar		;low
000b11 dbba      		rcall	delay
000b12 e024      		ldi	tempchar,0x04
000b13 d12e      		rcall	rw_spi
         		;mov	u_data,tempchar
         		;rcall	putc
000b14 9320 01d2 		sts	LongWord+1,tempchar
000b16 dbb5      		rcall	delay
000b17 e020      		ldi	tempchar,0x00
000b18 d129      		rcall	rw_spi
         		;mov	u_data,tempchar
         		;rcall	putc	
000b19 9320 01d3 		sts	LongWord+2,tempchar		;high
         
000b1b e637      		ldi	temp1,103		;4,3X24	load TempOffset
         		
         		
000b1c 2744      		clr	temp0
000b1d 9340 01c9 		sts	str6,temp0
000b1f 9340 01ca 		sts	str6+1,temp0
000b21 9340 01cb 		sts	str6+2,temp0
000b23 9340 01cc 		sts	str6+3,temp0
         		
         		;------------------Add TempOffset
000b25 9120 01d1 		lds	tempchar,LongWord		;low
000b27 9488      		clc
000b28 1f32      		adc	temp1,tempchar
000b29 9330 01d1 		sts	LongWord,temp1
000b2b 9120 01d3 		lds	tempchar,LongWord+2		;high
000b2d 2733      		clr	temp1
000b2e 1f32      		adc	temp1,tempchar
000b2f 9330 01d3 		sts	LongWord+2,temp1
         		
         
         		;------------------Multiply with 10		
          GetTemp0:
000b31 9120 01d1 		lds	tempchar,LongWord		;low
000b33 9130 01c9 		lds	temp1,str6
000b35 9488      		clc
000b36 1f32      		adc	temp1,tempchar
000b37 9330 01c9 		sts	str6,temp1
000b39 9120 01d3 		lds	tempchar,LongWord+2		;high
000b3b 9130 01ca 		lds	temp1,str6+1
000b3d 1f32      		adc	temp1,tempchar
000b3e 9330 01ca 		sts	str6+1,temp1
000b40 9543      		inc	temp0
000b41 304a      		cpi	temp0,10
000b42 f771      		brne	GetTemp0
         		
         	
         ;		lds	tempchar,str6
         ;		lds	temp0,str6+1		
         		
000b43 9508      	ret
         	
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	GetTime
         ;*
         ;* DESCRIPTION
         ;*	
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*
         ;* PARAMETER	
         ;*	temp0   bit0=tempFlag     switch on the temp function
         ;*		bit1=timeFlag 	  switch on the time function
         ;*
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
          GetTime:
000b44 934f      	push	temp0			;stor switchFlags on stack
         ;	ldi	temp0,16;15;16;140
         ;	sts	str6,temp0
         ;	ldi	temp0,0
         ;	sts	str6+1,temp0
         ;	ldi	temp0,1
         ;	sts	str6+2,temp0
         ;	ldi	temp0,0
         ;	sts	str6+3,temp0
         	;clr	temp0
         	;sts	str1,temp0
000b45 2733      	clr	temp1
000b46 9330 01c8 	sts	str1,temp1
         
         	
         ;	ldi	zl,low(2*tempC)
         ;	ldi	zh,high(2*tempC)
000b48 fd40      	sbrc	temp0,0
000b49 c015      	rjmp	GetTimeStart
         	;---------------------Init year----------------------------------------------------
000b4a eee4      	ldi	zl,low(2*yearC)
000b4b e1fe      	ldi	zh,high(2*yearC)	
000b4c c012      	rjmp	GetTimeStart
         	;----------------------Init day----------------------------------------------------
          GetTimeInitDay0:		
         	;lds	temp0,LongInt			;store year
         	
000b4d 9330 0207 	sts	year,temp1
         
         ;	rjmp	GetTime_02
000b4f eee8      	ldi	zl,low(2*dayC)
000b50 e1fe      	ldi	zh,high(2*dayC)	
000b51 c00d      	rjmp	GetTimeStart
         	;----------Init Hour--------------------------------------------------------------
          GetTimeInitHour:
         	;lds	temp0,LongInt
000b52 9330 0208 	sts	day,temp1			;store day 
000b54 9140 01d0 	lds	temp0,LongInt+1
000b56 9340 0209 	sts	day+1,temp0
000b58 eeec      	ldi	zl,low(2*hourC)
000b59 e1fe      	ldi	zh,high(2*hourC)	
000b5a c004      	rjmp	GetTimeStart
         	;----------init Minute--------------------------------------------------------------
          GetTimeInitMinute:	
         	;lds	temp0,LongInt
000b5b 9330 020a 	sts	hour,temp1			;store hour 
000b5d efe0      	ldi	zl,low(2*minuteC)
000b5e e1fe      	ldi	zh,high(2*minuteC)
          GetTimeStart:
000b5f 95c8      	lpm				;Load byte from program memory into r0
000b60 9200 01d1 	sts	LongWord,r0
000b62 95e3      	inc	zl
000b63 95c8      	lpm
000b64 9200 01d2 	sts	LongWord+1,r0
000b66 95e3      	inc	zl
000b67 95c8      	lpm
000b68 9200 01d3 	sts	LongWord+2,r0
000b6a 95e3      	inc	zl
000b6b 95c8      	lpm
000b6c 9200 01d4 	sts	LongWord+3,r0
         	
000b6e 2744      	clr	temp0
000b6f 9340 01cf 	sts	LongInt,temp0
000b71 9340 01d0 	sts	LongInt+1,temp0
         	
          GetTime_00:
000b73 df49      	rcall	sub_32
         	;lds	temp0,str6
         	;lds	temp0,str6+1
         	;lds	temp0,str6+2
         	;lds	temp0,str6+3
         
000b74 ff61      	sbrs	r22,1
000b75 c00d      	rjmp	GetTime_01
000b76 e031      	ldi	temp1,1
000b77 9140 01cf 	lds	temp0,LongInt
000b79 1f43      	adc	temp0,temp1
         
000b7a 9340 01cf 	sts	LongInt,temp0
000b7c f7b0      	brcc	GetTime_00
000b7d 9140 01d0 	lds	temp0,LongInt+1
000b7f 9543      	inc	temp0
000b80 9340 01d0 	sts	LongInt+1,temp0
000b82 cff0      	rjmp	GetTime_00
          GetTime_01:
         	;lds	temp0,LongInt
         	;lds	temp0,LongInt+1
000b83 9130 01cf 	lds	temp1,LongInt
         	
000b85 9140 01c8 	lds	temp0,str1
000b87 9543      	inc	temp0
000b88 9340 01c8 	sts	str1,temp0
000b8a 3041      	cpi	temp0,1
000b8b f091      	breq	GetTimeInitDay
000b8c 3042      	cpi	temp0,2
000b8d f221      	breq	GetTimeInitHour
000b8e 3043      	cpi	temp0,3
000b8f f259      	breq	GetTimeInitMinute
000b90 9140 01cf 	lds	temp0,LongInt
000b92 9340 020b 	sts	minute,temp0			;store minute
000b94 9508      ret
         	;lds	temp0,minute
         	;lds	temp0,hour
         	;lds	temp0,day
         	;lds	temp0,year
          GetTime_02:
         	;lds	temp0,LongInt+1
         	;sts	day,temp0
000b95 9140 01cf 	lds	temp0,LongInt
000b97 9340 01d2 	sts	LongWord+1,temp0
000b99 9140 01d0 	lds	temp0,LongInt+1
000b9b 9340 01d1 	sts	LongWord,temp0	
000b9d 9508      ret	
         
          GetTimeInitDay:
000b9e 914f      	pop	temp0
000b9f fd40      	sbrc	temp0,0
000ba0 cff4      	rjmp	GetTime_02
000ba1 cfab      	rjmp	GetTimeInitDay0
         ;-------------------------------------------------------------------------------------------
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	GetTimeCC
         ;*
         ;* DESCRIPTION
         ;*	
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	temp0     bit0=CCFlag 	  switch on the CC clock
         ;*		  bit1=ACFlag 	  switch on the AC clock
         ;*	
         ;*	temp1	  bit0
         ;*		  bit1
         ;*
         ;*	tempchar  bit0
         ;*
         ;*
         ;*
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
          GetTimeCC:	
         		
000ba2 933f      		push	temp1
000ba3 932f      		push	tempchar
000ba4 fd40      		sbrc	temp0,0
000ba5 e441      		ldi	temp0,65
000ba6 fd41      		sbrc	temp0,1
000ba7 e841      		ldi	temp0,129
000ba8 eda1      		ldi	xl,low(LongWord)
000ba9 e0b1      		ldi	xh,high(LongWord)		;Load pointer to clock return value
000baa db52      		rcall	DsClock
000bab 9140 01d4 		lds	temp0,LongWord+3
000bad 9340 01c9 		sts	str6,temp0
000baf 9140 01d3 		lds	temp0,LongWord+2
000bb1 9340 01ca 		sts	str6+1,temp0
000bb3 9140 01d2 		lds	temp0,LongWord+1
000bb5 9340 01cb 		sts	str6+2,temp0
000bb7 9140 01d1 		lds	temp0,LongWord
000bb9 9340 01cc 		sts	str6+3,temp0
         		;-----------------------------------
000bbb 914f      		pop	temp0
000bbc fd40      		sbrc	temp0,0
000bbd c003      		rjmp	GetTimeCC00
000bbe fd41      		sbrc	temp0,1
000bbf c004      		rjmp	GetTimeCC01
000bc0 c006      		rjmp	GetTimeCC03	
         		
          GetTimeCC00:		
000bc1 e0e8      		ldi	zl,low(2*BreakPoint0)
000bc2 e1ff      		ldi	zh,high(2*BreakPoint0)
000bc3 c003      		rjmp	GetTimeCC03	
         		
          GetTimeCC01:		
000bc4 e0ec      		ldi	zl,low(2*BreakPoint1)
000bc5 e1ff      		ldi	zh,high(2*BreakPoint1)
         		
          GetTimeCC02:		
000bc6 def6      		rcall	sub_32
         	
         		
          GetTimeCC03:
         		;-------------------------------------------
         		;----------------------------------------------
         ;		pop	temp0
         ;		sbrs	temp0,0
         ;		rjmp	GetTimeCC00	
         ;		ldi	zl,low(2*BreakPoint0)
         ;		ldi	zh,high(2*BreakPoint0)		
         ;		rcall	sub_32
         ;GetTimeCC00:
         		;------------------------------------------------
         		
         		
         		
000bc7 914f      		pop	temp0
         		;ldi	temp0,2					;set bit1 switch on the time function
000bc8 df7b      		rcall	GetTime
000bc9 2744      		clr	temp0
000bca 9340 01d1 		sts	LongWord,temp0
000bcc 9340 01d2 		sts	LongWord+1,temp0
000bce 9340 01d3 		sts	LongWord+2,temp0
000bd0 9340 01d4 		sts	LongWord+3,temp0
000bd2 9140 01c9 		lds	temp0,str6
000bd4 9508      ret
         
         ;-------------------------------------------------------------------------------------------
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	printff
         ;*
         ;* DESCRIPTION
         ;*	Print to the rs232-output
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	temchar   print out parameter	bit0
         ;*	z pointer			bit1
         ;*	
         ;*	temp0	bit0
         ;*		bit1
         ;*		bit2	
         ;*		bit3=1		no end char		
         ;*		bit4=1		increase pointer z=z+2	
         ;*		bit5=1		/	
         ;*		bit6=1		space
         ;*		bit7=1		Cr
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
          printff:
000bd5 934f      		push	temp0
000bd6 fd40      		sbrc	temp0,0
000bd7 c003      		rjmp	printff_00
000bd8 fd41      		sbrc	temp0,1
000bd9 c00c      		rjmp	printff_01
000bda c01f      		rjmp	printff_exit
          printff_00:		
000bdb 9320 01d2 		sts	LongWord+1,tempchar
000bdd 2722      		clr	tempchar
000bde 9320 01d3 		sts	LongWord+2,tempchar
000be0 9320 01d4 		sts	LongWord+3,tempchar
000be2 9320 01d1 		sts	LongWord,tempchar
000be4 ede1      		ldi	zl,low(LongWord)
000be5 e0f1      		ldi	zh,high(LongWord)
         		
          printff_01:	
         	
000be6 eca9      		ldi	xl,low(Str6)
000be7 e0b1      		ldi	xh,high(Str6)
000be8 dab6      		rcall	Itoa
000be9 ece9      		ldi 	zl,low(Str6)			;Load strinpointer
000bea e0f1      		ldi 	zh,high(Str6)
000beb 9631      		adiw	zl,1
000bec 914f      		pop	temp0
000bed 934f      		push	temp0
000bee fd44      		sbrc	temp0,4
000bef 9632      		adiw	zl,2
000bf0 da2f      		rcall	PrintSoftU
         		
         	
000bf1 914f      		pop	temp0
000bf2 fd45      		sbrc	temp0,5
000bf3 e25f      		ldi	u_data,'/'
000bf4 fd46      		sbrc	temp0,6
000bf5 e250      		ldi	u_data,32
000bf6 fd47      		sbrc	temp0,7
000bf7 e05d      		ldi	u_data,13
000bf8 ff43      		sbrs	temp0,3
000bf9 d52e      		rcall	putc
         
          printff_exit:
         
000bfa 9508      ret
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	TempCompare
         ;*
         ;* DESCRIPTION
         ;*t
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
          TempCompare:
         		;lds	temp0,LongWord
         		
         		;mov	u_data,temp0
         		;rcall	putc
         		;lds	temp1,Svolume+1
         		;mov	u_data,temp1
         		;rcall	putc
000bfb 9140 01d2 		lds	temp0,LongWord+1
000bfd 9340 020e 		sts	GTemperature,temp0		;Store lowbyte
         		
         		
         		
000bff 9140 01d1 		lds	temp0,LongWord
000c01 9340 020f 		sts	GTemperature+1,temp0		;Store higbyte
000c03 9130 0204 		lds	temp1,Svolume+1
000c05 1734      		cp	temp1,temp0
000c06 f048      		brlo	tempCompare00_2		
000c07 f431      		brne	tempCompare00_1	
         		
         		;mov	u_data,temp1
         			
         		;rcall	putc	
         ;tempCompare00_0:		
000c08 9140 01d2 		lds	temp0,LongWord+1
000c0a 9130 0203 		lds	temp1,Svolume
000c0c 1734      		cp	temp1,temp0
000c0d f010      		brlo	tempCompare00_2
          tempCompare00_1:
000c0e 9897      		cbi	portd,7		
000c0f c001      		rjmp	tempCompare00_3
          tempCompare00_2:
000c10 9a97      		sbi	portd,7
          tempCompare00_3:
         
         
000c11 9508      ret
         
         
         
         ;************************************************************************************
         ;*FUNCTION
         ;*  strtol:
         ;*
         ;*DESCRIPTION	Converts string to long integer  
         ;*
         ;*PARAMETER	Input: Pointer to string y, Output: str6 low byte,  str6+1  high byte
         ;*
         ;*
         ;************************************************************************************
         
         
          atol:
         
         
         
         
         
         
         
         ;	clr	temp0
         ;	sts	str6,tempchar					;clear low byte
         ;	sts	str6+1,tempchar					;clear high byte
         ;	ldi 	zl,low(2*exponent)				;10 Exponent
         ;	ldi 	zh,high(2*exponent)
         
         
         
          atol_10:
         
         
000c12 9129      	ld	tempchar,y+		;Load byte from program memory into tempchar
000c13 2322      	tst	tempchar		;Test if we have reached the end of the string
000c14 f049      	breq	atol_20			;If not so, go to atol_20	
000c15 f159      	breq	atolExit
000c16 3320      	cpi	tempchar,48
000c17 f3d0      	brlo	atol_10
000c18 332a      	cpi	tempchar,58
000c19 f7c0      	brsh	atol_10
000c1a 5320      	subi	tempchar,48
000c1b 932f      	push	tempchar
000c1c 9543      	inc	temp0
000c1d cff4      	rjmp	atol_10
         
         
         
         	
          atol_20:	
000c1e 2722      	clr	tempchar
000c1f 9320 01c9 	sts	str6,tempchar					;clear low byte
000c21 9320 01ca 	sts	str6+1,tempchar					;clear high byte
000c23 e1e0      	ldi 	zl,low(2*exponent)				;10 Exponent
000c24 e1ff      	ldi 	zh,high(2*exponent)
000c25 9488      	clc
          atol_30:
000c26 2344      	tst	temp0
000c27 f0c9      	breq	atolExit
000c28 912f      	pop	tempchar
000c29 2322      	tst	tempchar
000c2a f099      	breq	atol_40
000c2b 952a      	dec	tempchar
000c2c 932f      	push	tempchar
         	;ld	tempchar,y+					;load exponent low byte
000c2d 95c8      	lpm
000c2e 2d20      	mov	tempchar,r0
000c2f 9130 01c9 	lds	temp1,str6
000c31 1f32      	adc	temp1,tempchar
000c32 9330 01c9 	sts	str6,temp1
         	;adiw	zl,1
000c34 95e3      	inc	zl
000c35 95c8      	lpm
000c36 2d20      	mov	tempchar,r0
         	;ld	tempchar,y+					;loaad exponent high byte
000c37 9130 01ca 	lds	temp1,str6+1
000c39 1f32      	adc	temp1,tempchar
000c3a 9330 01ca 	sts	str6+1,temp1
000c3c 9731      	sbiw	zl,1	
000c3d cfe8      	rjmp	atol_30
         		
         	;tst	temp0
         	;breq	atolExit
         	;pop	temp1			;x10
         	;add	tempchar,temp1
          atol_40:
000c3e 954a      	dec	temp0
000c3f 9632      	adiw	zl,2
000c40 cfe5      	rjmp	atol_30
         	;rjmp	atol_10
         
          atolExit:
         
000c41 9508      	ret
         
         
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	rw_spi
         ;*
         ;* DESCRIPTION
         ;*	Write a word out on SPI while simultaneously reading in a word.
         ;*	Data is sent MSB-first, and info read from SPI goes into
         ;*	the same buffer that the write data is going out from.
         ;*	Make sure data, clock and /SS are init'd before coming here.
         ;*	SCK high time is ((delay * 3) + 1) AVR clock cycles.
         ;*
         ;*	If 8-bit use is needed, change  LDI TEMP,16  to ,8  and also
         ;*	eliminate the ROL SPI_HI statement.
         ;*
         ;* CODE SIZE:
         ;*	21 words
         ;* NUMBER OF CYCLES:
         ;*	Overhead = 8, loop = 16 * (16 + (2* (delay_value*3)))
         ;	(With call + return + delay=4, it is about 648 cycles.)
         ;*
         ;***************************************************************************
         
          rw_spi:	
         			;----Set Delay Value---------------------
000c42 e230      	ldi	temp1,0x20	;0x20
000c43 9330 01d8 	sts	DelayV,temp1
000c45 e530      	ldi	temp1,0x50
000c46 9330 01d9 	sts	DelayV+1,temp1
         	;ldi	temp1,0x50	;0x01
000c48 e031      	ldi	temp1,0x01
000c49 9330 01da 	sts	DelayV+2,temp1
         
         ;;			ldi	temp,16		;init loop counter to 16 bits
000c4b e048             	ldi	temp0,8		;use THIS line instead if 8-bit desired
000c4c 98c7      	cbi	portb,sck
         ;;;;;;;;	cbi	portb,ss
         ;	rcall	delay
         	;
         
          spi_loop:
000c4d 0f22      	lsl	tempchar	;	lsl	spi_lo		;move 0 into D0, all other bits UP one slot,
         	
         
         ;;			rol	spi_hi		; and C ends up being first bit to be sent.
          ;If 8-bit desired, also comment out the preceding ROL SPI_HI statement
         	;
000c4e f410      	brcc	lo_mosi
000c4f 9ac5      	sbi	portb,mosi	;mosi_hi
000c50 c001      	rjmp	mosi_done	;this branch creates setup time on MOSI
          lo_mosi:
000c51 98c5      	cbi	portb,mosi	;mosi_lo
         ;	nop			;also create setup time on MOSI
          mosi_done:
         	;
000c52 da79      	rcall	delay		;mod
         ;	set_delay temp0,7
         ;	time_hi:
         ;	inc_delay temp0		;inc upper nibble until it rolls over; then,
         ;	brcs	time_hi		; C gets CLEARED, & temp has original value
000c53 9ac7      	sbi	portb,sck	;sck_hi
         	;
          ;must now time the hi pulse - not much else we can do here but waste time
         	;
         	;set_delay temp0,4	;(4 * 3) cycle delay; range is from 1 to 7!
         ;	set_delay temp0,7
         ;time_hi:
         ;	inc_delay temp0		;inc upper nibble until it rolls over; then,
         ;	brcs	time_hi		; C gets CLEARED, & temp has original value
         
000c54 da77      	rcall delay
         
         ;	set_delay temp0,7
         ;	time_lo:
         ;	inc_delay temp0
         ;	brcs	time_lo
         	
000c55 99b6      	sbic	pinb,miso	;after delay, read in SPI bit & put into D0
000c56 9523      	inc	tempchar	;inc	spi_lo		;we FORCED D0=0, so use INC to set D0.
         	
000c57 98c7      	cbi	portb,sck	;sck_lo			;drop clock line low
         	
          ;must now delay before reading in SPI data on MISO
         	;
         	;set_delay temp0,4
         ;	set_delay temp0,7
         ;time_lo:
         ;	inc_delay temp0
         ;	brcs	time_lo
         ;	rcall delay	
         ;	sbic	pinb,miso	;after delay, read in SPI bit & put into D0
         ;	inc	tempchar	;inc	spi_lo		;we FORCED D0=0, so use INC to set D0.
         	
000c58 954a      	dec	temp0
000c59 f799      	brne	spi_loop
         	;cbi	portb,mosi
         ;	ldi	temp1,0x20	;0x20
         ;	sts	DelayV,temp1
         ;	ldi	temp1,0x50
         ;	sts	DelayV+1,temp1
         ;	ldi	temp1,0x10	;0x01
         ;	sts	DelayV+2,temp1
         ;	rcall	delay
         ;;;;;;;	sbi	portb,ss
         ;	rcall	delay
         ;	cbi	portb,ss
         ;	rcall	delay
         ;	sbi	portb,ss
000c5a 9508      	ret
         	
         	
         	
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	delay_us
         ;*
         ;* DESCRIPTION
         ;*t
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          delay_us:
000c5b 0000      	nop
000c5c 0000      	nop
000c5d 0000      	nop
000c5e 0000      	nop
000c5f 0000      	nop
000c60 0000      	nop
000c61 0000      	nop
000c62 0000      	nop
000c63 0000      	nop
000c64 0000      	nop
000c65 0000      	nop
000c66 0000      	nop
000c67 0000      	nop
000c68 0000      	nop
000c69 0000      	nop
000c6a 0000      	nop
000c6b 0000      	nop
000c6c 0000      	nop
000c6d 0000      	nop
000c6e 0000      	nop
000c6f 0000      	nop
000c70 0000      	nop
000c71 0000      	nop
000c72 0000      	nop
000c73 0000      	nop
000c74 9508      ret	
         
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	delay_100us
         ;*
         ;* DESCRIPTION
         ;*t
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          delay_100us:
000c75 933f      	push	temp1
         		
000c76 e139      	ldi	temp1,0x19	
000c77 9330 01d8 	sts	DelayV,temp1
000c79 e033      	ldi	temp1,0x03
000c7a 9330 01d9 	sts	DelayV+1,temp1
000c7c e031      	ldi	temp1,0x01
000c7d 9330 01da 	sts	DelayV+2,temp1
         	
000c7f da4c      	rcall	delay
         	
000c80 913f      	pop	temp1
000c81 9508      ret
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	OneWireReset
         ;*
         ;* DESCRIPTION
         ;*t
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          OneWireReset:
000c82 e230      	ldi	temp1,0x20	
000c83 9330 01d8 	sts	DelayV,temp1
000c85 e133      	ldi	temp1,0x13
000c86 9330 01d9 	sts	DelayV+1,temp1
000c88 e031      	ldi	temp1,0x01
000c89 9330 01da 	sts	DelayV+2,temp1
000c8b 9ad4      	sbi	ddra,4
000c8c 98dc      	cbi	porta,4
000c8d da3e      	rcall	delay
         	
         
         
000c8e 9adc      	sbi	porta,4			
          master_relaxed:				
000c8f 9bcc      	sbis	pina,4			
000c90 cffe      	rjmp	master_relaxed		
          slave_pulse_start:			
000c91 99cc      	sbic	pina,4			
000c92 cffe      	rjmp	slave_pulse_start  		
          slave_relaxed:				
000c93 9bcc      	sbis	pina,4			
000c94 cffe      	rjmp	slave_relaxed		
000c95 da36      	rcall	delay			
         
000c96 9508      	ret
         	
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	OneWireWrite
         ;*
         ;* DESCRIPTION
         ;*t
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          OneWireWrite:
000c97 e139      	ldi	temp1,0x19	
000c98 9330 01d8 	sts	DelayV,temp1
000c9a e033      	ldi	temp1,0x03
000c9b 9330 01d9 	sts	DelayV+1,temp1	
000c9d e031      	ldi	temp1,0x01	
000c9e 9330 01da 	sts	DelayV+2,temp1
000ca0 9ad4      	sbi	ddra,4	
         
000ca1 e048             	ldi	temp0,8		
         
         
          OneWireWrite_loop:
000ca2 9526      	lsr	tempchar	;	lsr		;move 0 into D0, all other bits 
         	
         
000ca3 f428      	brcc	lo_wwdata
000ca4 98dc      	cbi	porta,4
000ca5 dfb5      	rcall	delay_us
000ca6 9adc      	sbi	porta,4		;wwdata_hi
000ca7 da24      	rcall delay		
         
000ca8 c004      	rjmp	wwdata_done	
          lo_wwdata:
000ca9 98dc      	cbi	porta,4		;wwdata_lo
000caa da21      	rcall	delay
000cab 9adc      	sbi	porta,4
000cac dfae      	rcall	delay_us
         
         		
          wwdata_done:
000cad 954a      	dec	temp0
000cae f799      	brne	OneWireWrite_loop
000caf 9508      	ret
         	
         	
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	OneWireRead
         ;*
         ;* DESCRIPTION
         ;*
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          OneWireRead:
         
000cb0 2722      	clr	tempchar
         
000cb1 e048             	ldi	temp0,8		
         
         
          OneWireRead_loop:
000cb2 9ad4      	sbi	ddra,4
000cb3 98dc      	cbi	porta,4
000cb4 dfa6      	rcall	delay_us
000cb5 98d4      	cbi	ddra,4		
000cb6 98dc      	cbi	porta,4
000cb7 dfa3      	rcall	delay_us
000cb8 dfa2      	rcall	delay_us	
000cb9 dfa1      	rcall	delay_us
000cba 9488      	clc
000cbb 9bcc      	sbis	pina,4
000cbc c001      	rjmp	OneWireReadDataDone
000cbd 9408      	sec
         
          OneWireReadDataDone:
000cbe 9527      	ror	tempchar
000cbf dfb5      	rcall	delay_100us	
000cc0 954a      	dec	temp0
000cc1 f781      	brne	OneWireRead_loop
000cc2 9508      	ret		
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	GetDs64BitCode
         ;*
         ;* DESCRIPTION
         ;*t
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          GetDs64BitCode:
000cc3 dfbe      		rcall	OneWireReset
000cc4 e323      		ldi	tempchar,0x33
000cc5 dfd1      		rcall	OneWireWrite
         		
000cc6 dfe9      		rcall	OneWireRead
000cc7 2f52      		mov	u_data,tempchar
         		
000cc8 d45f      		rcall	putc
         
000cc9 dfe6      		rcall	OneWireRead
000cca 2f52      		mov	u_data,tempchar
000ccb d45c      		rcall	putc
000ccc dfe3      		rcall	OneWireRead
000ccd 2f52      		mov	u_data,tempchar
         		
000cce d459      		rcall	putc
         
000ccf dfe0      		rcall	OneWireRead
000cd0 2f52      		mov	u_data,tempchar
000cd1 d456      		rcall	putc
000cd2 dfdd      		rcall	OneWireRead
000cd3 2f52      		mov	u_data,tempchar
         		
000cd4 d453      		rcall	putc
         
000cd5 dfda      		rcall	OneWireRead
000cd6 2f52      		mov	u_data,tempchar
000cd7 d450      		rcall	putc
000cd8 dfd7      		rcall	OneWireRead
000cd9 2f52      		mov	u_data,tempchar
         		
000cda d44d      		rcall	putc
         
000cdb dfd4      		rcall	OneWireRead
000cdc 2f52      		mov	u_data,tempchar
000cdd d44a      		rcall	putc
000cde e02d      		ldi	tempchar,13
000cdf 2f52      		mov	u_data,tempchar
000ce0 d447      		rcall	putc
000ce1 9508      		ret
         
         
         	
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	ReadDs18s20
         ;*
         ;* DESCRIPTION
         ;*t
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          ReadDs18s20:	
000ce2 edab      		ldi	xl,low(phoneno)
000ce3 e0b1      		ldi	xh,high(phoneno)
         		
000ce4 95c8      		lpm				;Load byte from program memory into r0		
000ce5 920d      		st	x+,r0
000ce6 9631      		adiw	zl,1			;increase z
000ce7 95c8      		lpm
000ce8 920d      		st	x+,r0
000ce9 9631      		adiw	zl,1			;increase z
000cea 95c8      		lpm	
000ceb 920d      		st	x+,r0
000cec 9631      		adiw	zl,1			;increase z
000ced 95c8      		lpm	
000cee 920d      		st	x+,r0
000cef 9631      		adiw	zl,1			;increase z
000cf0 95c8      		lpm	
000cf1 920d      		st	x+,r0
000cf2 9631      		adiw	zl,1			;increase z
000cf3 95c8      		lpm	
000cf4 920d      		st	x+,r0
000cf5 9631      		adiw	zl,1			;increase z
000cf6 95c8      		lpm	
000cf7 920d      		st	x+,r0
000cf8 9631      		adiw	zl,1			;increase z
000cf9 95c8      		lpm	
000cfa 920d      		st	x+,r0
000cfb 9631      		adiw	zl,1			;increase z
000cfc 95c8      		lpm	
000cfd 920d      		st	x+,r0
         		
000cfe edab      		ldi	xl,low(phoneno)
000cff e0b1      		ldi	xh,high(phoneno)
         		
         		
000d00 93af      		push	xl
000d01 93bf      		push	xh
000d02 df7f      		rcall	OneWireReset
         ;		ldi	tempchar,0xcc	;0xcc,0x33
         ;		rcall	OneWireWrite
         ;		ldi	tempchar,0x44	;0x44
         ;		rcall	OneWireWrite
         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
         
000d03 e049      		ldi	temp0,9	;13
          ReadDs18s20_loop0:		
000d04 934f      		push	temp0
000d05 912d      		ld	tempchar,x+
000d06 df90      		rcall	OneWireWrite
000d07 914f      		pop	temp0
000d08 954a      		dec	temp0
000d09 f7d1      		brne	ReadDs18s20_loop0
         		
000d0a e424      		ldi	tempchar,0x44	
000d0b df8b      		rcall	OneWireWrite
         
         
         
         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;		
         		
         		
         		
         		
         		
          ReadDs18s20_loop:
000d0c dfa3      		rcall	OneWireRead
000d0d 2322      		tst	tempchar
000d0e f3e9      		breq	ReadDs18s20_loop
         				
000d0f df72      		rcall	OneWireReset
         	
         
         	;	ldi	tempchar,0xcc		
         	;	rcall	OneWireWrite
         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
000d10 91bf      		pop	xh
000d11 91af      		pop	xl
         	;	ldi	xl,low(phoneno)
         	;	ldi	xh,high(phoneno)
         		
000d12 e049      		ldi	temp0,9	;13
          ReadDs18s20_loop1:		
000d13 934f      		push	temp0
000d14 912d      		ld	tempchar,x+
000d15 df81      		rcall	OneWireWrite
000d16 914f      		pop	temp0
000d17 954a      		dec	temp0
000d18 f7d1      		brne	ReadDs18s20_loop1
         		
         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;		
         		
         		
000d19 eb2e      		ldi	tempchar,0xbe
000d1a df7c      		rcall	OneWireWrite
         
000d1b df94      		rcall	OneWireRead
000d1c 9488      		clc
000d1d 9527      		ror	tempchar
000d1e 932f      		push	tempchar
000d1f 2f52      		mov	u_data,tempchar
         	
         		;;;;;;;;rcall	putc
         		
000d20 df8f      		rcall	OneWireRead
000d21 2f52      		mov	u_data,tempchar
         		
         		;:::rcall	putc
         		
000d22 912f      		pop	tempchar
         
000d23 9508      ret		
         	;	rcall	OneWireRead
         	;	mov	u_data,tempchar
         		
         	;	rcall	putc
         
         	;	rcall	OneWireRead
         	;	mov	u_data,tempchar
         	;	rcall	putc
         
         	;	rcall	OneWireRead
         	;	mov	u_data,tempchar
         	;	rcall	putc
         
         	;	rcall	OneWireRead
         	;	mov	u_data,tempchar
         	;	rcall	putc
         
         	;	rcall	OneWireRead
         	;	mov	u_data,tempchar
         	;	rcall	putc
         
         	;	rcall	OneWireRead
         	;	mov	u_data,tempchar
         	;	rcall	putc
         		
         ;ret
         ;		rcall	OneWireRead
         ;		mov	u_data,tempchar
         ;		rcall	putc
         	;	rcall	OneWireRead
         	;	mov	u_data,tempchar
         	;	rcall	putc
         ;ret
         
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	Ds2406
         ;*
         ;* DESCRIPTION
         ;*t
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          Ds2406:	
000d24 df5d      		rcall	OneWireReset
000d25 ec2c      		ldi	tempchar,0xcc	;0x33
000d26 df70      		rcall	OneWireWrite
000d27 e525      		ldi	tempchar,0x55	;0x44
000d28 df6e      		rcall	OneWireWrite
         		
000d29 e027      		ldi	tempchar,0x07	;test
000d2a df6c      		rcall	OneWireWrite
000d2b e020      		ldi	tempchar,0x00	;test
000d2c df6a      		rcall	OneWireWrite
000d2d e02e      		ldi	tempchar,0x0e	;0x3f	;test
000d2e df68      		rcall	OneWireWrite
         		
000d2f df80      		rcall	OneWireRead
000d30 2f52      		mov	u_data,tempchar
         		
000d31 d3f6      		rcall	putc
         
000d32 df7d      		rcall	OneWireRead
000d33 2f52      		mov	u_data,tempchar
000d34 d3f3      		rcall	putc
         		
         		
000d35 9508      		ret
         		
         		
          Ds2406_loop:
         	;	rcall	OneWireRead
         	;	tst	tempchar
         	;	breq	Ds2406_loop	
         	
         	;	rcall	OneWireReset
         	;	ldi	tempchar,0xcc		
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0xbe
         	;	rcall	OneWireWrite
         
         	;	rcall	OneWireRead
         	;	clc
         	;	ror	tempchar
         	;	push	tempchar
         	;	mov	u_data,tempchar
         	
         	;	rcall	putc
         		
         	;	rcall	OneWireRead
         	;	mov	u_data,tempchar
         		
         	;	rcall	putc
         		
         	;	pop	tempchar
         
         ;ret		
000d36 df79      		rcall	OneWireRead
000d37 2f52      		mov	u_data,tempchar
         		
000d38 d3ef      		rcall	putc
         
000d39 df76      		rcall	OneWireRead
000d3a 2f52      		mov	u_data,tempchar
000d3b d3ec      		rcall	putc
         
000d3c df73      		rcall	OneWireRead
000d3d 2f52      		mov	u_data,tempchar
000d3e d3e9      		rcall	putc
         
000d3f df70      		rcall	OneWireRead
000d40 2f52      		mov	u_data,tempchar
000d41 d3e6      		rcall	putc
         
000d42 df6d      		rcall	OneWireRead
000d43 2f52      		mov	u_data,tempchar
000d44 d3e3      		rcall	putc
         
000d45 df6a      		rcall	OneWireRead
000d46 2f52      		mov	u_data,tempchar
000d47 d3e0      		rcall	putc
         		
         ;ret
000d48 df67      		rcall	OneWireRead
000d49 2f52      		mov	u_data,tempchar
000d4a d3dd      		rcall	putc
000d4b df64      		rcall	OneWireRead
000d4c 2f52      		mov	u_data,tempchar
000d4d d3da      		rcall	putc
000d4e 9508      ret
         
         
         
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	Ds2406_pioaON
         ;*
         ;* DESCRIPTION
         ;*t
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          Ds2406_pioaON:	
000d4f df32      		rcall	OneWireReset
         		
000d50 e04d      		ldi	temp0,13	
         		;ldi	tempchar,0xcc	;
         		;rcall	OneWireWrite
         	;	ldi	tempchar,0x55	;
         	;	rcall	OneWireWrite
         		
         		
         		
         	;	ldi	tempchar,0x12	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0xa0	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0x1f	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0x73	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0x00	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0x00	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0x00	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0xee	;
         	;	rcall	OneWireWrite
         		
         		
         	;	ldi	xl,low(phoneno)
         	;	ldi	xh,high(phoneno)	
          Ds_loop:		
000d51 934f      		push	temp0
000d52 912d      		ld	tempchar,x+
000d53 df43      		rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite	
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         
         
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         
         
         	
         		
         ;		ldi	tempchar,0x55	;
         ;		rcall	OneWireWrite
         		
         ;		ldi	tempchar,0x07	;
         ;		rcall	OneWireWrite
         ;		ldi	tempchar,0x00	;
         ;		rcall	OneWireWrite
         ;		ldi	tempchar,0x0e	;
         ;		rcall	OneWireWrite
000d54 914f      		pop	temp0
000d55 954a      		dec	temp0
000d56 f7d1      		brne	Ds_loop
000d57 df58      		rcall	OneWireRead
000d58 2f52      		mov	u_data,tempchar
         		
000d59 d3ce      		rcall	putc
         
000d5a df55      		rcall	OneWireRead
000d5b 2f52      		mov	u_data,tempchar
000d5c d3cb      		rcall	putc
         		
         		
000d5d 9508      		ret			
         		
         		
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	Ds2406_pioaOFF
         ;*
         ;* DESCRIPTION
         ;*
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          Ds2406_pioaOFF:	
000d5e df23      		rcall	OneWireReset
000d5f ec2c      		ldi	tempchar,0xcc	;
000d60 df36      		rcall	OneWireWrite
000d61 e525      		ldi	tempchar,0x55	;
000d62 df34      		rcall	OneWireWrite
         		
000d63 e027      		ldi	tempchar,0x07	;
000d64 df32      		rcall	OneWireWrite
000d65 e020      		ldi	tempchar,0x00	;
000d66 df30      		rcall	OneWireWrite
000d67 e62d      		ldi	tempchar,0x6d	;
000d68 df2e      		rcall	OneWireWrite
         		
000d69 df46      		rcall	OneWireRead
000d6a 2f52      		mov	u_data,tempchar
         		
000d6b d3bc      		rcall	putc
         
000d6c df43      		rcall	OneWireRead
000d6d 2f52      		mov	u_data,tempchar
000d6e d3b9      		rcall	putc
         		
         		
000d6f 9508      		ret	
         		
         		
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	Ds2406_Status
         ;*
         ;* DESCRIPTION
         ;*t
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          Ds2406_Status:	
000d70 edab      		ldi	xl,low(phoneno)
000d71 e0b1      		ldi	xh,high(phoneno)
         		
000d72 95c8      		lpm				;Load byte from program memory into r0		
000d73 920d      		st	x+,r0
000d74 9631      		adiw	zl,1			;increase z
000d75 95c8      		lpm
000d76 920d      		st	x+,r0
000d77 9631      		adiw	zl,1			;increase z
000d78 95c8      		lpm	
000d79 920d      		st	x+,r0
000d7a 9631      		adiw	zl,1			;increase z
000d7b 95c8      		lpm	
000d7c 920d      		st	x+,r0
000d7d 9631      		adiw	zl,1			;increase z
000d7e 95c8      		lpm	
000d7f 920d      		st	x+,r0
000d80 9631      		adiw	zl,1			;increase z
000d81 95c8      		lpm	
000d82 920d      		st	x+,r0
000d83 9631      		adiw	zl,1			;increase z
000d84 95c8      		lpm	
000d85 920d      		st	x+,r0
000d86 9631      		adiw	zl,1			;increase z
000d87 95c8      		lpm	
000d88 920d      		st	x+,r0
000d89 9631      		adiw	zl,1			;increase z
000d8a 95c8      		lpm	
000d8b 920d      		st	x+,r0
000d8c 9631      		adiw	zl,1			;increase z
000d8d 95c8      		lpm	
000d8e 920d      		st	x+,r0
000d8f 9631      		adiw	zl,1			;increase z
000d90 95c8      		lpm	
000d91 920d      		st	x+,r0
         		
         		
000d92 edab      		ldi	xl,low(phoneno)
000d93 e0b1      		ldi	xh,high(phoneno)
         		
000d94 deed      		rcall	OneWireReset
         		
000d95 e04b      		ldi	temp0,11 ;12;13	
         		;ldi	tempchar,0xcc	;
         		;rcall	OneWireWrite
         	;	ldi	tempchar,0x55	;
         	;	rcall	OneWireWrite
         		
         		
         		
         	;	ldi	tempchar,0x12	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0xa0	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0x1f	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0x73	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0x00	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0x00	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0x00	;
         	;	rcall	OneWireWrite
         	;	ldi	tempchar,0xee	;
         	;	rcall	OneWireWrite
         		
         		
         	;	ldi	xl,low(phoneno)
         	;	ldi	xh,high(phoneno)	
          DsStatus_loop:		
000d96 934f      		push	temp0
000d97 912d      		ld	tempchar,x+
000d98 defe      		rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite	
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         
         
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         	;	ld	tempchar,x+
         	;	rcall	OneWireWrite
         
         
         	
         		
         ;		ldi	tempchar,0x55	;
         ;		rcall	OneWireWrite
         		
         ;		ldi	tempchar,0x07	;
         ;		rcall	OneWireWrite
         ;		ldi	tempchar,0x00	;
         ;		rcall	OneWireWrite
         ;		ldi	tempchar,0x0e	;
         ;		rcall	OneWireWrite
000d99 914f      		pop	temp0
000d9a 954a      		dec	temp0
000d9b f7d1      		brne	DsStatus_loop
         		
         	
         		
000d9c df13      		rcall	OneWireRead
         ;		mov	u_data,tempchar
         		
         ;		rcall	putc
         
000d9d df12      		rcall	OneWireRead
         		;mov	temp1,tempchar
         		;mov	u_data,tempchar
         		;rcall	putc
         ;		rcall	OneWireRead
         ;		mov	u_data,tempchar
         		
         ;		rcall	putc
         
         ;		rcall	OneWireRead
         ;		mov	u_data,tempchar
         ;		rcall	putc
         		
         		
         	
         	;	rcall	OneWireRead
         ;		ldi	tempchar,0x0d
         ;		mov	u_data,tempchar
         		
         ;		rcall	putc
         
         	;	rcall	OneWireRead
         	;	mov	u_data,tempchar
         	;	rcall	putc
         	;	rcall	OneWireRead
         	;	mov	u_data,tempchar
         		
         	;	rcall	putc
         
         	;	rcall	OneWireRead
         	;	mov	u_data,tempchar
         	;	rcall	putc
000d9e 9508      		ret		
         		
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	PumpOnOff
         ;*
         ;* DESCRIPTION
         ;*t
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          PumpOnOff:
         
000d9f e1e8      		ldi 	zl,low(pumpflag)		;Load strinpointer
000da0 e0f0      		ldi 	zh,high(pumpflag)
000da1 dc2d      		rcall	EERead	
000da2 ff20      		sbrs	tempchar,0			;Skip if bit0 is set
000da3 c00c      		rjmp	PumpOnOff_00
         ;-------------------PumpOff----------------------------------------------------
000da4 e020      		ldi	tempchar,0
000da5 e1e8      		ldi 	zl,low(pumpflag)		;Load strinpointer
000da6 e0f0      		ldi 	zh,high(pumpflag)
000da7 dc17      		rcall	EEWrite	
000da8 d947      		rcall	LongDelay	
000da9 e45f      		ldi	u_data,'O'
000daa d37d      		rcall	Putc
000dab e656      		ldi	u_data,'f'
000dac d37b      		rcall	Putc
000dad e656      		ldi	u_data,'f'
000dae d379      		rcall	Putc
         
000daf c00a      		rjmp	PumpOnOff_Exit	
         ;-------------------PumpOn------------------------------------------------------
          PumpOnOff_00:
000db0 e1e8      		ldi 	zl,low(pumpflag)		;Load strinpointer
000db1 e0f0      		ldi 	zh,high(pumpflag)
000db2 e021      		ldi	tempchar,1
000db3 dc0b      		rcall	EEWrite	
000db4 d93b      		rcall	LongDelay
000db5 e45f      		ldi	u_data,'O'
000db6 d371      		rcall	Putc
000db7 e65e      		ldi	u_data,'n'
000db8 d36f      		rcall	Putc
000db9 c000      		rjmp	PumpOnOff_Exit	
         	
         	
          PumpOnOff_Exit:	
         
000dba 2744      		clr	temp0			 
000dbb 9340 01f9 		sts	Count,temp0		;clear time counter
000dbd 9340 0150 		sts	TempBuf,temp0
000dbf d35c      		rcall	timer1_init
         
000dc0 9508      	ret
         
         ;***************************************************************************
         ;*
         ;* FUNCTION
         ;*	SetRefTemp
         ;*
         ;* DESCRIPTION
         ;*t
         ;*
         ;* USAGE
         ;*	Call this function 
         ;*	
         ;*
         ;*   PARAMETER	
         ;*	
         ;*	
         ;*	
         ;*	
         ;*		
         ;*		
         ;*			
         ;*		
         ;*			
         ;*	
         ;*		
         ;* RETURN
         ;*
         ;*
         ;* NOTE
         ;*	
         ;*
         ;*
         ;* COMMENT
         ;*	
         ;*
         ;***************************************************************************
         
          SetRefTemp:
000dc1 ef2f      	ldi	tempchar,0xff
000dc2 9320 01d8 	sts	DelayV,tempchar
000dc4 ef2f      	ldi	tempchar,0xff
000dc5 9320 01d9 	sts	DelayV+1,tempchar
000dc7 e024      	ldi	tempchar,0x4
000dc8 9320 01da 	sts	DelayV+2,tempchar
000dca d901      	rcall	delay
000dcb ef5e      	ldi	u_data,254
000dcc d35b      	rcall	putc
000dcd e558      	ldi	u_data,88
000dce d359      	rcall	putc
000dcf e552      	ldi	u_data,'R'
000dd0 d357      	rcall	putc
000dd1 e655      	ldi	u_data,'e'
000dd2 d355      	rcall	putc
000dd3 e656      	ldi	u_data,'f'
000dd4 d353      	rcall	putc
000dd5 e35a      	ldi	u_data,':'
000dd6 d351      	rcall	putc
000dd7 9120 0205 	lds 	tempchar,RefTemp
000dd9 9523      	inc	tempchar
000dda 3229      	cpi	tempchar,41	
000ddb f008      	brlo	SetRefTemp_0
000ddc e02a      	ldi	tempchar,10
         	
         	
         	
          SetRefTemp_0:
000ddd 9320 0205 	sts	RefTemp,tempchar
         	
000ddf e541      	ldi	temp0,81;17;49	
000de0 ddf4      	rcall	printff	
         	
000de1 2744      	clr	temp0			 
000de2 9340 01f9 	sts	Count,temp0		;clear time counter
000de4 9340 0150 	sts	TempBuf,temp0
000de6 d335      	rcall	timer1_init
         	
000de7 9508      	ret
         
         	
         ;----------------------------------------------------------------------------------		
         ;iotest:
         ;		ldi	u_data,65
         ;		rcall	putc	
         ;		clr	temp0			 
         ;		sts	Count,temp0		;clear time counter
         ;		sts	TempBuf,temp0
         ;		rcall	timer1_init
         ;	ret							
         ;-------------------------------------------------------------------------------------------
         
         
         
         
         
         
         
000de8      Clock:	  	.db "clock",0
000de8 6c63
000de9 636f
000dea 006b
000deb      ClearAC:  	.db "ClearAC",0
000deb 6c43
000dec 6165
000ded 4172
000dee 0043
000def      ReadCC:   	.db "ReadCC",0
000def 6552
000df0 6461
000df1 4343
000df2 0000
000df3      ClearCC: 	.db "ClearCC",0
000df3 6c43
000df4 6165
000df5 4372
000df6 0043
000df7      TrimBits: 	.db "TrimBits",0
000df7 7254
000df8 6d69
000df9 6942
000dfa 7374
000dfb 0000
000dfc      Ver:      	.db "ver",0
000dfc 6576
000dfd 0072
         ;eeprom:		.db "eeprom",0
000dfe      eeprom:		.db "test",0
000dfe 6574
000dff 7473
000e00 0000
000e01      SUART:	  	.db "send=",0 ;su=
000e01 6573
000e02 646e
000e03 003d
         ;sendhex:	.db "sendhex=",0
000e04      baud:		.db "baud=",0
000e04 6162
000e05 6475
000e06 003d
000e07      modeno:   	.db "mo=",0 ;#m=
000e07 6f6d
000e08 003d
000e09      getsubuf: 	.db "#getsubuf",0
000e09 6723
000e0a 7465
000e0b 7573
000e0c 7562
000e0d 0066
000e0e      OK:       	.db "OK",13,0
000e0e 4b4f
000e0f 000d
000e10      Error:    	.db "ERROR",0
000e10 5245
000e11 4f52
000e12 0052
000e13      cpiready: 	.db "+CPIN: READY",0 
000e13 432b
000e14 4950
000e15 3a4e
000e16 5220
000e17 4145
000e18 5944
000e19 0000
000e1a      cmti:	  	.db "+CMTI: ",34,"SM",34,",",0
000e1a 432b
000e1b 544d
000e1c 3a49
000e1d 2220
000e1e 4d53
000e1f 2c22
000e20 0000
000e21      cmti2:		.db "+CMTI: ",34,"SM",34,",2",0
000e21 432b
000e22 544d
000e23 3a49
000e24 2220
000e25 4d53
000e26 2c22
000e27 0032
         ;cmgl1:    	.db "+CMGL: 1",0
000e28      cmgl1:    	.db "+CMGL: ",0
000e28 432b
000e29 474d
000e2a 3a4c
000e2b 0020
000e2c      cmgr:		.db "+CMGR:",0
000e2c 432b
000e2d 474d
000e2e 3a52
000e2f 0000
000e30      unread:	  	.db "UNREAD",34,",",34,"+",0	
000e30 4e55
000e31 4552
000e32 4441
000e33 2c22
000e34 2b22
000e35 0000
000e36      comma2:   	.db 34,",,",34,0
000e36 2c22
000e37 222c
000e38 0000
000e39      nocarrier:	.db "NO CARRIER",0
000e39 4f4e
000e3a 4320
000e3b 5241
000e3c 4952
000e3d 5245
000e3e 0000
000e3f      ring:		.db "RING",0
000e3f 4952
000e40 474e
000e41 0000
000e42      connect:	.db "CONNECT",0
000e42 4f43
000e43 4e4e
000e44 4345
000e45 0054
000e46      lamptime:	.db "lampt",0
000e46 616c
000e47 706d
000e48 0074
         ;absent:	.db "absent=",0
000e49      sspi:		.db "sspi=",0
000e49 7373
000e4a 6970
000e4b 003d
000e4c      stxetx:		.db "stxetx=",0
000e4c 7473
000e4d 6578
000e4e 7874
000e4f 003d
000e50      stxetx0:	.db "stxetx0=",0
000e50 7473
000e51 6578
000e52 7874
000e53 3d30
000e54 0000
000e55      ack:		.db 13
000e55 000d
000e56      poll:		.db "poll",0
000e56 6f70
000e57 6c6c
000e58 0000
000e59      settargetpno:	.db "SetTargetPno=",0
000e59 6553
000e5a 5474
000e5b 7261
000e5c 6567
000e5d 5074
000e5e 6f6e
000e5f 003d
000e60      setpasspno:	.db "SetPassPno=",0
000e60 6553
000e61 5074
000e62 7361
000e63 5073
000e64 6f6e
000e65 003d
000e66      setcustomerno:	.db "SetCustomerNo=",0	
000e66 6553
000e67 4374
000e68 7375
000e69 6f74
000e6a 656d
000e6b 4e72
000e6c 3d6f
000e6d 0000
000e6e      settempref:	.db "SetTempRef=",0
000e6e 6553
000e6f 5474
000e70 6d65
000e71 5270
000e72 6665
000e73 003d
         ;---------------Text--------------------------------------------------------------------
000e74      Text:	  	.db "Copyright (c) 2004 Jarl&Jarmo",13,0
000e74 6f43
000e75 7970
000e76 6972
000e77 6867
000e78 2074
000e79 6328
000e7a 2029
000e7b 3032
000e7c 3430
000e7d 4a20
000e7e 7261
000e7f 266c
000e80 614a
000e81 6d72
000e82 0d6f
000e83 0000
         ;Text:	  	.db "20081021",13,0
         ;Text:	  	.db "Billingehus Version 1.00",13,0
         ;Text:	  	.db "Hjortviken Version 1.00",13,0
         ;Text:	  	.db "Lundsbrunn Version 1.00",13,0
         ;Text:	  	.db "Smgen Version 1.00",13,0
         ;Text:	  	.db "SAS Radison Version 1.00",13,0
         ;Text:	  	.db "Chalmers Version 1.1",13,0
000e84      Text1:	  	.db " H   ",0
000e84 4820
000e85 2020
000e86 0020
000e87      Text2:	  	.db " L",13,0
000e87 4c20
000e88 000d
         
         ;----------------At Commands-----------------------------------------------------------
000e89      ate0:     	.db "ate0",13,0	 
000e89 7461
000e8a 3065
000e8b 000d
000e8c      atcicb:   	.db "at+cicb=0",13,0
000e8c 7461
000e8d 632b
000e8e 6369
000e8f 3d62
000e90 0d30
000e91 0000
         ;atcpin:   	.db "at+cpin=",34,"2978",34,13,0
         ;atcsca:	.db "at+csca=",34,"46705008999",34,13,0		;Sms-central Telia
000e92      atcpin:   	.db "at+cpin=",34,"1200",34,13,0
000e92 7461
000e93 632b
000e94 6970
000e95 3d6e
000e96 3122
000e97 3032
000e98 2230
000e99 000d
000e9a      atcpinask:	.db "at+cpin?",13,0
000e9a 7461
000e9b 632b
000e9c 6970
000e9d 3f6e
000e9e 000d
000e9f      atcsca:		.db "at+csca=",34,"+46708000708",34,13,0	;Sms-central Vodafon
000e9f 7461
000ea0 632b
000ea1 6373
000ea2 3d61
000ea3 2b22
000ea4 3634
000ea5 3037
000ea6 3038
000ea7 3030
000ea8 3037
000ea9 2238
000eaa 000d
000eab      atcmgs:		.db "at+cmgs=",34,0
000eab 7461
000eac 632b
000ead 676d
000eae 3d73
000eaf 0022
000eb0      ats01:	  	.db "ats0=2",13,0				;Automatic answer after 2 rings
000eb0 7461
000eb1 3073
000eb2 323d
000eb3 000d
000eb4      ats00:		.db "ats0=0",13,0				;No Automatic answer
000eb4 7461
000eb5 3073
000eb6 303d
000eb7 000d
000eb8      atcmgd:   	.db "at+cmgd=1,4",13,0
000eb8 7461
000eb9 632b
000eba 676d
000ebb 3d64
000ebc 2c31
000ebd 0d34
000ebe 0000
000ebf      atcmgd0:	.db "at+cmgd=1,2",13,0				;1,3
000ebf 7461
000ec0 632b
000ec1 676d
000ec2 3d64
000ec3 2c31
000ec4 0d32
000ec5 0000
000ec6      atcpina:  	.db "at+cpin?",13,0
000ec6 7461
000ec7 632b
000ec8 6970
000ec9 3f6e
000eca 000d
000ecb      atcmgf1:	.db "at+cmgf=1",13,0
000ecb 7461
000ecc 632b
000ecd 676d
000ece 3d66
000ecf 0d31
000ed0 0000
000ed1      atcmgl:	  	.db "at+cmgl=",34,"ALL",34,13,0	
000ed1 7461
000ed2 632b
000ed3 676d
000ed4 3d6c
000ed5 4122
000ed6 4c4c
000ed7 0d22
000ed8 0000
000ed9      atcmgr1:	.db "at+cmgr=1",13,0
000ed9 7461
000eda 632b
000edb 676d
000edc 3d72
000edd 0d31
000ede 0000
000edf      atcmgr2:	.db "at+cmgr=2",13,0
000edf 7461
000ee0 632b
000ee1 676d
000ee2 3d72
000ee3 0d32
000ee4 0000
000ee5      atcmgr3:	.db "at+cmgr=3",13,0
000ee5 7461
000ee6 632b
000ee7 676d
000ee8 3d72
000ee9 0d33
000eea 0000
000eeb      atcmgr4:	.db "at+cmgr=4",13,0
000eeb 7461
000eec 632b
000eed 676d
000eee 3d72
000eef 0d34
000ef0 0000
000ef1      atcmgr5:	.db "at+cmgr=5",13,0
000ef1 7461
000ef2 632b
000ef3 676d
000ef4 3d72
000ef5 0d35
000ef6 0000
000ef7      atcmgr:		.db "at+cmgr=",0
000ef7 7461
000ef8 632b
000ef9 676d
000efa 3d72
000efb 0000
000efc      atcpof:		.db "at+cpof",13,0
000efc 7461
000efd 632b
000efe 6f70
000eff 0d66
000f00 0000
000f01      cpinready:	.db "+CPIN: READY",13,10,0
000f01 432b
000f02 4950
000f03 3a4e
000f04 5220
000f05 4145
000f06 5944
000f07 0a0d
000f08 0000
         ;----------------SHARP Cammands----------------------------------------------------------------
000f09      err:		.db "ERR",13,0					;Error code
000f09 5245
000f0a 0d52
000f0b 0000
000f0c      tlps:		.db "TLPS   1",13,0				;Get LampStatus
000f0c 4c54
000f0d 5350
000f0e 2020
000f0f 3120
000f10 000d
000f11      tltt:		.db "TLTT   1",13,0				;Get usetime
000f11 4c54
000f12 5454
000f13 2020
000f14 3120
000f15 000d
000f16      powr1:		.db "POWR   1",13,0				;Power on
000f16 4f50
000f17 5257
000f18 2020
000f19 3120
000f1a 000d
000f1b      powr0:		.db "POWR   0",13,0				;Power off
000f1b 4f50
000f1c 5257
000f1d 2020
000f1e 3020
000f1f 000d
000f20      rgb1:		.db "IRGB   1",13,0				;RGB1
000f20 5249
000f21 4247
000f22 2020
000f23 3120
000f24 000d
000f25      rgb2:		.db "IRGB   2",13,0				;RGB2
000f25 5249
000f26 4247
000f27 2020
000f28 3220
000f29 000d
000f2a      video:		.db "IVED   1",13,0				;Video
000f2a 5649
000f2b 4445
000f2c 2020
000f2d 3120
000f2e 000d
000f2f      svideo:		.db "IVED   2",13,0				;S-Video
000f2f 5649
000f30 4445
000f31 2020
000f32 3220
000f33 000d
000f34      muteOn:		.db "IMBK   1",13,0				;Mute on
000f34 4d49
000f35 4b42
000f36 2020
000f37 3120
000f38 000d
000f39      muteOff:	.db "IMBK   0",13,0				;Mute off
000f39 4d49
000f3a 4b42
000f3b 2020
000f3c 3020
000f3d 000d
000f3e      getived:	.db "IVED????",13,0				;Get input source (3,4)
000f3e 5649
000f3f 4445
000f40 3f3f
000f41 3f3f
000f42 000d
000f43      getirgb:	.db "IRGB????",13,0				;Get input source (1,2)
000f43 5249
000f44 4247
000f45 3f3f
000f46 3f3f
000f47 000d
000f48      volume:		.db "VOLA  ",0					;Volume 0-60
000f48 4f56
000f49 414c
000f4a 2020
000f4b 0000
000f4c      ichk:		.db "ICHK????",13,0				;Get input source
000f4c 4349
000f4d 4b48
000f4e 3f3f
000f4f 3f3f
000f50 000d
         ;---------------TOSHIBA and PANASONIC Commands----------------------------------------------------------------
         ;powon:		.db 02,"PON",03,0				;Power on
         ;powoff:		.db 02,"POF",03,0				;Power off
         ;rgbt:		.db 02,"IN1",03,0				;RGB (Toshiba)
         ;videot:		.db 02,"IN3",03,0				;Video (Toshiba)
         ;panvideo:	.db 02,"IIS:VID",03,0				;Video (Panasonic)
         ;panrg1:		.db 02,"IIS:RG1",03,0				;RG1 (Panasonic)
         ;panGetstatus:	.db 02,"Q$S",03,0				;Get status (Panasonic)
         ;---------------Pioneer Commands-------------------------------------------------------------------------
         ;pon:		.db 02,"01PON",03,0				;Turn power on
         ;pof:		.db 02,"01POF",03,0				;Turn power off
         ;in1:		.db 02,"01IN1",03,0				;Selects Input1-Data
         ;in4:		.db 02,"01IN4",03,0				;Selects Input4-Data
         ;gso:		.db 02,"01GSO",03,0				;Get status opton
         ;gss:		.db 02,"01GSS",03,0				;Get status set up
         ;vol:		.db 02,"01VOL0",0				;Adjusts audio volume 0-60
         ;pwn:		.db "P",0;PWN1
         ;pwn:		.db "PLASMA",0
         ;gssin1:		.db "IN1",0					;Data
         ;gssin4:		.db "IN4",0					;Video		
         ;---------------VievSonic Commands-------------------------------------------------------------------------------
         ;vson:		.db 0xbe,0xef,0x03,0x06,0x00,0xba,0xd2,0x01,0x00,0x00,0x60,0x01,0x00	;Turn on
         ;vsof:		.db 0xbe,0xef,0x03,0x06,0x00,0x2a,0xd3,0x01,0x00,0x00,0x60,0x00,0x00	;Turn off
         ;vsrgb1:		.db 0xbe,0xef,0x03,0x06,0x00,0xfe,0xd2,0x01,0x00,0x00,0x20,0x00,0x00	;Select source RGB IN1
         ;vsrgb2:		.db 0xbe,0xef,0x03,0x06,0x00,0x3e,0xd0,0x01,0x00,0x00,0x20,0x04,0x00	;Select source RGB IN2
         ;vsvideo:	.db 0xbe,0xef,0x03,0x06,0x00,0x6e,0xd3,0x01,0x00,0x00,0x20,0x01,0x00	;Select source VIDEO
         ;vsvolumeinc:	.db 0xbe,0xef,0x03,0x06,0x00,0x57,0xd3,0x04,0x00,0x01,0x20,0x00,0x00	;Icrement volume
         ;vsvolumedec:	.db 0xbe,0xef,0x03,0x06,0x00,0x86,0xd2,0x05,0x00,0x01,0x20,0x00,0x00	;Decrement volume
         ;vsgetOnOff:	.db 0xbe,0xef,0x03,0x06,0x00,0x19,0xd3,0x02,0x00,0x00,0x60,0x00,0x00	;Get On/Off status
         ;vsgetsource:	.db 0xbe,0xef,0x03,0x06,0x00,0xcd,0xd2,0x02,0x00,0x00,0x20,0x00,0x00	;Get source
         ;----------------Barco Commands---------------------------------------------------------------------------
         ;barcoOn:	.db 0xfe,0x01,0x65,0x66,0xff						;Set projector on 
         ;barcoOff:	.db 0xfe,0x01,0x66,0x67,0xff						;Set the projector off
         ;barcoVoldec:	.db 0xfe,0x01,0x23,0x07,0x2b,0xff					;Decrement volume
         ;barcoVolincr:	.db 0xfe,0x01,0x22,0x07,0x2a,0xff					;Increment volume
         ;barcoGetstatus:	.db 0xfe,0x01,0x67,0x68,0xff						;Read the projector status
         ;barcoSetslot2:	.db 0xfe,0x01,0x31,0x02,0x33,0xff					;Select source 2 of projector
         ;barcoSetslot3:	.db 0xfe,0x01,0x31,0x03,0x34,0xff					;Select source 3 of projector
         ;barcoSetslot2:	.db 0xfe,0x01,0x33,0x04,0x01,0x39,0xff					;Select source 2 of projector
         ;barcoSetslot2:	.db 0xfe,0x01,0x33,0x03,0x00,0x37,0xff					;Select source 2 of projector
         ;barcoSetslot3:	.db 0xfe,0x01,0x33,0x01,0x05,0x3a,0xff					;Select source 3 of projector
         ;barcoSetslot3:	.db 0xfe,0x01,0x33,0x02,0x00,0x36,0xff					;Select source 3 of projector
         ;------------------TempSensor Adress-------------------------------------------------
000f51      tempa0:		.db 0x55,0x10,0x84,0xef,0xf2,0x01,0x08,0x00,0xd3
000f51 1055
000f52 ef84
000f53 01f2
000f54 0008
000f55 00d3
000f56      tempa1:		.db 0x55,0x10,0x9a,0x3b,0x15,0x02,0x08,0x00,0xf1
000f56 1055
000f57 3b9a
000f58 0215
000f59 0008
000f5a 00f1
000f5b      tempa2:		.db 0x55,0x10,0x78,0x1b,0x15,0x02,0x08,0x00,0x4e
000f5b 1055
000f5c 1b78
000f5d 0215
000f5e 0008
000f5f 004e
         ;-------------------Button Address---------------------------------------------------
000f60      ButtonIoA:	.db 0x55,0x12,0xd0,0x23,0x73,0x00,0x00,0x00,0xd3,0xf5,0xf2
000f60 1255
000f61 23d0
000f62 0073
000f63 0000
000f64 f5d3
000f65 00f2
000f66      ButtonIoA0:	.db 0x55,0x12,0xa0,0x1f,0x73,0x00,0x00,0x00,0xee,0xf5,0xf2
000f66 1255
000f67 1fa0
000f68 0073
000f69 0000
000f6a f5ee
000f6b 00f2
000f6c      ButtonIoA1:	.db 0x55,0x12,0x2f,0x22,0x73,0x00,0x00,0x00,0x48,0xf5,0xf2
000f6c 1255
000f6d 222f
000f6e 0073
000f6f 0000
000f70 f548
000f71 00f2
         ;---------------Time parameter---------------------------------------------------------------------------
000f72      yearC:		.db 128,51,225,1	;1,225,51,128		;365 days=31536000
000f72 3380
000f73 01e1
000f74      dayC:		.db 128,81,1,0					;86400 sec 
000f74 5180
000f75 0001
000f76      hourC:		.db 16,14,0,0					;3600 sec
000f76 0e10
000f77 0000
000f78      minuteC:	.db 60,0,0,0					;60 sec
000f78 003c
000f79 0000
000f7a      weekC:		.db 7,0,0,0					;7 days=week
000f7a 0007
000f7b 0000
         
000f7c      tempC:		.db 42,0,0,0
000f7c 002a
000f7d 0000
000f7e      tempGC0:	.db 108,0,0,0					;temp graf constant 100
000f7e 006c
000f7f 0000
000f80      tempGC1:	.db 86,0,0,0
000f80 0056
000f81 0000
000f82      tempGC2:	.db 72,0,0,0
000f82 0048
000f83 0000
         
         ;breakPoint0:	.db 192,168,0,0
         ;breakPoint0:	.db 40,135,0,0
000f84      breakPoint0:	.db 192,168,0,0
000f84 a8c0
000f85 0000
000f86      breakPoint1:	.db 32,222,1,0
000f86 de20
000f87 0001
         ;------------------10 exponent----------------------------------------------------
000f88      exponent:	.db 1,0,10,0,100,0,232,3
000f88 0001
000f89 000a
000f8a 0064
000f8b 03e8
         ;-----------------Securety---------------------------------------------------------------------------------------
000f8c      pslist:		.db "+46703962707 +46734430336 +46761260395 +46704226260 +46703204141 +46707434488 +46735081012 +46705189115 +46761048668 +46761281610 +46733582926 +46761307803",0
000f8c 342b
000f8d 3736
000f8e 3330
000f8f 3639
000f90 3732
000f91 3730
000f92 2b20
000f93 3634
000f94 3337
000f95 3434
000f96 3033
000f97 3333
000f98 2036
000f99 342b
000f9a 3736
000f9b 3136
000f9c 3632
000f9d 3330
000f9e 3539
000f9f 2b20
000fa0 3634
000fa1 3037
000fa2 3234
000fa3 3632
000fa4 3632
000fa5 2030
000fa6 342b
000fa7 3736
000fa8 3330
000fa9 3032
000faa 3134
000fab 3134
000fac 2b20
000fad 3634
000fae 3037
000faf 3437
000fb0 3433
000fb1 3834
000fb2 2038
000fb3 342b
000fb4 3736
000fb5 3533
000fb6 3830
000fb7 3031
000fb8 3231
000fb9 2b20
000fba 3634
000fbb 3037
000fbc 3135
000fbd 3938
000fbe 3131
000fbf 2035
000fc0 342b
000fc1 3736
000fc2 3136
000fc3 3430
000fc4 3638
000fc5 3836
000fc6 2b20
000fc7 3634
000fc8 3637
000fc9 3231
000fca 3138
000fcb 3136
000fcc 2030
000fcd 342b
000fce 3736
000fcf 3333
000fd0 3835
000fd1 3932
000fd2 3632
000fd3 2b20
000fd4 3634
000fd5 3637
000fd6 3331
000fd7 3730
000fd8 3038
000fd9 0033
         ;pslist:		.db "+46703962707 +46734430336 +46733582926",0
         
         ;----------------EEPROM DATA---------------------------------------------------------------------
          .eseg
         ;.org 0x190
         ;.org 0x50
         ;		.db 0xff,0xff,0xff,0xff
         ;----------------Securety-------------------------------------------------------------
         
         
000000      baudrate:	.db 5			;Default baud-rate for hardware uart 115200,11059200/16/115200-1=5 (Calculate  baud-rate for hardware-UART,crystal 11.059200Mhz)
000000 05
         ;-------------Parameters for sofuart-------------------------------------------------------
         					;Default baud-rate for softuart 9600 
000001      baudrates:	.db 2,184,155		;R,BL1,BL15  	19200 
000001 02
000002 b8
000003 9b
         ;baudrates:	.db 2,107,66		;R,BL1,BL15 	9600
         
         					;R=2
         					;N=170
         					;N1=13
         					;N2=45
         					;BL1=(256-N+N1+8)=107
         					;BL15=256-(N+N/2)+8+12+N2)=66
         					
         ;-------------Initregister bit0 to 7-------------------------------------------------------
000004      ireg:		.db 5;7;39;7;3;3;1;0		;bit0=0 poll off, bit0=1 poll on
000004 05
         						;bit1=0 phoneinit inactive, bit1=1 phoneinit active
         						;bit2 start up flag
         						;bit5 ButtonLockFlag bit5=0 Button inactive, bit5=1 Button active
         ;-------------ButtonFlag bit0 to 7-------------------------------------------------------------------------------
000005      buttonFlag:     .db 0				;bit0=0 data2 off, bit0=1 data2 on		
000005 00
         ;------------FieldOutputFlag-----------------------------------------------------------
000006      fieldFlag:	.db 1				;bit0=0 CustomerNo off,bit0=1 CustomerNo on 						
000006 01
         ;-----------Target Phoneno---------------------------------------------------------------------------------------
         ;targetPno:	.db "+46703962707",0		;Target Phoneno
         ;targetPno:	.db "+46703962707",0,0,0,0,0	;Target Phoneno
000007      targetPno:	.db "+46733582926",0,0,0,0,0	;Target Phoneno panel1
000007 2b
000008 34
000009 36
00000a 37
00000b 33
00000c 33
00000d 35
00000e 38
00000f 32
000010 39
000011 32
000012 36
000013 00
000014 00
000015 00
000016 00
000017 00
         ;targetPno:	.db "+46761030969",0,0,0,0,0	;Target Phoneno
         ;targetPno:	.db "+46761048668",0,0,0,0,0	;Target Phoneno panel2
         ;targetPno:	.db "+46761260395",0,0,0,0,0	;Target Phoneno panel3
         ;targetPno:	.db "+46761307803",0,0,0,0,0	;Target Phoneno panel4
         ;targetPno:	.db "+46761063382",0,0,0,0,0	;Target Phoneno panel5
         ;targetPno:	.db "+46761259649",0,0,0,0,0	;Target Phoneno panel6
         ;-------------------------------pumpflag---------------------------------------------
000018      pumpflag:	.db 1				;bit0=0 off,bit0=1 on
000018 01
         ;-------------------------------tempref----------------------------------------------
000019      tempref:	.db 25
000019 19
         ;------------------------------------------------------------------------------------------
00001a      EEText1:	.db "POWR   1",13,0
00001a 50
00001b 4f
00001c 57
00001d 52
00001e 20
00001f 20
000020 20
000021 31
000022 0d
000023 00
000024      EEText2:	.db "POWR   0",13,0
000024 50
000025 4f
000026 57
000027 52
000028 20
000029 20
00002a 20
00002b 30
00002c 0d
00002d 00
00002e      EEText3:	.db "IVED   1",13,0
00002e 49
00002f 56
000030 45
000031 44
000032 20
000033 20
000034 20
000035 31
000036 0d
000037 00
000038      EEText4:	.db "IRGB   1",13,0
000038 49
000039 52
00003a 47
00003b 42
00003c 20
00003d 20
00003e 20
00003f 31
000040 0d
000041 00
000042      EEText5:	.db "",13,0
000042 0d
000043 00
000044      EEText6:	.db "",13,0
000044 0d
000045 00
         ;-----------------------------Securety List--------------------------------------
         
         ;pslistE:	.db "+46703962707 +46733582926 +46761281610",0,0,0,0,0,0,0,0	;Panel1
         ;pslistE:	.db "+46703962707 +46761048668 +46761281610",0,0,0,0,0,0,0,0	;Panel2
         ;pslistE:	.db "+46703962707 +46761260395 +46761281610",0,0,0,0,0,0,0,0	;Panel3
         ;pslistE:	.db "+46703962707 +46761307803 +46761281610",0,0,0,0,0,0,0,0	;Panel4
         ;pslistE:	.db "+46703962707 +46761063382 +46761281610",0,0,0,0,0,0,0,0	;Panel5
         ;pslistE:	.db "+46703962707 +46761259649 +46761281610",0,0,0,0,0,0,0,0	;Panel6
         ;pslistE:	.db "+46703962707 +46705189115 +46761259649 +46761063382 +46761281610 +46761307803 +46761260395 +46761048668 +46733582926",0,0,0,0,0,0,0,0
000046      pslistE:	.db "+46703962707 " 
000046 2b
000047 34
000048 36
000049 37
00004a 30
00004b 33
00004c 39
00004d 36
00004e 32
00004f 37
000050 30
000051 37
000052 20
          		.db "+46705189115 "
000053 2b
000054 34
000055 36
000056 37
000057 30
000058 35
000059 31
00005a 38
00005b 39
00005c 31
00005d 31
00005e 35
00005f 20
          		.db "+46761259649 "
000060 2b
000061 34
000062 36
000063 37
000064 36
000065 31
000066 32
000067 35
000068 39
000069 36
00006a 34
00006b 39
00006c 20
          		.db "+46761063382 "
00006d 2b
00006e 34
00006f 36
000070 37
000071 36
000072 31
000073 30
000074 36
000075 33
000076 33
000077 38
000078 32
000079 20
          		.db "+46761281610 "
00007a 2b
00007b 34
00007c 36
00007d 37
00007e 36
00007f 31
000080 32
000081 38
000082 31
000083 36
000084 31
000085 30
000086 20
          		.db "+46761307803 "
000087 2b
000088 34
000089 36
00008a 37
00008b 36
00008c 31
00008d 33
00008e 30
00008f 37
000090 38
000091 30
000092 33
000093 20
          		.db "+46761260395 "
000094 2b
000095 34
000096 36
000097 37
000098 36
000099 31
00009a 32
00009b 36
00009c 30
00009d 33
00009e 39
00009f 35
0000a0 20
          		.db "+46761048668 "
0000a1 2b
0000a2 34
0000a3 36
0000a4 37
0000a5 36
0000a6 31
0000a7 30
0000a8 34
0000a9 38
0000aa 36
0000ab 36
0000ac 38
0000ad 20
          		.db "+46733582926 "
0000ae 2b
0000af 34
0000b0 36
0000b1 37
0000b2 33
0000b3 33
0000b4 35
0000b5 38
0000b6 32
0000b7 39
0000b8 32
0000b9 36
0000ba 20
          		.db "             ",0
0000bb 20
0000bc 20
0000bd 20
0000be 20
0000bf 20
0000c0 20
0000c1 20
0000c2 20
0000c3 20
0000c4 20
0000c5 20
0000c6 20
0000c7 20
0000c8 00
         ;-----------------------------CustomerNo-----------------------------------------
0000c9      customernoE:	.db "CustomerNo",0,0,0,0,0,0,0,0,0,0	
0000c9 43
0000ca 75
0000cb 73
0000cc 74
0000cd 6f
0000ce 6d
0000cf 65
0000d0 72
0000d1 4e
0000d2 6f
0000d3 00
0000d4 00
0000d5 00
0000d6 00
0000d7 00
0000d8 00
0000d9 00
0000da 00
0000db 00
0000dc 00
         
         ;Obs!!!!! Modifiera send= , lgg till ReadSoftUart
         
         ;********************************************************************
         ;* End of file
         ;********************************************************************
Assembly complete with no errors.
